<!DOCTYPE html>

<html lang="pt">
<head>
<title>Flow Forecasting</title>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<!-- Google Fonts - Inter -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
<!-- Chart.js CSS -->
<link href="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.css" rel="stylesheet"/>
<!-- Custom CSS -->
<link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet"/>
<style>
        .navbar {
            margin-bottom: 0;
            border-radius: 0;
        }

        footer {
            background-color: #f2f2f2;
            padding: 25px;
        }

        @media (max-width: 992px) {
            .probabilities-header {
                font-size: 12px;
            }
        }

        @media (max-width: 720px) {
            .probabilities-header {
                font-size: 10px;
            }
        }

        .almost-certain {
            background-color: rgba(75, 192, 192, 0.2);
        }

        .somewhat-certain {
            background-color: rgba(255, 206, 86, 0.2);
        }

        .not-certain {
            background-color: rgba(255, 99, 132, 0.2);
        }

        .chart-container {
            margin: 30px 0;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .chart-container img {
            width: 100%;
            height: auto;
            border-radius: 4px;
        }

        .results-panel {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .metric-card {
            background: white;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .risk-high {
            color: #dc3545;
            font-weight: bold;
        }

        .risk-medium {
            color: #ffc107;
            font-weight: bold;
        }

        .risk-low {
            color: #28a745;
            font-weight: bold;
        }

        /* Fix for input-group wrapping - only for results summary */
        #results-main .input-group {
            flex-wrap: nowrap !important;
        }

        #results-main .input-group .form-control {
            min-width: 60px;
            max-width: 120px;
            text-align: center;
            font-weight: bold;
        }

        #results-main .input-group-prepend .input-group-text,
        #results-main .input-group-append .input-group-text {
            white-space: nowrap;
        }
    </style>
</head>
<body>
<nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top">
<a class="navbar-brand" href="#" data-i18n="site_name">Flow Forecasting</a>
<button aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#navbarsExampleDefault" data-toggle="collapse" type="button">
<span class="navbar-toggler-icon"></span>
</button>
<div class="collapse navbar-collapse" id="navbarsExampleDefault">
<ul class="navbar-nav mr-auto">
<li class="nav-item">
<a class="nav-link" data-target="#advanced-forecast" href="#advanced-forecast" data-i18n="menu_advanced">Previsão Avançada</a>
</li>
<li class="nav-item">
<a class="nav-link" data-target="#deadline-analysis" href="#deadline-analysis" data-i18n="menu_deadline">Análise de Prazo</a>
</li>
</ul>
<div class="language-selector">
<button class="language-btn" data-lang="pt" onclick="changeLanguage('pt')">PT</button>
<button class="language-btn" data-lang="en" onclick="changeLanguage('en')">EN</button>
<button class="language-btn" data-lang="es" onclick="changeLanguage('es')">ES</button>
</div>
</div>
</nav>
<main class="container" role="main">
<br/><br/><br/>
<div class="container text-center">
<h1 data-i18n="site_name">Flow Forecasting</h1>
<p>
                <span data-i18n="site_tagline">Previsão de esforço e duração de projetos usando simulações Monte Carlo e aprendizado de máquina.</span>
                <br/>
                <span data-i18n="site_description">Seus dados permanecem locais no seu navegador/servidor.</span>
            </p>
</div>
<section class="mt-4">
<div class="container-fluid bg-12 text-center">
<h2 data-i18n="shared_throughput_title">Dados de Throughput Compartilhados</h2>
<div class="row justify-content-center">
<div class="col-lg-8">
<textarea class="form-control text-monospace" id="tpSamples" data-i18n-placeholder="throughput_placeholder" placeholder="Exemplo: 5, 6, 7, 4, 8, 6, 5, 7, 6, 8" rows="4" title="Historical weekly throughput used by all simulations"></textarea>
<small class="form-text text-muted" data-i18n="throughput_help">
                            Forneça amostras de throughput semanais uma vez e reutilize-as em simulações Monte Carlo e Aprendizado de Máquina.
                        </small>
</div>
</div>
</div>
</section>
<ul class="nav nav-tabs nav-fill mt-4" id="forecastTabs" role="tablist">
<li class="nav-item">
<a aria-controls="mc-forecast" aria-selected="true" class="nav-link active" data-toggle="tab" href="#mc-forecast" id="tab-mc-link" role="tab" data-i18n="tab_monte_carlo">Monte Carlo</a>
</li>
<li class="nav-item">
<a aria-controls="advanced-forecast" aria-selected="false" class="nav-link" data-toggle="tab" href="#advanced-forecast" id="tab-advanced-link" role="tab" data-i18n="tab_advanced">Avançado (ML + MC)</a>
</li>
<li class="nav-item">
<a aria-controls="deadline-analysis" aria-selected="false" class="nav-link" data-toggle="tab" href="#deadline-analysis" id="tab-deadline-link" role="tab" data-i18n="tab_deadline">Análise de Prazo</a>
</li>
<li class="nav-item">
<a aria-controls="historical-charts" aria-selected="false" class="nav-link" data-toggle="tab" href="#historical-charts" id="tab-historical-link" role="tab" data-i18n="tab_historical">Gráficos Históricos</a>
</li>
<li class="nav-item">
<a aria-controls="cost-analysis" aria-selected="false" class="nav-link" data-toggle="tab" href="#cost-analysis" id="tab-cost-link" role="tab" data-i18n="tab_cost">Análise de Custos</a>
</li>
</ul>
<div class="tab-content" id="forecastTabsContent">
<div aria-labelledby="tab-mc-link" class="tab-pane fade show active" id="mc-forecast" role="tabpanel">
<div class="pt-4">
<div class="container-fluid bg-6 text-center">
<div class="row">
<div class="col-sm-6 text-left">
<h3 data-i18n="project_props">Propriedades do Projeto</h3>
<div class="input-group mb-3">
<div class="input-group-prepend">
<span class="input-group-text" data-i18n="project_name">Nome do projeto</span>
</div>
<input class="form-control" id="projectName" type="text"/>
</div>
<div class="input-group mb-3">
<div class="input-group-prepend">
<span class="input-group-text"><span data-i18n="team_size">Tamanho da equipe</span><span style="color:red">*</span></span>
</div>
<input class="form-control" id="totalContributors" max="9999" min="1" required="required" title="Total number of individual contributors on this team" type="number" value="1"/>
<div class="input-group-append">
<span class="input-group-text" data-i18n="contributors">contribuidores</span>
</div>
</div>
<div class="input-group mb-3">
<div class="input-group-prepend">
<span class="input-group-text" data-i18n="min_contributors">Contribuidores mínimos</span>
</div>
<input class="form-control" id="minContributors" max="9999" min="1" title="Minimum number of contributors who will start working in the project" type="number"/>
</div>
<div class="input-group mb-3">
<div class="input-group-prepend">
<span class="input-group-text" data-i18n="max_contributors">Contribuidores máximos</span>
</div>
<input class="form-control" id="maxContributors" max="9999" min="1" title="Maximum number of contributors who can work in the project" type="number"/>
</div>
<div class="input-group mb-3">
<div class="input-group-prepend">
<span class="input-group-text"><span data-i18n="num_tasks">Número de tarefas</span><span style="color:red">*</span></span>
</div>
<input class="form-control" id="numberOfTasks" max="9999" min="0" required="required" title="Number of tasks planned for this project" type="number" value="1"/>
</div>
<div class="input-group mb-3">
<div class="input-group-prepend">
<span class="input-group-text" title="Team size when historical throughput data was collected">Historical team size</span>
</div>
<input class="form-control" id="historicalTeamSize" max="9999" min="1" title="Number of contributors when historical throughput data was collected (default: 1)" type="number" value="1" placeholder="1"/>
<div class="input-group-append">
<span class="input-group-text">contributors</span>
</div>
</div>
</div>
<div class="col-sm-6 text-left">
<h3 data-i18n="simulation_props">Propriedades da Simulação</h3>
<div class="input-group mb-3">
<div class="input-group-prepend">
<span class="input-group-text"><span data-i18n="num_simulations">Número de simulações</span><span style="color:red">*</span></span>
</div>
<input class="form-control" id="numberOfSimulations" max="10000000" min="10000" required="required" title="Number of simulations to execute (Default: 100K)" type="number" value="100000"/>
</div>
<div class="input-group mb-3">
<div class="input-group-prepend">
<span class="input-group-text" data-i18n="scurve_size">Tamanho da Curva-S</span>
</div>
<input class="form-control" id="sCurveSize" max="50" min="0" title="Size of the S-Curve at the beginning and end of the project (Default: 20%)" type="number" value="20"/>
<div class="input-group-append">
<span class="input-group-text">%</span>
</div>
</div>
<div class="input-group mb-3">
<div class="input-group-prepend">
<span class="input-group-text" data-i18n="confidence_level">Nível de confiança</span>
</div>
<input class="form-control" id="confidenceLevel" max="99" min="1" title="Level of confidence to report in the results (Default: 85%)" type="number" value="85"/>
<div class="input-group-append">
<span class="input-group-text">%</span>
</div>
</div>
<div class="input-group mb-3">
<div class="input-group-prepend">
<span class="input-group-text" data-i18n="start_date">Data de início</span>
</div>
<input class="form-control" id="startDate" title="Planned start date for this project" type="date"/>
</div>
<div class="input-group mb-3">
<div class="input-group-prepend">
<span class="input-group-text" data-i18n="deadline">Prazo</span>
</div>
<input class="form-control" id="deadlineDate" title="Target deadline date for deadline analysis" type="date"/>
</div>
</div>
</div>
<p class="mb-0"><i>(Fields marked with a red <span style="color:red">*</span> are mandatory)</i></p>
</div>
<div class="container-fluid bg-12 text-center">
<h2 data-i18n="historical_data">Dados históricos</h2>
<p class="text-muted mb-4" data-i18n="weekly_throughput_note">As amostras de throughput semanais são definidas na seção compartilhada acima.</p>
<div class="row">
<div class="col-sm-6">
<h4>Task lead-times</h4>
<textarea class="form-control text-monospace" id="ltSamples" rows="4" title="Optionally paste your historical data of tasks lead-time"></textarea>
</div>
<div class="col-sm-6">
<h4>Projects split rates</h4>
<textarea class="form-control text-monospace" id="splitRateSamples" rows="4" title="Optionally paste your historical data of project's split rates"></textarea>
</div>
</div>
</div>
<div class="container-fluid bg-12 text-center">
<h2>Risks (optional)</h2>
<p class="text-muted">Model discrete risks to add probabilistic buffer to your forecast.</p>
<div class="row">
<table class="table table-sm" id="risks">
<thead>
<tr class="d-flex">
<th class="col-2" scope="col">Likelihood</th>
<th class="col-2" scope="col">Low impact</th>
<th class="col-2" scope="col">High impact</th>
<th class="col-6" scope="col">Description</th>
</tr>
</thead>
<tbody>
<tr class="d-flex risk-row" id="risk-row-template">
<td class="col-2">
<div class="input-group mb-3">
<input class="form-control" max="100" min="1" name="likelihood" type="number"/>
<div class="input-group-append d-none d-md-block">
<span class="input-group-text">%</span>
</div>
</div>
</td>
<td class="col-2">
<div class="input-group mb-3">
<input class="form-control" max="100" min="0" name="lowImpact" type="number"/>
<div class="input-group-append d-none d-lg-block">
<span class="input-group-text">tasks</span>
</div>
</div>
</td>
<td class="col-2">
<div class="input-group mb-3">
<input class="form-control" max="100" min="1" name="highImpact" type="number"/>
<div class="input-group-append d-none d-lg-block">
<span class="input-group-text">tasks</span>
</div>
</div>
</td>
<td class="col-6"><input class="form-control" name="description" type="text"/></td>
</tr>
<tr class="d-flex" id="add-risk-row">
<td class="col-2"></td>
<td class="col-2"></td>
<td class="col-2"></td>
<td class="col-6">
<button class="btn btn-secondary btn-sm" id="addRisk" type="button">Add row</button>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="container-fluid bg-12 text-center">
<button class="btn btn-primary" id="run" type="button" data-i18n="run_simulation">Executar a simulação!</button>
<button class="btn btn-secondary" id="share" title="Share simulation" type="button" data-i18n="share">Compartilhar</button>
</div>
<div class="container-fluid bg-12 text-center" id="results-main" style="display:none">
<h2 data-i18n="results_title">Resultados da Simulação</h2>
<div class="col-sm-4 text-left">
<h4 id="res-summary-header">Project forecast summary:</h4>
<div class="input-group mb-1">
<div class="input-group-prepend">
<span class="input-group-text font-weight-bold">Effort:</span>
</div>
<input class="form-control" id="res-effort" readonly="" type="text"/>
<div class="input-group-append">
<span class="input-group-text">person-weeks</span>
</div>
</div>
<div class="input-group mb-1">
<div class="input-group-prepend">
<span class="input-group-text font-weight-bold">Duration:</span>
</div>
<input class="form-control" id="res-duration" readonly="" type="text"/>
<div class="input-group-append">
<span class="input-group-text">calendar weeks</span>
</div>
</div>
<div class="input-group mb-1">
<div class="input-group-prepend">
<span class="input-group-text font-weight-bold">Delivery date:</span>
</div>
<input class="form-control" id="res-endDate" readonly="" type="text"/>
</div>
</div>
<h3>All probabilities</h3>
<div class="row">
<table class="table table-sm" id="probabilities">
<thead>
<tr class="d-flex probabilities-header">
<th class="col-2" scope="col">Likelihood</th>
<th class="col-1" scope="col">Effort</th>
<th class="col-1" scope="col">Duration</th>
<th class="col-2" scope="col">Tasks</th>
<th class="col-3" scope="col">Date</th>
<th class="col-3" scope="col">Comment</th>
</tr>
</thead>
<tbody>
<tr class="d-flex probabilities-row">
<td class="col-2"></td>
<td class="col-1"></td>
<td class="col-1"></td>
<td class="col-2"></td>
<td class="col-3"></td>
<td class="col-3"></td>
</tr>
<tr class="d-flex" id="show-more-row">
<td class="col-2"></td>
<td class="col-1"></td>
<td class="col-1"></td>
<td class="col-2"></td>
<td class="col-3"></td>
<td class="col-3">
<button class="btn btn-secondary btn-sm" id="show-more" type="button">Show more...</button>
</td>
</tr>
</tbody>
</table>
</div>
<h3>Charts</h3>
<canvas id="res-duration-histogram"></canvas>
<canvas id="res-burn-downs"></canvas>
<canvas id="res-effort-scatter-plot"></canvas>
<h3>Simulation report</h3>
<textarea class="col-sm-12 text-monospace" id="results" readonly="" rows="23"></textarea>
</div>
<div class="container-fluid bg-12 text-left mt-4" id="input-stats" style="display:none">
<h3 class="input-stats-title">Input statistics</h3>
<div class="input-stats-content"></div>
</div>
</div>
</div>
<div aria-labelledby="tab-advanced-link" class="tab-pane fade" id="advanced-forecast" role="tabpanel">
<div class="pt-4 pb-5">
<div class="container text-center">
<h2>Advanced Forecasting</h2>
<p class="mb-4">
                            Combine machine learning forecasts with Monte Carlo throughput simulations for richer outlooks.
                            Provide at least eight throughput samples to unlock ML-based projections.
                        </p>
</div>
<div class="container-fluid bg-6 text-center">
<div class="row">
<div class="col-sm-6 text-left">
<h3>Historical Data</h3>
<div class="form-group">
<label>Weekly Throughput<span style="color:red">*</span></label>
<div class="alert alert-secondary mb-3" role="alert">
                                        Uses the shared throughput samples defined above.
                                        <a class="alert-link scroll-to-throughput" href="#tpSamples">Edit data</a>
</div>
<small class="form-text text-muted">Minimum of 8 values required for ML forecasting.</small>
</div>
<div class="form-group">
<label for="startDateAdv">Start Date</label>
<input class="form-control" id="startDateAdv" type="date"/>
</div>
</div>
<div class="col-sm-6 text-left">
<h3>Forecast Parameters</h3>
<div class="form-group">
<label for="forecastSteps">Forecast Steps (weeks)</label>
<input class="form-control" id="forecastSteps" max="12" min="1" type="number" value="4"/>
</div>
<div class="form-group">
<label for="backlog">Backlog (tasks)</label>
<input class="form-control" id="backlog" max="10000" min="1" type="number" value="50"/>
</div>
<div class="form-group">
<label for="nSimulations">Monte Carlo Simulations</label>
<input class="form-control" id="nSimulations" max="100000" min="1000" type="number" value="10000"/>
</div>
</div>
</div>
</div>
<div class="container-fluid bg-12 text-center">
<button class="btn btn-primary btn-lg" id="runCombined" type="button">Run Combined Forecast</button>
<button class="btn btn-success" id="runML" type="button">ML Forecast Only</button>
</div>
<div class="container-fluid text-center" id="loading" style="display:none">
<div class="spinner-border text-primary" role="status">
<span class="sr-only">Loading...</span>
</div>
<p>Running forecast... This may take a few seconds.</p>
</div>
<div id="results-container" style="display:none">
<div class="container-fluid" id="ml-results" style="display:none">
<h3>Machine Learning Forecast</h3>
<div class="results-panel">
<h4>Risk Assessment</h4>
<div id="risk-assessment"></div>
</div>
<div class="results-panel">
<h4>Model Performance</h4>
<div id="model-performance"></div>
</div>
<div class="chart-container">
<h4>ML Ensemble Forecast</h4>
<img alt="ML Forecast Chart" id="ml-chart" src=""/>
</div>
<div class="chart-container">
<h4>Historical Data Analysis</h4>
<img alt="Historical Analysis" id="history-chart" src=""/>
</div>
</div>
<div class="container-fluid" id="mc-results" style="display:none">
<h3>Monte Carlo Simulation</h3>
<div class="results-panel">
<h4>Completion Time Statistics</h4>
<div id="mc-stats"></div>
</div>
<div class="chart-container">
<h4>Monte Carlo Simulations</h4>
<img alt="Monte Carlo Chart" id="mc-chart" src=""/>
</div>
</div>
<div class="container-fluid" id="comparison-results" style="display:none">
<h3>Forecast Comparison</h3>
<div class="chart-container">
<h4>ML vs Monte Carlo Comparison</h4>
<img alt="Comparison Chart" id="comparison-chart" src=""/>
</div>
<div class="results-panel">
<div class="row">
<div class="col-md-6">
<h5>ML Forecast Summary</h5>
<div id="ml-summary"></div>
</div>
<div class="col-md-6">
<h5>Monte Carlo Summary</h5>
<div id="mc-summary"></div>
</div>
</div>
</div>
</div>
<div class="mt-4" id="advanced-input-stats" style="display:none">
<h4 class="input-stats-title">Input statistics</h4>
<div class="input-stats-content"></div>
</div>
<div class="container-fluid mt-4" id="walk-forward-results" style="display:none">
<h3>Walk-forward Validation</h3>
<div class="alert alert-info small">
                                Validação com janela deslizante utilizando os últimos 20% das amostras. Os erros são calculados a cada origem de previsão respeitando o parâmetro <strong>Forecast Steps</strong>.
                            </div>
<div class="table-responsive mb-3" id="walk-forward-metrics"></div>
<div class="row" id="walk-forward-charts"></div>
</div>
</div>
</div>
</div>
<div aria-labelledby="tab-deadline-link" class="tab-pane fade" id="deadline-analysis" role="tabpanel">
<div class="pt-4 pb-5">
<div class="container text-center">
<h2 data-i18n="deadline_analysis">Análise de Prazo</h2>
<p class="mb-4" data-i18n="deadline_reuse_desc">
                            Reutilize suas entradas de simulação e riscos existentes para avaliar se o prazo pode ser alcançado.
                            Certifique-se de que os campos Data de início e Prazo no formulário Monte Carlo estejam preenchidos.
                        </p>
</div>
<div class="container-fluid bg-12 text-center">
<div class="alert alert-info d-inline-block text-left" role="alert">
<strong data-i18n="how_it_works">Como funciona</strong>: <span data-i18n="how_works_desc">executamos a simulação Monte Carlo completa com seus riscos e configurações de equipe,
                            depois comparamos os percentis de conclusão projetados com o prazo selecionado. O previsor de Aprendizado de Máquina
                            também é executado quando pelo menos oito amostras de throughput estão disponíveis.</span>
                        </div>
<div class="mt-3">
<button class="btn btn-primary btn-lg" id="runDeadlineAnalysis" type="button" data-i18n="run_deadline_analysis">
                                Executar Análise de Prazo
                            </button>
</div>
</div>
<div class="mt-4" id="deadline-analysis-loading" style="display:none">
<div class="spinner-border text-primary" role="status">
<span class="sr-only" data-i18n="loading">Carregando...</span>
</div>
<p class="mt-2" data-i18n="running_simulations">Executando simulações de prazo...</p>
</div>
<div class="mt-4" id="deadline-analysis-panels" style="display:none">
<ul class="nav nav-tabs nav-fill mb-3" id="deadlineResultsTabs" role="tablist">
<li class="nav-item">
<a class="nav-link active" id="deadline-summary-tab" data-toggle="tab" href="#deadline-results-summary" role="tab">Resumo</a>
</li>
<li class="nav-item" id="deadline-start-tab-item" style="display:none">
<a class="nav-link" id="deadline-start-tab" data-toggle="tab" href="#deadline-start-window" role="tab">Quando começar?</a>
</li>
</ul>
<div class="tab-content">
<div class="tab-pane fade show active" id="deadline-results-summary" role="tabpanel"></div>
<div class="tab-pane fade" id="deadline-start-window" role="tabpanel">
<div class="mb-3">
<div class="alert alert-secondary d-inline-block">
<strong>Hoje:</strong> <span id="current-date-display" class="font-weight-bold"></span>
</div>
</div>
<div class="table-responsive">
<table class="table table-sm table-bordered">
<thead class="table-light">
<tr>
<th>Intervalo</th>
<th>Data de início</th>
<th>Até</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr class="table-warning">
<th scope="row">Muito cedo</th>
<td id="window-too-early"></td>
<td colspan="1"></td>
<td id="window-too-early-status"></td>
</tr>
<tr class="table-warning">
<th scope="row">Cedo</th>
<td id="window-early-start"></td>
<td id="window-early-end"></td>
<td id="window-early-status"></td>
</tr>
<tr class="table-success">
<th scope="row" data-i18n="just_in_time">Just in time</th>
<td id="window-just-start"></td>
<td id="window-just-end"></td>
<td id="window-just-status"></td>
</tr>
<tr class="table-warning">
<th scope="row">Tarde</th>
<td id="window-late-start"></td>
<td id="window-late-end"></td>
<td id="window-late-status"></td>
</tr>
<tr class="table-danger">
<th scope="row">Último momento responsável (UMR)</th>
<td id="window-umr"></td>
<td colspan="1"></td>
<td id="window-umr-status"></td>
</tr>
<tr class="table-danger">
<th scope="row">Irresponsavelmente atrasado</th>
<td colspan="2" id="window-too-late"></td>
<td id="window-too-late-status"></td>
</tr>
</tbody>
</table>
</div>
<small class="text-muted d-block text-left">DDE = Data Desejada de Entrega · UMR = Último Momento Responsável</small>
</div>
</div>
</div>
</div>
</div>
<div aria-labelledby="tab-historical-link" class="tab-pane fade" id="historical-charts" role="tabpanel">
<div class="pt-4 pb-5">
<div class="container text-center">
<h2>Historical Throughput &amp; Lead Time Charts</h2>
<p class="mb-4">Visualize the distribution and stability of the samples you provided. Update the fields above to refresh these charts.</p>
</div>
<div class="container-fluid">
<div class="row">
<div class="col-lg-6 mb-4">
<div class="card h-100">
<div class="card-header bg-primary text-white">
<h5 class="mb-0">Throughput Histogram</h5>
</div>
<div class="card-body">
<div class="alert alert-info" id="tp-histogram-empty" role="alert" style="display:none;">
Forneça ao menos 3 amostras de throughput para gerar o histograma.
</div>
<div class="chart-container" id="tp-histogram-container">
<canvas id="tp-histogram-chart"></canvas>
</div>
</div>
</div>
</div>
<div class="col-lg-6 mb-4">
<div class="card h-100">
<div class="card-header bg-secondary text-white">
<h5 class="mb-0">Throughput Control Chart</h5>
</div>
<div class="card-body">
<div class="alert alert-info" id="tp-control-empty" role="alert" style="display:none;">
Forneça amostras de throughput para visualizar o control chart.
</div>
<div class="chart-container" id="tp-control-container">
<canvas id="tp-control-chart"></canvas>
</div>
</div>
</div>
</div>
</div>
<div class="row">
<div class="col-lg-6 mb-4">
<div class="card h-100">
<div class="card-header bg-success text-white">
<h5 class="mb-0">Lead Time Histogram</h5>
</div>
<div class="card-body">
<div class="alert alert-info" id="lt-histogram-empty" role="alert" style="display:none;">
Forneça ao menos 3 amostras de lead time para gerar o histograma.
</div>
<div class="chart-container" id="lt-histogram-container">
<canvas id="lt-histogram-chart"></canvas>
</div>
</div>
</div>
</div>
<div class="col-lg-6 mb-4">
<div class="card h-100">
<div class="card-header bg-dark text-white">
<h5 class="mb-0">Lead Time Control Chart</h5>
</div>
<div class="card-body">
<div class="alert alert-info" id="lt-control-empty" role="alert" style="display:none;">
Forneça amostras de lead time para visualizar o control chart.
</div>
<div class="chart-container" id="lt-control-container">
<canvas id="lt-control-chart"></canvas>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div aria-labelledby="tab-cost-link" class="tab-pane fade" id="cost-analysis" role="tabpanel">
<div class="pt-4 pb-5">
<div class="container text-center">
<h2>Análise de Custos com PERT-Beta</h2>
<p class="mb-4">
                            Simule custos do projeto usando distribuição PERT-Beta com estimativas otimista, mais provável e pessimista.
                            A simulação Monte Carlo com 10.000+ iterações fornece projeções realistas de custo.
                        </p>
</div>
<div class="container-fluid bg-6 text-center">
<div class="row">
<div class="col-md-6 text-left">
<h3>Custo por Item</h3>
<div class="form-group">
<label for="avgCostPerItem">Custo Médio por Item</label>
<div class="input-group">
<div class="input-group-prepend">
<span class="input-group-text">R$</span>
</div>
<input class="form-control" id="avgCostPerItem" min="0" step="0.01" type="number" placeholder="Ex: 5000.00"/>
</div>
<small class="form-text text-muted">Custo médio histórico por item de trabalho</small>
</div>
</div>
<div class="col-md-6 text-left">
<h3>Estimativas PERT</h3>
<div class="form-group">
<label for="optimisticCost">Custo Otimista (a)</label>
<div class="input-group">
<div class="input-group-prepend">
<span class="input-group-text">R$</span>
</div>
<input class="form-control" id="optimisticCost" min="0" step="0.01" type="number" placeholder="Melhor cenário"/>
</div>
</div>
<div class="form-group">
<label for="mostLikelyCost">Custo Mais Provável (m)</label>
<div class="input-group">
<div class="input-group-prepend">
<span class="input-group-text">R$</span>
</div>
<input class="form-control" id="mostLikelyCost" min="0" step="0.01" type="number" placeholder="Cenário mais realista"/>
</div>
</div>
<div class="form-group">
<label for="pessimisticCost">Custo Pessimista (b)</label>
<div class="input-group">
<div class="input-group-prepend">
<span class="input-group-text">R$</span>
</div>
<input class="form-control" id="pessimisticCost" min="0" step="0.01" type="number" placeholder="Pior cenário"/>
</div>
</div>
</div>
</div>
<div class="row mt-3">
<div class="col-md-6 text-left">
<div class="form-group">
<label for="costSimulations">Número de Simulações</label>
<input class="form-control" id="costSimulations" max="100000" min="10000" type="number" value="10000"/>
<small class="form-text text-muted">Mínimo: 10.000 simulações</small>
</div>
</div>
<div class="col-md-6 text-left">
<div class="form-group">
<label>Backlog</label>
<div class="alert alert-secondary mb-0" role="alert">
                                        Usa o backlog definido na aba Monte Carlo
                                    </div>
</div>
</div>
</div>
</div>
<div class="container-fluid bg-12 text-center mt-4">
<button class="btn btn-primary btn-lg" id="runCostAnalysis" type="button">
                                Executar Análise de Custos
                            </button>
</div>
<div class="mt-4" id="cost-analysis-loading" style="display:none">
<div class="spinner-border text-primary" role="status">
<span class="sr-only">Loading...</span>
</div>
<p class="mt-2">Executando simulações de custo...</p>
</div>
<div class="mt-4" id="cost-analysis-results" style="display:none">
<div class="container-fluid">
<h3>Resultados da Simulação</h3>
<div class="row">
<div class="col-lg-6">
<div class="card mb-3">
<div class="card-header bg-primary text-white">
<h5 class="mb-0">Estatísticas de Custo</h5>
</div>
<div class="card-body">
<table class="table table-sm table-borderless mb-0">
<tbody id="cost-stats-table">
</tbody>
</table>
</div>
</div>
</div>
<div class="col-lg-6">
<div class="card mb-3">
<div class="card-header bg-success text-white">
<h5 class="mb-0">Cenários</h5>
</div>
<div class="card-body">
<table class="table table-sm table-borderless mb-0">
<tbody id="cost-scenarios-table">
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="row mt-4">
<div class="col-12">
<div class="card">
<div class="card-header bg-info text-white">
<h5 class="mb-0">Distribuição de Custos</h5>
</div>
<div class="card-body">
<div class="chart-container">
<canvas id="cost-histogram-chart"></canvas>
</div>
</div>
</div>
</div>
</div>
<div class="row mt-4">
<div class="col-md-6">
<div class="card">
<div class="card-header bg-warning">
<h5 class="mb-0">Percentis de Custo</h5>
</div>
<div class="card-body">
<table class="table table-sm table-bordered">
<thead>
<tr>
<th>Percentil</th>
<th>Custo (R$)</th>
<th>Probabilidade</th>
</tr>
</thead>
<tbody id="cost-percentiles-table">
</tbody>
</table>
</div>
</div>
</div>
<div class="col-md-6">
<div class="card">
<div class="card-header bg-secondary text-white">
<h5 class="mb-0">Parâmetros PERT-Beta</h5>
</div>
<div class="card-body">
<table class="table table-sm table-borderless">
<tbody id="pert-params-table">
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<br/><br/>
</main>
<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.bundle.min.js"></script>
<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.bundle.min.js"></script>
<script>
        (function secureChartRegistration() {
            function registerCharts() {
                try {
                    if (!window.Chart || typeof window.Chart.register !== 'function' || !window.Chart.registerables) {
                        return;
                    }
                    window.Chart.register(...window.Chart.registerables);
                } catch (error) {
                    console.warn('Chart.js registration skipped:', error);
                }
            }

            if (window.Chart) {
                registerCharts();
            } else {
                document.addEventListener('chartjs:loaded', registerCharts, { once: true });
            }
        })();
    </script>
<!-- Chart.js Annotation Plugin -->
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@0.5.7/chartjs-plugin-annotation.min.js"></script>
<!-- Moment.js -->
<script src="https://cdn.jsdelivr.net/npm/moment@2.27.0/moment.min.js"></script>
<!-- Internationalization -->
<script src="{{ url_for('static', filename='js/i18n.js') }}"></script>
<!-- Custom JS -->
<script src="{{ url_for('static', filename='js/ui.js') }}"></script>
<script src="{{ url_for('static', filename='js/advanced_forecast.js') }}"></script>
<script src="{{ url_for('static', filename='js/charts.js') }}"></script>
<script src="{{ url_for('static', filename='js/cost_analysis.js') }}"></script>
<script>
        $(function () {
            function activateTabFromHash() {
                const hash = window.location.hash;
                if (hash === '#advanced-forecast') {
                    $('#tab-advanced-link').tab('show');
                } else if (hash === '#deadline-analysis') {
                    $('#tab-deadline-link').tab('show');
                } else if (hash === '#historical-charts') {
                    $('#tab-historical-link').tab('show');
                } else if (hash === '#cost-analysis') {
                    $('#tab-cost-link').tab('show');
                } else if (hash === '#mc-forecast') {
                    $('#tab-mc-link').tab('show');
                }
            }

            activateTabFromHash();

            window.addEventListener('hashchange', activateTabFromHash);

            $('#navbarsExampleDefault a.nav-link[data-target]').on('click', function (e) {
                const target = $(this).data('target');
                if (target && target.startsWith('#')) {
                    e.preventDefault();
                    $(`#forecastTabs a[href="${target}"]`).tab('show');
                    $('html, body').animate({ scrollTop: $('#forecastTabs').offset().top - 70 }, 300);
                }
            });

            $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
                const target = $(e.target).attr('href');
                if (target === '#advanced-forecast' || target === '#mc-forecast' || target === '#deadline-analysis' || target === '#historical-charts') {
                    history.replaceState(null, null, target);
                }
            });
        });
    </script>
</body>
</html>

<!DOCTYPE html>

<html lang="pt">
<head>
<title>Flow Forecasting</title>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<!-- Google Fonts - Inter -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
<!-- Chart.js CSS -->
<link href="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.css" rel="stylesheet"/>
<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"/>
<!-- Custom CSS -->
<link href="{{ url_for('static', filename='css/style.css') }}?v=20241130" rel="stylesheet"/>
<style>
        .navbar {
            margin-bottom: 0;
            border-radius: 0;
        }

        footer {
            background-color: #f2f2f2;
            padding: 25px;
        }

        @media (max-width: 992px) {
            .probabilities-header {
                font-size: 12px;
            }
        }

        @media (max-width: 720px) {
            .probabilities-header {
                font-size: 10px;
            }
        }

        .almost-certain {
            background-color: rgba(75, 192, 192, 0.2);
        }

        .somewhat-certain {
            background-color: rgba(255, 206, 86, 0.2);
        }

        .not-certain {
            background-color: rgba(255, 99, 132, 0.2);
        }

        .chart-container {
            margin: 30px 0;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .chart-container img {
            width: 100%;
            height: auto;
            border-radius: 4px;
        }

        .results-panel {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .metric-card {
            background: #ffffff;
            padding: 14px;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
            margin: 8px 0;
            box-shadow: none;
        }
        .metric-card.compact {
            padding: 12px;
            border-radius: 10px;
        }
        .metric-card .metric-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #4c1d95;
        }
        .metric-card .metric-label {
            color: #6b7280;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-top: 0.35rem;
        }

        .risk-high {
            color: #dc3545;
            font-weight: bold;
        }

        .risk-medium {
            color: #ffc107;
            font-weight: bold;
        }

        .risk-low {
            color: #28a745;
            font-weight: bold;
        }

        /* Fix for input-group wrapping - only for results summary */
        #results-main .input-group {
            flex-wrap: nowrap !important;
        }

        #results-main .input-group .form-control {
            min-width: 60px;
            max-width: 120px;
            text-align: center;
            font-weight: bold;
        }

        #results-main .input-group-prepend .input-group-text,
        #results-main .input-group-append .input-group-text {
            white-space: nowrap;
        }

        /* Tooltip hint icons */
        .hint-icon {
            color: #6c757d;
            cursor: help;
            margin-left: 5px;
            font-size: 14px;
            transition: color 0.2s;
        }

        .hint-icon:hover {
            color: #007bff;
        }

        /* Custom Bootstrap tooltip styling */
        .tooltip-inner {
            max-width: 300px;
            text-align: left;
            padding: 10px 12px;
            font-size: 13px;
            line-height: 1.5;
        }

        .tooltip.show {
            opacity: 1;
        }

        .tab-iframe {
            width: 100%;
            min-height: 1200px;
            border: 0;
        }

        @media (max-width: 768px) {
            .tab-iframe {
                min-height: 900px;
            }
        }
        .user-menu .btn {
            border-radius: 20px;
        }
        .user-menu .dropdown-menu {
            min-width: 220px;
        }
        .pbc-stat {
            background: #ffffff;
            min-height: 110px;
        }
        .pbc-stat .small {
            letter-spacing: 0.08em;
        }
        .pbc-legend-item {
            display: flex;
            align-items: center;
            margin-right: 16px;
            margin-bottom: 8px;
        }
        .pbc-chart-wrapper {
            min-height: 320px;
        }
        .pbc-chart-wrapper canvas {
            width: 100% !important;
            min-height: 260px;
            max-height: 360px;
        }
        .pbc-legend-swatch {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 6px;
        }
        .pbc-legend-swatch.bg-gradient {
            background: linear-gradient(90deg, #6c757d 0%, #adb5bd 100%);
        }
        .portfolio-journey {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        .portfolio-step {
            background: #fff;
            border-radius: 18px;
            border: 1px solid #e5e7eb;
            box-shadow: 0 25px 45px rgba(15, 23, 42, 0.08);
            padding: 1.75rem;
        }
        .portfolio-step .step-header {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            flex-wrap: wrap;
        }
        .portfolio-step .step-badge {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #2563eb 0%, #9333ea 100%);
            color: #fff;
            font-weight: 700;
            font-size: 1.15rem;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 1.5rem 2.5rem rgba(79, 70, 229, 0.35);
        }
        .portfolio-step h4 {
            margin-bottom: 0.35rem;
        }
        .portfolio-step p {
            margin-bottom: 0.25rem;
            color: #4b5563;
        }
        .portfolio-step .step-actions {
            margin-top: 1rem;
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
        }
        .portfolio-frame-wrapper {
            margin-top: 1.25rem;
            border: 1px dashed #cbd5f5;
            border-radius: 14px;
            background: #f8fafc;
            padding: 1rem;
            position: relative;
        }
        .portfolio-frame-wrapper.d-none {
            display: none !important;
        }
        .portfolio-frame-loading {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-weight: 600;
            color: #4c1d95;
        }
        .portfolio-frame-error {
            display: none;
        }
        .portfolio-frame-wrapper iframe {
            width: 100%;
            min-height: 900px;
            border: 0;
            border-radius: 12px;
            background: #fff;
        }
        .portfolio-risk-summary {
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 1rem 1.25rem;
            background: #f8fafc;
            min-height: 150px;
        }
        .portfolio-risk-summary .risk-metric {
            padding: 0.85rem 1rem;
            border-radius: 10px;
            background: #fff;
            border: 1px solid #e2e8f0;
            margin-bottom: 0.75rem;
            box-shadow: 0 6px 15px rgba(15, 23, 42, 0.05);
        }
        .portfolio-risk-summary .risk-metric h6 {
            margin-bottom: 0.15rem;
            font-size: 0.85rem;
            color: #4c1d95;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .portfolio-risk-summary .risk-metric strong {
            font-size: 1.4rem;
            color: #111827;
        }
    </style>
</head>
<body>
<nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top">
<a class="navbar-brand" href="#" data-i18n="site_name">Flow Forecasting</a>
<button aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#navbarsExampleDefault" data-toggle="collapse" type="button">
<span class="navbar-toggler-icon"></span>
</button>
<div class="collapse navbar-collapse" id="navbarsExampleDefault">
<ul class="navbar-nav mr-auto">
    <li class="nav-item">
        <a class="nav-link" href="/documentacao" target="_blank" rel="noopener noreferrer">
            <i class="fas fa-book"></i> Documentação
        </a>
    </li>
</ul>
<div class="ml-auto d-flex align-items-center user-menu">
<div class="language-selector mr-3">
<button class="language-btn" data-lang="pt" onclick="changeLanguage('pt')">PT</button>
<button class="language-btn" data-lang="en" onclick="changeLanguage('en')">EN</button>
<button class="language-btn" data-lang="es" onclick="changeLanguage('es')">ES</button>
</div>
<div class="dropdown">
<button aria-expanded="false" aria-haspopup="true" class="btn btn-outline-light btn-sm dropdown-toggle" data-toggle="dropdown" id="userMenuDropdown" type="button">
<i class="fas fa-user-circle mr-2"></i>{{ current_user.name }}
</button>
<div aria-labelledby="userMenuDropdown" class="dropdown-menu dropdown-menu-right">
<span class="dropdown-item-text text-muted small d-block">{{ current_user.email }}</span>
<span class="dropdown-item-text text-muted small">Perfil: {{ (current_user.role or 'student')|capitalize }}</span>
{% if is_admin_user %}
<div class="dropdown-divider"></div>
<a class="dropdown-item disabled" href="#" title="Em breve">
<i class="fas fa-gauge-high mr-2"></i> Painel do instrutor (em breve)
</a>
{% endif %}
<div class="dropdown-divider"></div>
<a class="dropdown-item" href="{{ url_for('logout') }}">
<i class="fas fa-sign-out-alt mr-2"></i> Sair
</a>
</div>
</div>
</div>
</div>
</nav>
<main class="container" role="main">
{% with messages = get_flashed_messages(with_categories=true) %}
{% if messages %}
<div class="row justify-content-center mt-4">
<div class="col-lg-8">
{% for category, message in messages %}
<div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
{{ message }}
<button aria-label="Fechar" class="close" data-dismiss="alert" type="button">
<span aria-hidden="true">&times;</span>
</button>
</div>
{% endfor %}
</div>
</div>
{% endif %}
{% endwith %}
<br/><br/><br/>
<div class="container text-center">
<h1 data-i18n="site_name">Flow Forecasting</h1>
<p>
                <span data-i18n="site_tagline">Previsão de esforço e duração de projetos usando simulações Monte Carlo e aprendizado de máquina.</span>
                <br/>
               
            </p>
<div class="alert alert-info d-inline-block mt-2" role="alert">
<i class="fas fa-book-open"></i>
                <strong>Novo usuário?</strong> Confira o
                <a href="/documentacao" target="_blank" rel="noopener noreferrer" class="alert-link">
<strong>Manual Completo do Usuário</strong>
</a>
                com guias passo a passo, exemplos práticos e perguntas frequentes!
            </div>
</div>
<section class="mt-4">
<div class="container-fluid bg-12 text-center">
<h2 data-i18n="shared_throughput_title"
    data-doc-tooltip="Cadastre o histórico semanal de throughput em valores separados por vírgula. Precisa de pelo menos 8 amostras para liberar os modelos de Machine Learning."
    data-doc-anchor="throughput-vazao">
    Dados de Throughput Compartilhados
<a class="doc-hint-icon" href="https://flow-forecaster.fly.dev/documentacao#throughput-vazao" target="_blank" rel="noopener noreferrer" aria-label="Abrir documentação relacionada em nova aba" data-toggle="tooltip" data-placement="top" data-toggle="tooltip" data-placement="top" title="Cadastre o histórico semanal de throughput em valores separados por vírgula. Precisa de pelo menos 8 amostras para liberar os modelos de Machine Learning."><i class="fas fa-circle-question" aria-hidden="true"></i></a></h2>
<div class="row justify-content-center">
<div class="col-lg-8">
<textarea class="form-control text-monospace" id="tpSamples" data-i18n-placeholder="throughput_placeholder" placeholder="Exemplo: 5, 6, 7, 4, 8, 6, 5, 7, 6, 8" rows="4" title="Historical weekly throughput used by all simulations"></textarea>
<small class="form-text text-muted" data-i18n="throughput_help">
                            Forneça amostras de throughput semanais uma vez e reutilize-as em simulações Monte Carlo e Aprendizado de Máquina.
                            <a href="https://flow-forecaster.fly.dev/documentacao#throughput-vazao" target="_blank" rel="noopener noreferrer">Saiba mais na documentação</a>.
                        </small>
<div class="form-row mt-3">
    <div class="col-md-6 text-left">
        <label for="throughputCadence" class="font-weight-bold">Cadência das amostras</label>
        <select class="form-control" id="throughputCadence">
            <option value="7" selected>1 semana (7 dias)</option>
            <option value="14">2 semanas (14 dias)</option>
            <option value="21">3 semanas (21 dias)</option>
            <option value="28">4 semanas (28 dias)</option>
        </select>
        <small class="form-text text-muted">Normalizamos o throughput para 1 semana antes de simular.</small>
    </div>
</div>
</div>
</div>
</div>
</section>
<ul class="nav nav-tabs nav-fill mt-4" id="forecastTabs" role="tablist">
<li class="nav-item">
<a aria-controls="mc-forecast" aria-selected="true" class="nav-link active" data-toggle="tab" href="#mc-forecast" id="tab-mc-link" role="tab" data-i18n="tab_monte_carlo">Monte Carlo</a>
</li>
<li class="nav-item">
<a aria-controls="advanced-forecast" aria-selected="false" class="nav-link" data-toggle="tab" href="#advanced-forecast" id="tab-advanced-link" role="tab" data-i18n="tab_advanced">Avançado (ML + MC)</a>
</li>
<li class="nav-item">
<a aria-controls="demand-forecast" aria-selected="false" class="nav-link" data-toggle="tab" href="#demand-forecast" id="tab-demand-link" role="tab">Previsão de Demanda</a>
</li>
<li class="nav-item">
<a aria-controls="deadline-analysis" aria-selected="false" class="nav-link" data-toggle="tab" href="#deadline-analysis" id="tab-deadline-link" role="tab" data-i18n="tab_deadline">Análise de Prazo</a>
</li>
<li class="nav-item">
<a aria-controls="historical-charts" aria-selected="false" class="nav-link" data-toggle="tab" href="#historical-charts" id="tab-historical-link" role="tab" data-i18n="tab_historical">Gráficos Históricos</a>
</li>
<li class="nav-item">
<a aria-controls="cost-analysis" aria-selected="false" class="nav-link" data-toggle="tab" href="#cost-analysis" id="tab-cost-link" role="tab" data-i18n="tab_cost">Análise de Custos</a>
</li>
<li class="nav-item">
<a aria-controls="cost-of-delay" aria-selected="false" class="nav-link" data-toggle="tab" href="#cost-of-delay" id="tab-cod-link" role="tab">
<i class="fas fa-money-bill-wave"></i> Cost of Delay
</a>
</li>
<li class="nav-item">
<a aria-controls="trend-analysis" aria-selected="false" class="nav-link" data-toggle="tab" href="#trend-analysis" id="tab-trend-link" role="tab">
<i class="fas fa-chart-line"></i> Análise de Tendências
</a>
</li>
<li class="nav-item">
<a aria-controls="forecast-vs-actual-tab" aria-selected="false" class="nav-link" data-toggle="tab" href="#forecast-vs-actual-tab" id="tab-forecast-vs-actual" role="tab">
<i class="fas fa-balance-scale"></i> Forecast vs Actual
</a>
</li>
<li class="nav-item">
                        <a aria-controls="dependency-analysis-tab" aria-selected="false" class="nav-link" data-toggle="tab" href="#dependency-analysis-tab" id="dependency-tab-link" role="tab" data-i18n="dependency_analysis_tab">Análise de Dependências</a>
</li>
<li class="nav-item">
<a aria-controls="executive-dashboard" aria-selected="false" class="nav-link" data-toggle="tab" href="#executive-dashboard" id="tab-dashboard-link" role="tab">
<i class="fas fa-chart-pie"></i> Portfolio
</a>
</li>
<li class="nav-item">
<a aria-controls="backtesting-tab" aria-selected="false" class="nav-link" data-toggle="tab" href="#backtesting-tab" id="tab-backtesting-link" role="tab">
<i class="fas fa-history"></i> Backtesting
</a>
</li>
</ul>
<div class="tab-content" id="forecastTabsContent">
<div aria-labelledby="tab-mc-link" class="tab-pane fade show active" id="mc-forecast" role="tabpanel">
<div class="pt-4">
<div class="container-fluid bg-6 text-center">
<div class="row">
<div class="col-sm-6 text-left">
<h3 data-i18n="project_props">Propriedades do Projeto</h3>
<div class="input-group mb-3">
<div class="input-group-prepend">
<span class="input-group-text"
      data-i18n="project_name"
      data-doc-tooltip="Defina um identificador amigável para acompanhar o cenário nas simulações e relatórios."
      data-doc-anchor="1-simulacao-monte-carlo">
    Nome do projeto
<a class="doc-hint-icon" href="https://flow-forecaster.fly.dev/documentacao#1-simulacao-monte-carlo" target="_blank" rel="noopener noreferrer" aria-label="Abrir documentação relacionada em nova aba" data-toggle="tooltip" data-placement="top" data-toggle="tooltip" data-placement="top" title="Defina um identificador amigável para acompanhar o cenário nas simulações e relatórios."><i class="fas fa-circle-question" aria-hidden="true"></i></a></span>
</div>
<input class="form-control"
       id="projectName"
       type="text"
       title="Nome amigável exibido nos resultados e gráficos"/>
</div>
<div class="input-group mb-3">
<div class="input-group-prepend">
<span class="input-group-text"
      data-doc-tooltip="Informe quantas pessoas efetivamente entregam itens por semana. Esse valor é usado para converter semanas em esforço (pessoa-semana) e compor análises de custo."
      data-doc-anchor="1-simulacao-monte-carlo">
    <span data-i18n="team_size">Tamanho da equipe<a class="doc-hint-icon" href="https://flow-forecaster.fly.dev/documentacao#1-simulacao-monte-carlo" target="_blank" rel="noopener noreferrer" aria-label="Abrir documentação relacionada em nova aba" data-toggle="tooltip" data-placement="top" data-toggle="tooltip" data-placement="top" title="Informe quantas pessoas efetivamente entregam itens por semana. Esse valor é usado para converter semanas em esforço (pessoa-semana) e compor análises de custo."><i class="fas fa-circle-question" aria-hidden="true"></i></a></span><span style="color:red">*</span>
</span>
</div>
<input class="form-control"
       id="totalContributors"
       max="9999"
       min="1"
       required="required"
       title="Quantidade de pessoas ativas que contribuem semanalmente"
       type="number"
       value="1"/>
<div class="input-group-append">
<span class="input-group-text" data-i18n="contributors">contribuidores</span>
</div>
</div>
<div class="input-group mb-3">
<div class="input-group-prepend">
<span class="input-group-text"
      data-i18n="min_contributors"
      data-doc-tooltip="Estime a quantidade mínima de pessoas que podem atuar no período. Útil para cenários com férias ou rodízios."
      data-doc-anchor="planejamento">
    Contribuidores mínimos
<a class="doc-hint-icon" href="https://flow-forecaster.fly.dev/documentacao#planejamento" target="_blank" rel="noopener noreferrer" aria-label="Abrir documentação relacionada em nova aba" data-toggle="tooltip" data-placement="top" data-toggle="tooltip" data-placement="top" title="Estime a quantidade mínima de pessoas que podem atuar no período. Útil para cenários com férias ou rodízios."><i class="fas fa-circle-question" aria-hidden="true"></i></a></span>
</div>
<input class="form-control"
       id="minContributors"
       max="9999"
       min="1"
       title="Quantidade mínima de contribuidores disponíveis"
       type="number"/>
</div>
<div class="input-group mb-3">
<div class="input-group-prepend">
<span class="input-group-text"
      data-i18n="max_contributors"
      data-doc-tooltip="Registre o limite superior de pessoas que podem trabalhar simultaneamente no projeto."
      data-doc-anchor="planejamento">
    Contribuidores máximos
<a class="doc-hint-icon" href="https://flow-forecaster.fly.dev/documentacao#planejamento" target="_blank" rel="noopener noreferrer" aria-label="Abrir documentação relacionada em nova aba" data-toggle="tooltip" data-placement="top" data-toggle="tooltip" data-placement="top" title="Registre o limite superior de pessoas que podem trabalhar simultaneamente no projeto."><i class="fas fa-circle-question" aria-hidden="true"></i></a></span>
</div>
<input class="form-control"
       id="maxContributors"
       max="9999"
       min="1"
       title="Quantidade máxima de contribuidores esperada"
       type="number"/>
</div>
<div class="form-group w-100">
<label class="font-weight-bold d-block"
       data-doc-tooltip="Informe o total de itens que precisam ser concluídos. Esse valor representa seu backlog alvo."
       data-doc-anchor="backlog">
    <span data-i18n="num_tasks">Número de tarefas</span>
    <a class="doc-hint-icon" href="https://flow-forecaster.fly.dev/documentacao#backlog" target="_blank" rel="noopener noreferrer" aria-label="Abrir documentação relacionada em nova aba" data-toggle="tooltip" data-placement="top" data-toggle="tooltip" data-placement="top" title="Informe o total de itens que precisam ser concluídos. Esse valor representa seu backlog alvo."><i class="fas fa-circle-question" aria-hidden="true"></i></a>
    <span style="color:red">*</span>
</label>
<div class="form-row">
<div class="col-md-6">
<div class="input-group mb-3">
<div class="input-group-prepend">
<span class="input-group-text" data-i18n="backlog_min_label">Mín</span>
</div>
<input class="form-control"
       id="backlogMin"
       max="999999"
       min="0"
       required="required"
       title="Quantidade mínima estimada de itens no backlog"
       type="number"
       value="1"
       oninput="recalculateBacklog()"
       onchange="recalculateBacklog()"/>
<div class="input-group-append d-none d-lg-flex">
<span class="input-group-text" data-i18n="tasks">tarefas</span>
</div>
</div>
</div>
<div class="col-md-6">
<div class="input-group mb-3">
<div class="input-group-prepend">
<span class="input-group-text" data-i18n="backlog_max_label">Máx</span>
</div>
<input class="form-control"
       id="backlogMax"
       max="999999"
       min="0"
       required="required"
       title="Quantidade máxima estimada de itens no backlog"
       type="number"
       value="1"
       oninput="recalculateBacklog()"
       onchange="recalculateBacklog()"/>
<div class="input-group-append d-none d-lg-flex">
<span class="input-group-text" data-i18n="tasks">tarefas</span>
</div>
</div>
</div>
</div>
<div class="form-row">
<div class="col-12">
<div class="input-group mb-3">
<div class="input-group-prepend">
<span class="input-group-text" data-i18n="backlog_complexity_label">Complexidade</span>
</div>
<select class="form-control"
        id="backlogComplexity"
        title="Multiplicadores aplicados ao backlog com base na complexidade do escopo"
        onchange="recalculateBacklog()">
<option value="clear_understood"
        data-i18n="complexity_clear"
        data-low-multiplier="1"
        data-high-multiplier="1"
        selected>Escopo claro e entendido (1× / 1×)</option>
<option value="somewhat_understood"
        data-i18n="complexity_somewhat"
        data-low-multiplier="1"
        data-high-multiplier="1.5">Parcialmente entendido (1× / 1,5×)</option>
<option value="not_really_understood"
        data-i18n="complexity_not_really"
        data-low-multiplier="1.5"
        data-high-multiplier="2">Ainda pouco entendido (1,5× / 2×)</option>
<option value="very_unclear"
        data-i18n="complexity_very_unclear"
        data-low-multiplier="1.75"
        data-high-multiplier="3">Muito incerto (1,75× / 3×)</option>
</select>
</div>
</div>
</div>
<small class="form-text text-muted" id="backlogRangeHint" data-i18n="backlog_range_hint">Informe valores mínimos e máximos e escolha a complexidade para ajustarmos automaticamente o backlog.</small>
<small class="form-text text-warning" id="backlogRangeWarning"></small>
<div class="alert alert-light border py-2 px-3 mb-0" id="backlogAdjustedSummary" role="alert" data-i18n="backlog_adjusted_summary_placeholder">Backlog ajustado será exibido aqui.</div>
<input id="numberOfTasks" name="numberOfTasks" type="hidden" value="1"/>
</div>
<div class="form-group w-100">
<label class="font-weight-bold d-block mb-1"
       data-doc-tooltip="Ajuste o quanto do throughput disponível será realmente aplicado neste trabalho."
       data-doc-anchor="focus">
    <span data-i18n="team_focus_label">Foco do time neste trabalho</span>
    <a class="doc-hint-icon" href="https://flow-forecaster.fly.dev/documentacao#focus" target="_blank" rel="noopener noreferrer" aria-label="Abrir documentação relacionada em nova aba" data-toggle="tooltip" data-placement="top" data-toggle="tooltip" data-placement="top" title="Ajuste o quanto do throughput disponível será realmente aplicado neste trabalho."><i class="fas fa-circle-question" aria-hidden="true"></i></a>
</label>
<div class="d-flex align-items-center mb-2">
<input class="custom-range flex-grow-1"
       id="teamFocusPercent"
       min="25"
       max="100"
       step="5"
       type="range"
       value="100"/>
<span class="badge badge-primary ml-3 px-3 py-2" id="teamFocusDisplay">100%</span>
</div>
<div class="btn-group btn-group-sm mb-2" role="group" aria-label="Team focus presets">
<button class="btn btn-outline-secondary team-focus-preset active" data-focus="100" type="button">100%</button>
<button class="btn btn-outline-secondary team-focus-preset" data-focus="75" type="button">75%</button>
<button class="btn btn-outline-secondary team-focus-preset" data-focus="50" type="button">50%</button>
<button class="btn btn-outline-secondary team-focus-preset" data-focus="25" type="button">25%</button>
</div>
<small class="form-text text-muted" data-i18n="team_focus_hint">Use quando o time dividir atenção com outras frentes. O throughput será multiplicado por este percentual.</small>
<input id="teamFocus" name="teamFocus" type="hidden" value="1"/>
</div>
<div class="input-group mb-3">
<div class="input-group-prepend">
<span class="input-group-text"
      data-i18n="historical_team_size_label"
      data-i18n-title="historical_team_size_tooltip"
      data-doc-tooltip="Informe quantas pessoas estavam ativas quando você coletou o throughput histórico. Isso permite ajustar simulações caso o time atual seja diferente."
      data-doc-anchor="coleta-de-dados">
    Tamanho histórico da equipe
<a class="doc-hint-icon" href="https://flow-forecaster.fly.dev/documentacao#coleta-de-dados" target="_blank" rel="noopener noreferrer" aria-label="Abrir documentação relacionada em nova aba" data-toggle="tooltip" data-placement="top" data-toggle="tooltip" data-placement="top" title="Informe quantas pessoas estavam ativas quando você coletou o throughput histórico. Isso permite ajustar simulações caso o time atual seja diferente."><i class="fas fa-circle-question" aria-hidden="true"></i></a></span>
</div>
<input class="form-control"
       id="historicalTeamSize"
       max="9999"
       min="1"
       title="Tamanho da equipe na época do throughput histórico (default: 1)"
       type="number"
       value="1"
       placeholder="1"/>
<div class="input-group-append">
<span class="input-group-text" data-i18n="contributors">contribuidores</span>
</div>
</div>
</div>
<div class="col-sm-6 text-left">
<h3 data-i18n="simulation_props">Propriedades da Simulação</h3>
<div class="input-group mb-3">
<div class="input-group-prepend">
<span class="input-group-text"
      data-doc-tooltip="Quanto maior o número de simulações, mais estável o resultado. Recomendamos pelo menos 10.000 execuções para cenários confiáveis."
      data-i18n-tooltip="tooltip_num_simulations"
      data-doc-anchor="1-simulacao-monte-carlo">
    <span data-i18n="num_simulations">Número de simulações<a class="doc-hint-icon" href="https://flow-forecaster.fly.dev/documentacao#1-simulacao-monte-carlo" target="_blank" rel="noopener noreferrer" aria-label="Abrir documentação relacionada em nova aba" data-toggle="tooltip" data-placement="top" data-toggle="tooltip" data-placement="top" title="Quanto maior o número de simulações, mais estável o resultado. Recomendamos pelo menos 10.000 execuções para cenários confiáveis."><i class="fas fa-circle-question" aria-hidden="true"></i></a></span><span style="color:red">*</span>
</span>
</div>
<input class="form-control"
       id="numberOfSimulations"
       max="10000000"
       min="10000"
       required="required"
       title="Quantidade de execuções na simulação Monte Carlo"
       type="number"
       value="100000"/>
</div>
<div class="input-group mb-3">
<div class="input-group-prepend">
<span class="input-group-text"
      data-i18n="scurve_size"
      data-doc-tooltip="A Curva-S controla a rampa de aceleração e desaceleração do time. Ajuste para simular períodos de aquecimento ou encerramento."
      data-doc-anchor="planejamento">
    Tamanho da Curva-S
<a class="doc-hint-icon" href="https://flow-forecaster.fly.dev/documentacao#planejamento" target="_blank" rel="noopener noreferrer" aria-label="Abrir documentação relacionada em nova aba" data-toggle="tooltip" data-placement="top" data-toggle="tooltip" data-placement="top" title="A Curva-S controla a rampa de aceleração e desaceleração do time. Ajuste para simular períodos de aquecimento ou encerramento."><i class="fas fa-circle-question" aria-hidden="true"></i></a></span>
</div>
<input class="form-control"
       id="sCurveSize"
       max="50"
       min="0"
       title="Percentual de rampa de produtividade na largada e encerramento"
       type="number"
       value="20"/>
<div class="input-group-append">
<span class="input-group-text">%</span>
</div>
</div>
<div class="input-group mb-3">
<div class="input-group-prepend">
<span class="input-group-text"
      data-i18n="confidence_level"
      data-doc-tooltip="Escolha o percentil que deseja analisar (ex.: P85 = 85% de confiança). Veja como interpretar P50, P85 e P95 na documentação."
      data-doc-anchor="percentis-p50-p85-p95">
    Nível de confiança
<a class="doc-hint-icon" href="https://flow-forecaster.fly.dev/documentacao#percentis-p50-p85-p95" target="_blank" rel="noopener noreferrer" aria-label="Abrir documentação relacionada em nova aba" data-toggle="tooltip" data-placement="top" data-toggle="tooltip" data-placement="top" title="Escolha o percentil que deseja analisar (ex.: P85 = 85% de confiança). Veja como interpretar P50, P85 e P95 na documentação."><i class="fas fa-circle-question" aria-hidden="true"></i></a></span>
</div>
<input class="form-control"
       id="confidenceLevel"
       max="99"
       min="1"
       title="Percentual de confiança desejado (ex.: 85)"
       type="number"
       value="85"/>
<div class="input-group-append">
<span class="input-group-text">%</span>
</div>
</div>
<div class="input-group mb-3">
<div class="input-group-prepend">
<span class="input-group-text"
      data-i18n="start_date"
      data-doc-tooltip="Data planejada para início do trabalho. Necessária para converter semanas simuladas em datas."
      data-doc-anchor="analise-de-deadline">
    Data de início
<a class="doc-hint-icon" href="https://flow-forecaster.fly.dev/documentacao#analise-de-deadline" target="_blank" rel="noopener noreferrer" aria-label="Abrir documentação relacionada em nova aba" data-toggle="tooltip" data-placement="top" data-toggle="tooltip" data-placement="top" title="Data planejada para início do trabalho. Necessária para converter semanas simuladas em datas."><i class="fas fa-circle-question" aria-hidden="true"></i></a></span>
</div>
<input class="form-control"
       id="startDate"
       title="Data planejada para começar o trabalho"
       type="date"/>
</div>
<div class="input-group mb-3">
<div class="input-group-prepend">
<span class="input-group-text"
      data-i18n="deadline"
      data-doc-tooltip="Prazo alvo usado nas análises de deadline e ritmo restante."
      data-doc-anchor="analise-de-deadline">
    Prazo
<a class="doc-hint-icon" href="https://flow-forecaster.fly.dev/documentacao#analise-de-deadline" target="_blank" rel="noopener noreferrer" aria-label="Abrir documentação relacionada em nova aba" data-toggle="tooltip" data-placement="top" data-toggle="tooltip" data-placement="top" title="Prazo alvo usado nas análises de deadline e ritmo restante."><i class="fas fa-circle-question" aria-hidden="true"></i></a></span>
</div>
<input class="form-control"
       id="deadlineDate"
       title="Deadline desejado para conclusão"
       type="date"/>
</div>
</div>
</div>
<p class="mb-0"><i>(<span data-i18n="fields_mandatory">Campos marcados com um</span> <span style="color:red">*</span> <span data-i18n="are_mandatory">vermelho são obrigatórios</span>)</i></p>
</div>
<div class="container-fluid bg-12 text-center">
<h2 data-i18n="historical_data"
    data-doc-tooltip="Inclua métricas adicionais como Lead Time e Split Rate para aprimorar as simulações."
    data-doc-anchor="coleta-de-dados">
    Dados históricos
<a class="doc-hint-icon" href="https://flow-forecaster.fly.dev/documentacao#coleta-de-dados" target="_blank" rel="noopener noreferrer" aria-label="Abrir documentação relacionada em nova aba" data-toggle="tooltip" data-placement="top" data-toggle="tooltip" data-placement="top" title="Inclua métricas adicionais como Lead Time e Split Rate para aprimorar as simulações."><i class="fas fa-circle-question" aria-hidden="true"></i></a></h2>
<p class="text-muted mb-4" data-i18n="weekly_throughput_note">As amostras de throughput semanais são definidas na seção compartilhada acima.</p>
<div class="row">
<div class="col-sm-6">
<h4 data-i18n="task_lead_times"
    data-doc-tooltip="Lead Time corresponde ao tempo entre início e conclusão de uma tarefa. Use dias separados por vírgula ou linhas."
    data-doc-anchor="lead-time-tempo-de-ciclo">
    Lead Time de entregas
<a class="doc-hint-icon" href="https://flow-forecaster.fly.dev/documentacao#lead-time-tempo-de-ciclo" target="_blank" rel="noopener noreferrer" aria-label="Abrir documentação relacionada em nova aba" data-toggle="tooltip" data-placement="top" data-toggle="tooltip" data-placement="top" title="Lead Time corresponde ao tempo entre início e conclusão de uma tarefa. Use dias separados por vírgula ou linhas."><i class="fas fa-circle-question" aria-hidden="true"></i></a></h4>
<textarea class="form-control text-monospace"
          id="ltSamples"
          rows="4"
          title="Informe tempos de lead em dias, separados por vírgula ou linhas"></textarea>
</div>
<div class="col-sm-6">
<h4 data-i18n="projects_split_rates"
    data-doc-tooltip="Split Rate representa o quanto itens tendem a ser divididos. Use multiplicadores como 1.1 para 10% de divisão."
    data-doc-anchor="split-rate-taxa-de-divisao">
    Taxas de divisão de projetos
<a class="doc-hint-icon" href="https://flow-forecaster.fly.dev/documentacao#split-rate-taxa-de-divisao" target="_blank" rel="noopener noreferrer" aria-label="Abrir documentação relacionada em nova aba" data-toggle="tooltip" data-placement="top" data-toggle="tooltip" data-placement="top" title="Split Rate representa o quanto itens tendem a ser divididos. Use multiplicadores como 1.1 para 10% de divisão."><i class="fas fa-circle-question" aria-hidden="true"></i></a></h4>
<textarea class="form-control text-monospace"
          id="splitRateSamples"
          rows="4"
          title="Informe multiplicadores de split rate (ex.: 1.1, 1.2) separados por vírgula"></textarea>
</div>
</div>
</div>
<div class="container-fluid bg-12 text-center">
<h2 data-i18n="risks_optional"
    data-doc-tooltip="Mapeie eventos incertos para adicionar buffers probabilísticos à previsão."
    data-doc-anchor="planejamento">
    Riscos (opcional)
<a class="doc-hint-icon" href="https://flow-forecaster.fly.dev/documentacao#planejamento" target="_blank" rel="noopener noreferrer" aria-label="Abrir documentação relacionada em nova aba" data-toggle="tooltip" data-placement="top" data-toggle="tooltip" data-placement="top" title="Mapeie eventos incertos para adicionar buffers probabilísticos à previsão."><i class="fas fa-circle-question" aria-hidden="true"></i></a></h2>
<p class="text-muted" data-i18n="risks_description">
    Modele riscos discretos para adicionar buffer probabilístico à sua previsão.
    <a href="https://flow-forecaster.fly.dev/documentacao#planejamento" target="_blank" rel="noopener noreferrer">Ver exemplos</a>.
</p>
<div class="row">
<table class="table table-sm" id="risks">
<thead>
<tr class="d-flex">
<th class="col-2"
    scope="col"
    data-i18n="likelihood"
    data-doc-tooltip="Chance do risco acontecer. Trabalhe em porcentagem (0-100%)."
    data-doc-anchor="planejamento">
    Probabilidade
<a class="doc-hint-icon" href="https://flow-forecaster.fly.dev/documentacao#planejamento" target="_blank" rel="noopener noreferrer" aria-label="Abrir documentação relacionada em nova aba" data-toggle="tooltip" data-placement="top" data-toggle="tooltip" data-placement="top" title="Chance do risco acontecer. Trabalhe em porcentagem (0-100%)."><i class="fas fa-circle-question" aria-hidden="true"></i></a></th>
<th class="col-2"
    scope="col"
    data-i18n="low_impact"
    data-doc-tooltip="Impacto mínimo esperado caso o risco ocorra (ex.: tarefas extras)."
    data-doc-anchor="planejamento">
    Impacto baixo
<a class="doc-hint-icon" href="https://flow-forecaster.fly.dev/documentacao#planejamento" target="_blank" rel="noopener noreferrer" aria-label="Abrir documentação relacionada em nova aba" data-toggle="tooltip" data-placement="top" data-toggle="tooltip" data-placement="top" title="Impacto mínimo esperado caso o risco ocorra (ex.: tarefas extras)."><i class="fas fa-circle-question" aria-hidden="true"></i></a></th>
<th class="col-2"
    scope="col"
    data-i18n="medium_impact"
    data-doc-tooltip="Impacto médio mais provável caso o risco ocorra."
    data-doc-anchor="planejamento">
    Impacto médio
<a class="doc-hint-icon" href="https://flow-forecaster.fly.dev/documentacao#planejamento" target="_blank" rel="noopener noreferrer" aria-label="Abrir documentação relacionada em nova aba" data-toggle="tooltip" data-placement="top" data-toggle="tooltip" data-placement="top" title="Impacto médio mais provável caso o risco ocorra."><i class="fas fa-circle-question" aria-hidden="true"></i></a></th>
<th class="col-2"
    scope="col"
    data-i18n="high_impact"
    data-doc-tooltip="Impacto máximo estimado caso o risco ocorra."
    data-doc-anchor="planejamento">
    Impacto alto
<a class="doc-hint-icon" href="https://flow-forecaster.fly.dev/documentacao#planejamento" target="_blank" rel="noopener noreferrer" aria-label="Abrir documentação relacionada em nova aba" data-toggle="tooltip" data-placement="top" data-toggle="tooltip" data-placement="top" title="Impacto máximo estimado caso o risco ocorra."><i class="fas fa-circle-question" aria-hidden="true"></i></a></th>
<th class="col-4"
    scope="col"
    data-i18n="description"
    data-doc-tooltip="Descreva o risco e quais gatilhos ou eventos desencadeiam o impacto."
    data-doc-anchor="planejamento">
    Descrição
<a class="doc-hint-icon" href="https://flow-forecaster.fly.dev/documentacao#planejamento" target="_blank" rel="noopener noreferrer" aria-label="Abrir documentação relacionada em nova aba" data-toggle="tooltip" data-placement="top" data-toggle="tooltip" data-placement="top" title="Descreva o risco e quais gatilhos ou eventos desencadeiam o impacto."><i class="fas fa-circle-question" aria-hidden="true"></i></a></th>
</tr>
</thead>
<tbody>
<tr class="d-flex risk-row" id="risk-row-template">
<td class="col-2">
<div class="input-group mb-3">
<input class="form-control"
       max="100"
       min="1"
       name="likelihood"
       data-i18n-title="tooltip_likelihood"
       title="Probabilidade do risco acontecer (%)"
       type="number"/>
<div class="input-group-append d-none d-md-block">
<span class="input-group-text">%</span>
</div>
</div>
</td>
<td class="col-2">
<div class="input-group mb-3">
<input class="form-control"
       max="1000"
       min="0"
       name="lowImpact"
       data-i18n-title="tooltip_low_impact"
       title="Impacto mínimo em tarefas adicionais ou atraso"
       type="number"/>
<div class="input-group-append d-none d-lg-block">
<span class="input-group-text" data-i18n="tasks">tarefas</span>
</div>
</div>
</td>
<td class="col-2">
<div class="input-group mb-3">
<input class="form-control"
       max="1000"
       min="0"
       name="mediumImpact"
       data-i18n-title="tooltip_medium_impact"
       title="Impacto médio mais provável se o risco ocorrer"
       type="number"/>
<div class="input-group-append d-none d-lg-block">
<span class="input-group-text" data-i18n="tasks">tarefas</span>
</div>
</div>
</td>
<td class="col-2">
<div class="input-group mb-3">
<input class="form-control"
       max="1000"
       min="0"
       name="highImpact"
       data-i18n-title="tooltip_high_impact"
       title="Impacto máximo esperado se o risco ocorrer"
       type="number"/>
<div class="input-group-append d-none d-lg-block">
<span class="input-group-text" data-i18n="tasks">tarefas</span>
</div>
</div>
</td>
<td class="col-4"><input class="form-control"
       name="description"
       data-i18n-title="tooltip_risk_description"
       title="Descrição sucinta do risco e gatilhos associados"
       type="text"/></td>
</tr>
<tr class="d-flex" id="add-risk-row">
<td class="col-2"></td>
<td class="col-2"></td>
<td class="col-2"></td>
<td class="col-2"></td>
<td class="col-4">
<button class="btn btn-secondary btn-sm" id="addRisk" type="button" data-i18n="add_row" onclick="addRisk()">Adicionar linha</button>
</td>
</tr>
</tbody>
</table>
<div class="col-12 px-3" id="probability-report-30-days"></div>
<div class="col-12 px-3 mt-3" id="risk-summary-container" style="display: none;">
<div class="card">
<div class="card-header bg-warning text-dark">
<h5 class="mb-0">
<i class="fas fa-chart-line"></i> Análise de Impacto de Riscos
<a class="doc-hint-icon text-dark" href="#" data-toggle="tooltip" title="Sumário de riscos com impacto esperado e ranking de prioridade para mitigação"><i class="fas fa-circle-question"></i></a>
</h5>
</div>
<div class="card-body">
<div id="risk-summary-content"></div>
</div>
</div>
</div>
</div>
</div>

<!-- Dependencies Section -->
<div class="container-fluid bg-12 text-center">
            <h2 data-i18n="dependency_section_heading"
    data-doc-tooltip="Modele dependências entre projetos para entender o impacto no prazo de entrega."
    data-doc-anchor="planejamento">
    Dependências entre Projetos (opcional)
<a class="doc-hint-icon" href="https://flow-forecaster.fly.dev/documentacao#planejamento" target="_blank" rel="noopener noreferrer" aria-label="Abrir documentação relacionada em nova aba" data-toggle="tooltip" data-placement="top" data-toggle="tooltip" data-placement="top" title="Modele dependências entre projetos para entender o impacto no prazo de entrega."><i class="fas fa-circle-question" aria-hidden="true"></i></a></h2>
<p class="text-muted">
    Cada dependência DOBRA o risco de atraso! Use dados históricos para estimar probabilidades.
    <strong>Insight: Com n dependências, a chance de sucesso é 1 em 2^n</strong>
</p>
<div class="row">
<table class="table table-sm" id="dependencies">
<thead>
<tr class="d-flex">
                    <th class="col-2" scope="col" data-i18n="dependency_name_label">
                        Nome da Dependência
                    </th>
                    <th class="col-2" scope="col" data-i18n="dependency_source_label">
                        Projeto Fonte (bloqueado)
                        <a class="doc-hint-icon" href="#" data-toggle="tooltip" title="Projeto que está aguardando"><i class="fas fa-circle-question"></i></a></th>
                    <th class="col-2" scope="col" data-i18n="dependency_target_label">
                        Projeto Alvo (bloqueador)
                        <a class="doc-hint-icon" href="#" data-toggle="tooltip" title="Projeto que precisa entregar primeiro"><i class="fas fa-circle-question"></i></a></th>
<th class="col-2" scope="col"
    data-doc-tooltip="Probabilidade histórica de entrega no prazo (0-100%). Ex: se 7 de 10 entregas foram no prazo, use 70%">
    Prob. On-Time (%)
<a class="doc-hint-icon" href="#" data-toggle="tooltip" title="Ex: se 7 de 10 entregas foram no prazo, use 70"><i class="fas fa-circle-question"></i></a></th>
<th class="col-2" scope="col"
    data-doc-tooltip="Impacto em dias se a dependência atrasar">
    Atraso (dias)
<a class="doc-hint-icon" href="#" data-toggle="tooltip" title="Dias de atraso se falhar"><i class="fas fa-circle-question"></i></a></th>
                    <th class="col-2" scope="col" data-i18n="dependency_criticality_label">
                        Criticidade
                    </th>
<th class="col-1" scope="col">
    Ações
</th>
</tr>
</thead>
<tbody>
<tr class="d-flex dependency-row" id="dependency-row-template">
<td class="col-2">
                    <input class="form-control form-control-sm" name="dependency_name" placeholder="Ex: API Service" type="text"/>
                </td>
                <td class="col-2">
                    <input class="form-control form-control-sm" name="dependency_source_project" placeholder="Ex: Mobile App" type="text" title="Projeto que depende (bloqueado)"/>
                </td>
                <td class="col-2">
                    <input class="form-control form-control-sm" name="dependency_target_project" placeholder="Ex: Backend Team" type="text" title="Projeto do qual depende (bloqueador)"/>
                </td>
<td class="col-2">
<input class="form-control form-control-sm" name="dep_probability" placeholder="50" type="number" min="0" max="100" value="50" title="Se 7 de 10 entregas foram no prazo, use 70"/>
</td>
<td class="col-2">
<input class="form-control form-control-sm" name="dep_delay" placeholder="10" type="number" min="0" value="10" title="Dias de atraso se falhar"/>
</td>
<td class="col-2">
                    <select class="form-control form-control-sm" name="dependency_criticality" title="Nível de impacto no projeto">
<option value="LOW">Baixa</option>
<option value="MEDIUM" selected>Média</option>
<option value="HIGH">Alta</option>
<option value="CRITICAL">Crítica</option>
</select>
</td>
<td class="col-1">
<button class="btn btn-danger btn-sm remove-dependency" type="button" title="Remover esta dependência" onclick="$(this).closest('.dependency-row').remove();">
<i class="fas fa-trash-alt"></i>
</button>
</td>
</tr>
<tr class="d-flex" id="add-dependency-row">
<td class="col-2"></td>
<td class="col-2"></td>
<td class="col-2"></td>
<td class="col-2"></td>
<td class="col-2"></td>
<td class="col-2"></td>
<td class="col-1">
<button class="btn btn-success btn-sm" id="addDependency" type="button" title="Adicionar nova dependência" onclick="addDependency()">
<i class="fas fa-plus"></i> Adicionar
</button>
</td>
</tr>
</tbody>
</table>
</div>
</div>

<div class="container-fluid bg-12 text-center">
<button class="btn btn-primary" id="run" type="button" data-i18n="run_simulation" onclick="runSimulation()">Executar a simulação!</button>
<button class="btn btn-secondary" id="share" title="Share simulation" type="button" data-i18n="share" onclick="share()">Compartilhar</button>
<button class="btn btn-success" id="saveForecast" type="button" title="Salvar análise atual" onclick="openSaveModal()"><i class="fas fa-save"></i> Salvar</button>
<button class="btn btn-info" id="loadForecast" type="button" title="Carregar análise salva" onclick="openLoadModal()"><i class="fas fa-folder-open"></i> Carregar</button>
</div>
<div class="container-fluid bg-12 text-center" id="results-main" style="display:none">
<h2 data-i18n="results_title">Resultados da Simulação</h2>
<div class="col-sm-4 text-left">
<h4 id="res-summary-header" data-i18n="forecast_summary">Resumo da previsão do projeto:</h4>
<div class="input-group mb-1">
<div class="input-group-prepend">
<span class="input-group-text font-weight-bold" data-i18n="effort">Esforço:</span>
</div>
<input class="form-control" id="res-effort" readonly="" type="text"/>
<div class="input-group-append">
<span class="input-group-text" data-i18n="person_weeks">pessoa-semanas</span>
</div>
</div>
<div class="input-group mb-1">
<div class="input-group-prepend">
<span class="input-group-text font-weight-bold" data-i18n="duration">Duração:</span>
</div>
<input class="form-control" id="res-duration" readonly="" type="text"/>
<div class="input-group-append">
<span class="input-group-text" data-i18n="calendar_weeks">semanas corridas</span>
</div>
</div>
<div class="input-group mb-1">
<div class="input-group-prepend">
<span class="input-group-text font-weight-bold" data-i18n="delivery_date">Data de entrega:</span>
</div>
<input class="form-control" id="res-endDate" readonly="" type="text"/>
</div>
</div>
<div class="card card-body text-left mb-4">
    <h4 class="mb-3">Horizonte personalizado</h4>
    <div class="form-row">
        <div class="col-sm-3">
            <label for="forecastHorizonValue" class="font-weight-bold">Valor</label>
            <input class="form-control" id="forecastHorizonValue" type="number" min="1" value="30" />
        </div>
        <div class="col-sm-3">
            <label for="forecastHorizonUnit" class="font-weight-bold">Unidade</label>
            <select class="form-control" id="forecastHorizonUnit">
                <option value="days" selected>Dias</option>
                <option value="weeks">Semanas</option>
            </select>
        </div>
        <div class="col-sm-6 d-flex align-items-end">
            <p class="text-muted mb-0">A projeção de itens abaixo usará esse horizonte após você executar novamente a simulação.</p>
        </div>
    </div>
</div>
<h3 data-i18n="all_probabilities">Todas as probabilidades</h3>
<div class="row">
<table class="table table-sm" id="probabilities">
<thead>
<tr class="d-flex probabilities-header">
<th class="col-2" scope="col" data-i18n="likelihood">Probabilidade</th>
<th class="col-1" scope="col" data-i18n="effort">Esforço</th>
<th class="col-1" scope="col" data-i18n="duration">Duração</th>
<th class="col-2" scope="col" data-i18n="num_tasks">Número de tarefas</th>
<th class="col-3" scope="col" data-i18n="date">Data</th>
<th class="col-3" scope="col" data-i18n="comment">Comentário</th>
</tr>
</thead>
<tbody>
<tr class="d-flex probabilities-row">
<td class="col-2"></td>
<td class="col-1"></td>
<td class="col-1"></td>
<td class="col-2"></td>
<td class="col-3"></td>
<td class="col-3"></td>
</tr>
<tr class="d-flex" id="show-more-row">
<td class="col-2"></td>
<td class="col-1"></td>
<td class="col-1"></td>
<td class="col-2"></td>
<td class="col-3"></td>
<td class="col-3">
<button class="btn btn-secondary btn-sm" id="show-more" type="button" data-i18n="show_more">Mostrar mais...</button>
</td>
</tr>
</tbody>
</table>
</div>
<div class="card card-body text-left mb-4">
    <h4 class="mb-3">Acompanhamento real (opcional)</h4>
    <div class="form-row">
        <div class="col-md-8">
            <label for="actualRemainingSeries" class="font-weight-bold">Backlog remanescente por semana</label>
            <textarea class="form-control text-monospace" id="actualRemainingSeries" rows="5" placeholder="Ex.: 2024-01-05, 45
2024-01-12, 42
2024-01-19, 38"></textarea>
            <small class="form-text text-muted">Use um valor por linha. Você pode informar apenas números ou pares data, valor.</small>
        </div>
        <div class="col-md-4">
            <div class="alert alert-secondary mb-0">
                <p class="mb-1"><strong>Como usar?</strong></p>
                <ul class="pl-3 mb-0" style="list-style: disc;">
                    <li>Valores mais antigos em cima.</li>
                    <li>Datas são opcionais.</li>
                    <li>Sobrepomos essa série aos burndowns previstos.</li>
                </ul>
            </div>
        </div>
    </div>
</div>
<h3 data-i18n="charts">Gráficos</h3>
<canvas id="res-duration-histogram"></canvas>
<canvas id="res-burn-downs"></canvas>
<canvas id="res-effort-scatter-plot"></canvas>

<!-- Dependency Analysis Results -->
<div id="dependency-results" style="display:none; margin-top: 30px;">
<h3>📊 Análise de Dependências</h3>
<div class="row" style="margin-bottom: 20px;">
<div class="col-md-3">
<div class="card text-center">
<div class="card-body">
<h6 class="card-subtitle mb-2 text-muted">Prob. On-Time</h6>
<h3 class="card-title" id="dep-on-time-prob" style="color: #dc3545;">-</h3>
<p class="small text-muted" id="dep-odds-ratio">-</p>
</div>
</div>
</div>
<div class="col-md-3">
<div class="card text-center">
<div class="card-body">
<h6 class="card-subtitle mb-2 text-muted">Atraso Esperado</h6>
<h3 class="card-title" id="dep-expected-delay" style="color: #ffc107;">-</h3>
<p class="small text-muted">Média dos cenários</p>
</div>
</div>
</div>
<div class="col-md-3">
<div class="card text-center">
<div class="card-body">
<h6 class="card-subtitle mb-2 text-muted">Nível de Risco</h6>
<h3 class="card-title" id="dep-risk-level" style="color: #6c757d;">-</h3>
<p class="small text-muted" id="dep-risk-score">-</p>
</div>
</div>
</div>
<div class="col-md-3">
<div class="card text-center">
<div class="card-body">
<h6 class="card-subtitle mb-2 text-muted">Total Dependências</h6>
<h3 class="card-title" id="dep-total" style="color: #17a2b8;">-</h3>
<p class="small text-muted">Removendo 1 dobra a chance!</p>
</div>
</div>
</div>
</div>
<div class="row">
<div class="col-md-6">
<h5>🎯 Caminho Crítico</h5>
<ul id="dep-critical-path" class="list-group">
</ul>
</div>
<div class="col-md-6">
<h5>💡 Recomendações</h5>
<ul id="dep-recommendations" class="list-group">
</ul>
</div>
</div>
</div>

<h3 data-i18n="simulation_report">Relatório da simulação</h3>
<textarea class="col-sm-12 text-monospace" id="results" readonly="" rows="23"></textarea>
</div>
<div class="container-fluid bg-12 text-left mt-4" id="input-stats" style="display:none">
<h3 class="input-stats-title" data-i18n="input_stats">Estatísticas de entrada</h3>
<div class="input-stats-content"></div>
</div>
</div>
</div>
<div aria-labelledby="tab-advanced-link" class="tab-pane fade" id="advanced-forecast" role="tabpanel">
<div class="pt-4 pb-5">
<div class="container text-center">
<h2 data-i18n="advanced_forecasting"
    data-doc-tooltip="Combine Monte Carlo e Machine Learning para cenários híbridos. Requer pelo menos 8 semanas de throughput."
    data-doc-anchor="2-machine-learning">
    Previsão Avançada
<a class="doc-hint-icon" href="https://flow-forecaster.fly.dev/documentacao#2-machine-learning" target="_blank" rel="noopener noreferrer" aria-label="Abrir documentação relacionada em nova aba" data-toggle="tooltip" data-placement="top" data-toggle="tooltip" data-placement="top" title="Combine Monte Carlo e Machine Learning para cenários híbridos. Requer pelo menos 8 semanas de throughput."><i class="fas fa-circle-question" aria-hidden="true"></i></a></h2>
<p class="mb-4" data-i18n="advanced_description">
                            Combine previsões de aprendizado de máquina com simulações de throughput Monte Carlo para perspectivas mais ricas.
                            Forneça pelo menos oito amostras de throughput para desbloquear projeções baseadas em ML.
                        </p>
</div>
<div class="container-fluid bg-6 text-center">
<div class="row">
<div class="col-sm-6 text-left">
<h3 data-i18n="historical_data_title"
    data-doc-tooltip="Garanta pelo menos 8 semanas de throughput para habilitar os modelos de Machine Learning."
    data-doc-anchor="2-machine-learning">
    Dados Históricos
<a class="doc-hint-icon" href="https://flow-forecaster.fly.dev/documentacao#2-machine-learning" target="_blank" rel="noopener noreferrer" aria-label="Abrir documentação relacionada em nova aba" data-toggle="tooltip" data-placement="top" data-toggle="tooltip" data-placement="top" title="Garanta pelo menos 8 semanas de throughput para habilitar os modelos de Machine Learning."><i class="fas fa-circle-question" aria-hidden="true"></i></a></h3>
<div class="form-group">
<label data-doc-tooltip="Utilize a mesma série histórica usada nas simulações base. É a entrada fundamental para treinar os modelos."
       data-doc-anchor="throughput-vazao">
    <span data-i18n="weekly_throughput_label">Throughput Semanal</span><span style="color:red">*</span>
<a class="doc-hint-icon" href="https://flow-forecaster.fly.dev/documentacao#throughput-vazao" target="_blank" rel="noopener noreferrer" aria-label="Abrir documentação relacionada em nova aba" data-toggle="tooltip" data-placement="top" data-toggle="tooltip" data-placement="top" title="Utilize a mesma série histórica usada nas simulações base. É a entrada fundamental para treinar os modelos."><i class="fas fa-circle-question" aria-hidden="true"></i></a></label>
<div class="alert alert-secondary mb-3" role="alert">
                                        <span data-i18n="uses_shared_samples">Usa as amostras de throughput compartilhadas definidas acima.</span>
                                        <a class="alert-link scroll-to-throughput" href="#tpSamples" data-i18n="edit_data_link">Editar dados</a>
</div>
<small class="form-text text-muted" data-i18n="min_8_ml">Mínimo de 8 valores necessários para previsão ML.</small>
</div>
<div class="form-group">
<label for="startDateAdv"
       data-i18n="start_date_label"
       data-doc-tooltip="Define o marco inicial utilizado nos gráficos e projeções temporais do modelo."
       data-doc-anchor="analise-de-deadline">
    Data de Início
<a class="doc-hint-icon" href="https://flow-forecaster.fly.dev/documentacao#analise-de-deadline" target="_blank" rel="noopener noreferrer" aria-label="Abrir documentação relacionada em nova aba" data-toggle="tooltip" data-placement="top" data-toggle="tooltip" data-placement="top" title="Define o marco inicial utilizado nos gráficos e projeções temporais do modelo."><i class="fas fa-circle-question" aria-hidden="true"></i></a></label>
<input class="form-control"
       id="startDateAdv"
       type="date"
       title="Data de referência para projeções avançadas"/>
</div>
</div>
<div class="col-sm-6 text-left">
<h3 data-i18n="forecast_params"
    data-doc-tooltip="Controle quantas semanas projetar e qual algoritmo o ensemble utilizará."
    data-doc-anchor="2-machine-learning">
    Parâmetros de Previsão
<a class="doc-hint-icon" href="https://flow-forecaster.fly.dev/documentacao#2-machine-learning" target="_blank" rel="noopener noreferrer" aria-label="Abrir documentação relacionada em nova aba" data-toggle="tooltip" data-placement="top" data-toggle="tooltip" data-placement="top" title="Controle quantas semanas projetar e qual algoritmo o ensemble utilizará."><i class="fas fa-circle-question" aria-hidden="true"></i></a></h3>
<div class="form-group">
<label for="forecastSteps"
       data-i18n="forecast_steps_label"
       data-doc-tooltip="Quantidade de semanas futuras que o modelo irá prever. Ajuste conforme o horizonte desejado."
       data-doc-anchor="2-machine-learning">
    Passos de Previsão (semanas)
<a class="doc-hint-icon" href="https://flow-forecaster.fly.dev/documentacao#2-machine-learning" target="_blank" rel="noopener noreferrer" aria-label="Abrir documentação relacionada em nova aba" data-toggle="tooltip" data-placement="top" data-toggle="tooltip" data-placement="top" title="Quantidade de semanas futuras que o modelo irá prever. Ajuste conforme o horizonte desejado."><i class="fas fa-circle-question" aria-hidden="true"></i></a></label>
<input class="form-control"
       id="forecastSteps"
       max="12"
       min="1"
       type="number"
       value="4"
       title="Horizonte de previsão em semanas"/>
</div>
<div class="form-group">
<label for="backlog"
       data-i18n="backlog_tasks_label"
       data-doc-tooltip="Quantidade de itens que você deseja projetar usando o ensemble ML + MC."
       data-doc-anchor="backlog">
    Backlog (tarefas)
<a class="doc-hint-icon" href="https://flow-forecaster.fly.dev/documentacao#backlog" target="_blank" rel="noopener noreferrer" aria-label="Abrir documentação relacionada em nova aba" data-toggle="tooltip" data-placement="top" data-toggle="tooltip" data-placement="top" title="Quantidade de itens que você deseja projetar usando o ensemble ML + MC."><i class="fas fa-circle-question" aria-hidden="true"></i></a></label>
<input class="form-control"
       id="backlog"
       max="10000"
       min="1"
       type="number"
       value="50"
       title="Backlog alvo para a previsão avançada"/>
</div>
<div class="form-group">
<label for="nSimulations"
       data-i18n="mc_simulations_label"
       data-doc-tooltip="Total de execuções Monte Carlo que compõem a parte probabilística do cenário combinado."
       data-doc-anchor="1-simulacao-monte-carlo">
    Simulações Monte Carlo
<a class="doc-hint-icon" href="https://flow-forecaster.fly.dev/documentacao#1-simulacao-monte-carlo" target="_blank" rel="noopener noreferrer" aria-label="Abrir documentação relacionada em nova aba" data-toggle="tooltip" data-placement="top" data-toggle="tooltip" data-placement="top" title="Total de execuções Monte Carlo que compõem a parte probabilística do cenário combinado."><i class="fas fa-circle-question" aria-hidden="true"></i></a></label>
<input class="form-control"
       id="nSimulations"
       max="100000"
       min="1000"
       type="number"
       value="10000"
       title="Número de simulações usadas no modo combinado"/>
<div class="form-check mt-2" style="padding-left: 0;">
    <input class="form-check-input" type="checkbox" id="workshopMode" style="margin-left: 0; position: relative;">
    <label class="form-check-label" for="workshopMode" style="margin-left: 1.5rem; color: #28a745;">
        <i class="fas fa-bolt"></i> <strong>Modo Fast</strong> (2.000 simulações - 5x mais rápido)
    </label>
    <small class="form-text text-muted" style="margin-left: 1.5rem;">
        Ideal para simulações rápidas. Resultados ainda confiáveis.
    </small>
</div>
</div>
</div>
</div>
</div>
<div class="container-fluid bg-12 text-center">
<button class="btn btn-primary btn-lg" id="runCombined" type="button" data-i18n="run_combined">Executar Previsão Combinada</button>
<button class="btn btn-success" id="runML" type="button" data-i18n="ml_only">Apenas Previsão ML</button>
</div>
<div class="container-fluid text-center" id="loading" style="display:none">
<div class="spinner-border text-primary" role="status">
<span class="sr-only" data-i18n="loading">Carregando...</span>
</div>
<p data-i18n="running_forecast">Executando previsão... Isso pode levar alguns segundos.</p>
</div>
<div id="results-container" style="display:none">
<div class="container-fluid" id="ml-results" style="display:none">
<h3 data-i18n="ml_forecast_title">Previsão de Aprendizado de Máquina</h3>
<div class="results-panel">
<h4 data-i18n="risk_assessment_title">Avaliação de Risco</h4>
<div id="risk-assessment"></div>
</div>
<div class="results-panel">
<h4 data-i18n="model_performance_title">Desempenho do Modelo</h4>
<div id="model-performance"></div>
</div>
<div class="chart-container">
<h4 data-i18n="ml_ensemble_forecast">Previsão de Ensemble ML</h4>
<img alt="ML Forecast Chart" id="ml-chart" src=""/>
</div>
<div class="chart-container">
<h4 data-i18n="historical_data_analysis">Análise de Dados Históricos</h4>
<img alt="Historical Analysis" id="history-chart" src=""/>
</div>
</div>
<div class="container-fluid" id="mc-results" style="display:none">
<h3 data-i18n="monte_carlo_simulation">Simulação Monte Carlo</h3>
<div class="results-panel">
<h4 data-i18n="completion_time_stats">Estatísticas de Tempo de Conclusão</h4>
<div id="mc-stats"></div>
</div>
<div class="chart-container">
<h4 data-i18n="monte_carlo_simulations">Simulações Monte Carlo</h4>
<img alt="Monte Carlo Chart" id="mc-chart" src=""/>
</div>
</div>
<div class="container-fluid" id="comparison-results" style="display:none">
<h3 data-i18n="forecast_comparison">Comparação de Previsão</h3>
<div class="chart-container">
<h4 data-i18n="ml_vs_mc">ML vs Monte Carlo Comparação</h4>
<img alt="Comparison Chart" id="comparison-chart" src=""/>
</div>
<div class="results-panel">
<div class="row">
<div class="col-md-6">
<h5 data-i18n="ml_forecast_summary">Resumo de Previsão ML</h5>
<div id="ml-summary"></div>
</div>
<div class="col-md-6">
<h5 data-i18n="mc_summary">Resumo Monte Carlo</h5>
<div id="mc-summary"></div>
</div>
</div>
</div>
</div>
<div class="mt-4" id="advanced-input-stats" style="display:none">
<h4 class="input-stats-title" data-i18n="input_stats">Estatísticas de entrada</h4>
<div class="input-stats-content"></div>
</div>
<div class="container-fluid mt-4" id="walk-forward-results" style="display:none">
<h3 data-i18n="walk_forward_validation">Validação Walk-forward</h3>
<div class="alert alert-info small">
                                Validação com janela deslizante utilizando os últimos 20% das amostras. Os erros são calculados a cada origem de previsão respeitando o parâmetro <strong>Forecast Steps</strong>.
                            </div>
<div class="table-responsive mb-3" id="walk-forward-metrics"></div>
<div class="row" id="walk-forward-charts"></div>
</div>
</div>
</div>
</div>
<div aria-labelledby="tab-demand-link" class="tab-pane fade" id="demand-forecast" role="tabpanel">
<div class="pt-4 pb-5">
<div class="container-fluid bg-6 text-center" id="demand-forecast-section">
<h2 class="mb-3">
    🧠 Previsão de Demanda com ML
<a class="doc-hint-icon" href="https://flow-forecaster.fly.dev/documentacao#2-machine-learning" target="_blank" rel="noopener noreferrer" aria-label="Abrir documentação relacionada em nova aba" data-toggle="tooltip" data-placement="top" data-toggle="tooltip" data-placement="top" title="Utilize as datas históricas das demandas para treinar modelos de machine learning e projetar o volume futuro."><i class="fas fa-circle-question" aria-hidden="true"></i></a></h2>
<p class="text-muted mb-4">
    Cole as datas de criação das demandas (uma por linha) e o Flow Forecaster irá agregar os dados, treinar modelos de machine learning
    e gerar projeções diárias e semanais com intervalos de confiança.
</p>

<div class="row">
<div class="col-md-6 text-left">
<h3>Entradas</h3>
<div class="form-group">
<label for="demandDates">Datas de chegada das demandas</label>
<textarea class="form-control text-monospace" id="demandDates" rows="8" placeholder="Exemplos:
2024-01-03
2024-01-04
05/01/2024 14:30
2024-01-06T09:10:00"></textarea>
<small class="form-text text-muted">
    Aceita formatos ISO (<code>YYYY-MM-DD</code>) ou datas brasileiras (<code>DD/MM/AAAA</code>). Informe uma data por linha.
</small>
</div>
<div class="form-row">
<div class="form-group col-md-6">
<label for="demandForecastDays">Horizonte diário (dias)</label>
<input class="form-control" id="demandForecastDays" type="number" min="1" max="60" value="14" title="Número de dias futuros para prever"/>
</div>
<div class="form-group col-md-6">
<label for="demandForecastWeeks">Horizonte semanal (semanas)</label>
<input class="form-control" id="demandForecastWeeks" type="number" min="1" max="20" value="8" title="Número de semanas futuras para prever"/>
</div>
</div>
<div class="form-group form-check">
<input class="form-check-input" id="demandExcludeWeekends" type="checkbox"/>
<label class="form-check-label" for="demandExcludeWeekends">Ignorar sábados e domingos</label>
</div>
<button class="btn btn-primary btn-lg" id="runDemandForecast" type="button">
<i class="fas fa-robot"></i> Gerar Forecast de Demanda
</button>
<div class="mt-3 alert alert-danger" id="demand-forecast-error" style="display:none" role="alert"></div>
</div>
<div class="col-md-6 text-left">
<h3>Dicas rápidas</h3>
<ul class="list-unstyled mb-0">
<li><i class="fas fa-check text-success"></i> Use pelo menos 60 dias de histórico para obter previsões estáveis.</li>
<li><i class="fas fa-check text-success"></i> Você pode remover finais de semana marcando a opção de exclusão.</li>
<li><i class="fas fa-check text-success"></i> Combine com Monte Carlo quando o risco for alto.</li>
</ul>
</div>
</div>

<div class="text-center mt-4" id="demand-forecast-loading" style="display:none">
<div class="spinner-border text-primary" role="status">
<span class="sr-only">Carregando...</span>
</div>
<p class="mt-2 mb-0">Treinando modelos e calculando previsões...</p>
</div>

<div class="mt-4" id="demand-forecast-results" style="display:none">
<div class="results-panel">
<h4>Resumo histórico</h4>
<div id="demand-history-summary"></div>
</div>

<div class="row">
<div class="col-lg-6">
<div class="results-panel">
<h4>Risco (diário)</h4>
<div id="demand-daily-risk"></div>
</div>
</div>
<div class="col-lg-6" id="demand-weekly-panels" style="display:none">
<div class="results-panel">
<h4>Risco (semanal)</h4>
<div id="demand-weekly-risk"></div>
</div>
</div>
</div>

<div class="chart-container" id="demand-daily-chart-container">
<h4>Série histórica e forecast diário</h4>
<img alt="Previsão diária de demanda" id="demand-daily-chart" src=""/>
</div>

<div class="chart-container" id="demand-weekly-chart-container" style="display:none">
<h4>Forecast semanal</h4>
<img alt="Previsão semanal de demanda" id="demand-weekly-chart" src=""/>
</div>

<div class="results-panel">
<h4>Métricas dos modelos (diário)</h4>
<div id="demand-model-performance"></div>
</div>

<div class="results-panel">
<h4>Forecast diário</h4>
<div id="demand-daily-table"></div>
</div>

<div class="results-panel" id="demand-weekly-table-wrapper" style="display:none">
<h4>Forecast semanal</h4>
<div id="demand-weekly-table"></div>
</div>
</div>
</div>
</div>
</div>
<div aria-labelledby="tab-deadline-link" class="tab-pane fade" id="deadline-analysis" role="tabpanel">
<div class="pt-4 pb-5">
<div class="container text-center">
<h2 data-i18n="deadline_analysis"
    data-doc-tooltip="Verifique se tempo disponível cobre o backlog planejado usando Monte Carlo e Machine Learning."
    data-doc-anchor="analise-de-deadline">
    Análise de Prazo
<a class="doc-hint-icon" href="https://flow-forecaster.fly.dev/documentacao#analise-de-deadline" target="_blank" rel="noopener noreferrer" aria-label="Abrir documentação relacionada em nova aba" data-toggle="tooltip" data-placement="top" data-toggle="tooltip" data-placement="top" title="Verifique se tempo disponível cobre o backlog planejado usando Monte Carlo e Machine Learning."><i class="fas fa-circle-question" aria-hidden="true"></i></a></h2>
<p class="mb-4" data-i18n="deadline_reuse_desc">
                            Reutilize suas entradas de simulação e riscos existentes para avaliar se o prazo pode ser alcançado.
                            Certifique-se de que os campos Data de início e Prazo no formulário Monte Carlo estejam preenchidos.
                        </p>
</div>
<div class="container-fluid bg-12 text-center">
<div class="alert alert-info d-inline-block text-left" role="alert">
<strong data-i18n="how_it_works">Como funciona</strong>: <span data-i18n="how_works_desc">executamos a simulação Monte Carlo completa com seus riscos e configurações de equipe,
                            depois comparamos os percentis de conclusão projetados com o prazo selecionado. O previsor de Aprendizado de Máquina
                            também é executado quando pelo menos oito amostras de throughput estão disponíveis.</span>
                        </div>
<div class="mt-3">
<button class="btn btn-primary btn-lg" id="runDeadlineAnalysis" type="button" data-i18n="run_deadline_analysis">
                                Executar Análise de Prazo
                            </button>
</div>
</div>
<div class="mt-4" id="deadline-analysis-loading" style="display:none">
<div class="spinner-border text-primary" role="status">
<span class="sr-only" data-i18n="loading">Carregando...</span>
</div>
<p class="mt-2" data-i18n="running_simulations">Executando simulações de prazo...</p>
</div>
<div class="mt-4" id="deadline-analysis-panels" style="display:none">
<ul class="nav nav-tabs nav-fill mb-3" id="deadlineResultsTabs" role="tablist">
<li class="nav-item">
<a class="nav-link active" id="deadline-summary-tab" data-toggle="tab" href="#deadline-results-summary" role="tab">Resumo</a>
</li>
<li class="nav-item" id="deadline-start-tab-item" style="display:none">
<a class="nav-link" id="deadline-start-tab" data-toggle="tab" href="#deadline-start-window" role="tab">Quando começar?</a>
</li>
</ul>
<div class="tab-content">
<div class="tab-pane fade show active" id="deadline-results-summary" role="tabpanel">
</div>
<div class="tab-pane fade" id="deadline-start-window" role="tabpanel">
<div class="mb-3">
<div class="alert alert-secondary d-inline-block">
<strong>Hoje:</strong> <span id="current-date-display" class="font-weight-bold"></span>
</div>
</div>
<div class="table-responsive">
<table class="table table-sm table-bordered">
<thead class="table-light">
<tr>
<th>Intervalo</th>
<th>Data de início</th>
<th>Até</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr class="table-warning">
<th scope="row">Muito cedo</th>
<td id="window-too-early"></td>
<td colspan="1"></td>
<td id="window-too-early-status"></td>
</tr>
<tr class="table-warning">
<th scope="row">Cedo</th>
<td id="window-early-start"></td>
<td id="window-early-end"></td>
<td id="window-early-status"></td>
</tr>
<tr class="table-success">
<th scope="row" data-i18n="just_in_time">Just in time</th>
<td id="window-just-start"></td>
<td id="window-just-end"></td>
<td id="window-just-status"></td>
</tr>
<tr class="table-warning">
<th scope="row">Tarde</th>
<td id="window-late-start"></td>
<td id="window-late-end"></td>
<td id="window-late-status"></td>
</tr>
<tr class="table-danger">
<th scope="row">Último momento responsável (UMR)</th>
<td id="window-umr"></td>
<td colspan="1"></td>
<td id="window-umr-status"></td>
</tr>
<tr class="table-danger">
<th scope="row">Irresponsavelmente atrasado</th>
<td colspan="2" id="window-too-late"></td>
<td id="window-too-late-status"></td>
</tr>
</tbody>
</table>
</div>
<small class="text-muted d-block text-left">DDE = Data Desejada de Entrega · UMR = Último Momento Responsável</small>
</div>
</div>
</div>
</div>
</div>
<div aria-labelledby="tab-historical-link" class="tab-pane fade" id="historical-charts" role="tabpanel">
<div class="pt-4 pb-5">
<div class="container text-center">
<h2 data-i18n="historical_throughput_lead">Gráficos Históricos de Throughput e Lead Time</h2>
<p class="mb-4" data-i18n="visualize_distribution">Visualize a distribuição e estabilidade das amostras fornecidas. Atualize os campos acima para atualizar esses gráficos.</p>
</div>
<div class="container mb-4">
<div class="card">
<div class="card-header bg-info text-white">
<h5 class="mb-0" data-i18n="process_behavior_chart_title">📊 Process Behavior Charts (Gráficos de Controle Estatístico)</h5>
</div>
<div class="card-body">
<p data-i18n="process_behavior_chart_description">
Os gráficos de controle utilizam limites estatísticos baseados no método de <strong>Moving Range</strong> para distinguir entre variação natural e sinais especiais no processo.
</p>
<div class="row">
<div class="col-md-6">
<h6 data-i18n="control_limits_title">Limites de Controle:</h6>
<ul class="text-left">
<li><strong>UCL</strong> (Limite Superior): <span data-i18n="ucl_description">Média + 2.66 × Moving Range</span></li>
<li><strong>Linha Central</strong>: <span data-i18n="mean_description">Média do processo</span></li>
<li><strong>LCL</strong> (Limite Inferior): <span data-i18n="lcl_description">Média - 2.66 × Moving Range</span></li>
</ul>
</div>
<div class="col-md-6">
<h6 data-i18n="special_signals_title">Sinais Especiais (pontos em vermelho):</h6>
<ul class="text-left">
<li><span data-i18n="beyond_limits">🔴 Pontos além dos limites de controle</span></li>
<li><span data-i18n="shift_pattern">🔴 8+ pontos consecutivos acima ou abaixo da média (mudança no processo)</span></li>
</ul>
</div>
</div>
<p class="mt-2 mb-0 text-muted small" data-i18n="process_behavior_note">
<em>Nota: Sinais especiais indicam que o processo pode ter mudado e requer investigação. Processos estáveis apresentam apenas variação natural.</em>
</p>
</div>
</div>
</div>
<div class="container-fluid">
<div class="row">
<div class="col-lg-6 mb-4">
<div class="card h-100">
<div class="card-header bg-primary text-white">
<h5 class="mb-0" data-i18n="throughput_histogram_title">Histograma de Throughput</h5>
</div>
<div class="card-body">
<div class="alert alert-info" id="tp-histogram-empty" role="alert" style="display:none;" data-i18n="min_3_samples_histogram">
Forneça ao menos 3 amostras de throughput para gerar o histograma.
</div>
<div class="chart-container" id="tp-histogram-container">
<canvas id="tp-histogram-chart"></canvas>
</div>
</div>
</div>
</div>
<div class="col-lg-6 mb-4">
<div class="card h-100">
<div class="card-header bg-secondary text-white">
<h5 class="mb-0" data-i18n="throughput_control_title">Process Behavior Chart - Throughput</h5>
</div>
<div class="card-body">
<div class="alert alert-info" id="tp-control-empty" role="alert" style="display:none;" data-i18n="min_samples_control">
Forneça ao menos 2 amostras de throughput para gerar o gráfico de controle estatístico.
</div>
<div class="chart-container" id="tp-control-container">
<canvas id="tp-control-chart"></canvas>
</div>
</div>
</div>
</div>
</div>
<div class="row">
<div class="col-lg-6 mb-4">
<div class="card h-100">
<div class="card-header bg-success text-white">
<h5 class="mb-0" data-i18n="lead_time_histogram_title">Histograma de Lead Time</h5>
</div>
<div class="card-body">
<div class="alert alert-info" id="lt-histogram-empty" role="alert" style="display:none;" data-i18n="min_3_samples_lt_histogram">
Forneça ao menos 3 amostras de lead time para gerar o histograma.
</div>
<div class="chart-container" id="lt-histogram-container">
<canvas id="lt-histogram-chart"></canvas>
</div>
</div>
</div>
</div>
<div class="col-lg-6 mb-4">
<div class="card h-100">
<div class="card-header bg-dark text-white">
<h5 class="mb-0" data-i18n="lead_time_control_title">Process Behavior Chart - Lead Time</h5>
</div>
<div class="card-body">
<div class="alert alert-info" id="lt-control-empty" role="alert" style="display:none;" data-i18n="min_samples_lt_control">
Forneça ao menos 2 amostras de lead time para gerar o gráfico de controle estatístico.
</div>
<div class="chart-container" id="lt-control-container">
<canvas id="lt-control-chart"></canvas>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div aria-labelledby="tab-cost-link" class="tab-pane fade" id="cost-analysis" role="tabpanel">
<div class="pt-4 pb-5">
<div class="container text-center">
<h2 data-i18n="cost_analysis_title"
    data-doc-tooltip="Estime investimentos combinando esforço projetado e distribuição PERT-Beta."
    data-doc-anchor="analise-de-custos">
    Análise de Custos
<a class="doc-hint-icon" href="https://flow-forecaster.fly.dev/documentacao#analise-de-custos" target="_blank" rel="noopener noreferrer" aria-label="Abrir documentação relacionada em nova aba" data-toggle="tooltip" data-placement="top" data-toggle="tooltip" data-placement="top" title="Estime investimentos combinando esforço projetado e distribuição PERT-Beta."><i class="fas fa-circle-question" aria-hidden="true"></i></a></h2>
<p class="mb-4" data-i18n="cost_analysis_desc">
                            Calcule custos do projeto baseados em esforço (pessoa-semanas) ou use distribuição PERT-Beta com estimativas otimista, mais provável e pessimista.
                        </p>
</div>

<!-- COST BY PERSON-WEEK SECTION -->
<div class="container-fluid bg-6 text-center mb-5">
<h2 class="mb-3"
    data-doc-tooltip="Converta esforço em moeda definindo um valor semanal por pessoa. Ideal para budgets rápidos."
    data-doc-anchor="custo-por-pessoa-semana">
    💰 Custo por Pessoa-Semana
<a class="doc-hint-icon" href="https://flow-forecaster.fly.dev/documentacao#custo-por-pessoa-semana" target="_blank" rel="noopener noreferrer" aria-label="Abrir documentação relacionada em nova aba" data-toggle="tooltip" data-placement="top" data-toggle="tooltip" data-placement="top" title="Converta esforço em moeda definindo um valor semanal por pessoa. Ideal para budgets rápidos."><i class="fas fa-circle-question" aria-hidden="true"></i></a></h2>
<p class="text-muted mb-4">
    Calcule custos baseados no esforço projetado (pessoa-semanas) × custo semanal por pessoa.
    <a href="https://flow-forecaster.fly.dev/documentacao#custo-por-pessoa-semana" target="_blank" rel="noopener noreferrer">Ver guia</a>.
</p>

<div class="row">
<div class="col-md-6 text-left">
<h3 data-doc-tooltip="Defina o valor semanal e, opcionalmente, informe um esforço fixo para obter custos de referência."
    data-doc-anchor="custo-por-pessoa-semana">
    Parâmetros de Custo
<a class="doc-hint-icon" href="https://flow-forecaster.fly.dev/documentacao#custo-por-pessoa-semana" target="_blank" rel="noopener noreferrer" aria-label="Abrir documentação relacionada em nova aba" data-toggle="tooltip" data-placement="top" data-toggle="tooltip" data-placement="top" title="Defina o valor semanal e, opcionalmente, informe um esforço fixo para obter custos de referência."><i class="fas fa-circle-question" aria-hidden="true"></i></a></h3>
<div class="form-group">
<label for="costPerPersonWeek"
       data-doc-tooltip="Inclua salário, encargos e overhead semanal por pessoa para estimar o investimento."
       data-doc-anchor="custo-por-pessoa-semana">
    Custo por Pessoa-Semana (R$)
<a class="doc-hint-icon" href="https://flow-forecaster.fly.dev/documentacao#custo-por-pessoa-semana" target="_blank" rel="noopener noreferrer" aria-label="Abrir documentação relacionada em nova aba" data-toggle="tooltip" data-placement="top" data-toggle="tooltip" data-placement="top" title="Inclua salário, encargos e overhead semanal por pessoa para estimar o investimento."><i class="fas fa-circle-question" aria-hidden="true"></i></a></label>
<div class="input-group">
<div class="input-group-prepend">
<span class="input-group-text">R$</span>
</div>
<input class="form-control" id="costPerPersonWeek" min="0" step="100" type="number" value="5000" placeholder="5000"/>
</div>
<small class="form-text text-muted">
    Custo semanal por pessoa (salário + encargos + overhead). Consulte a <a href="https://flow-forecaster.fly.dev/documentacao#custo-por-pessoa-semana" target="_blank" rel="noopener noreferrer">documentação</a>.
</small>
</div>

<div class="form-group">
<label for="effortPersonWeeks"
       data-doc-tooltip="Você pode informar um esforço manual ou reaproveitar os percentis da simulação Monte Carlo."
       data-doc-anchor="custo-por-pessoa-semana">
    Esforço Estimado (pessoa-semanas)
<a class="doc-hint-icon" href="https://flow-forecaster.fly.dev/documentacao#custo-por-pessoa-semana" target="_blank" rel="noopener noreferrer" aria-label="Abrir documentação relacionada em nova aba" data-toggle="tooltip" data-placement="top" data-toggle="tooltip" data-placement="top" title="Você pode informar um esforço manual ou reaproveitar os percentis da simulação Monte Carlo."><i class="fas fa-circle-question" aria-hidden="true"></i></a></label>
<div class="input-group">
<input class="form-control" id="effortPersonWeeks" min="0" step="0.1" type="number" placeholder="Ex: 54.0"/>
<div class="input-group-append">
<span class="input-group-text">pessoa-semanas</span>
</div>
</div>
<small class="form-text text-muted">Ou use as projeções da simulação Monte Carlo</small>
</div>
</div>

<div class="col-md-6 text-left">
<h3 data-doc-tooltip="Os percentis de esforço simulados alimentam automaticamente os cálculos de custo."
    data-doc-anchor="analise-de-custos">
    Projeções Monte Carlo
<a class="doc-hint-icon" href="https://flow-forecaster.fly.dev/documentacao#analise-de-custos" target="_blank" rel="noopener noreferrer" aria-label="Abrir documentação relacionada em nova aba" data-toggle="tooltip" data-placement="top" data-toggle="tooltip" data-placement="top" title="Os percentis de esforço simulados alimentam automaticamente os cálculos de custo."><i class="fas fa-circle-question" aria-hidden="true"></i></a></h3>
<div class="alert alert-info">
<p class="mb-2"><strong>Para usar projeções Monte Carlo:</strong></p>
<ol class="mb-0 pl-3">
<li>Execute a simulação na aba <strong>Monte Carlo</strong></li>
<li>Os valores de esforço (P50, P85, P95) serão automaticamente usados</li>
<li>Os custos serão calculados para cada percentil</li>
</ol>
</div>

<div class="form-group">
<label data-doc-tooltip="Valor proveniente da aba Monte Carlo. Ajuste lá para ver o reflexo nesta análise."
       data-doc-anchor="custo-por-pessoa-semana">
    Tamanho da Equipe
<a class="doc-hint-icon" href="https://flow-forecaster.fly.dev/documentacao#custo-por-pessoa-semana" target="_blank" rel="noopener noreferrer" aria-label="Abrir documentação relacionada em nova aba" data-toggle="tooltip" data-placement="top" data-toggle="tooltip" data-placement="top" title="Valor proveniente da aba Monte Carlo. Ajuste lá para ver o reflexo nesta análise."><i class="fas fa-circle-question" aria-hidden="true"></i></a></label>
<div class="alert alert-secondary mb-0">
Usa o tamanho da equipe definido na aba Monte Carlo
</div>
</div>
</div>
</div>

<hr class="my-4">

<!-- PERT-Beta Effort Estimation -->
<div class="row">
<div class="col-12 text-left">
<h3 data-doc-tooltip="Modele esforço usando três estimativas (a, m, b) e deixe a simulação derivar percentis via distribuição PERT-Beta."
    data-doc-anchor="distribuicao-pert-beta">
    <i class="fas fa-chart-line"></i> Estimativa PERT-Beta de Esforço (Opcional)
<a class="doc-hint-icon" href="https://flow-forecaster.fly.dev/documentacao#distribuicao-pert-beta" target="_blank" rel="noopener noreferrer" aria-label="Abrir documentação relacionada em nova aba" data-toggle="tooltip" data-placement="top" data-toggle="tooltip" data-placement="top" title="Modele esforço usando três estimativas (a, m, b) e deixe a simulação derivar percentis via distribuição PERT-Beta."><i class="fas fa-circle-question" aria-hidden="true"></i></a></h3>
<p class="text-muted">
    Use estimativas otimista, mais provável e pessimista para simular o esforço do projeto com distribuição PERT-Beta.
    <a href="https://flow-forecaster.fly.dev/documentacao#distribuicao-pert-beta" target="_blank" rel="noopener noreferrer">Aprenda como calibrar</a>.
</p>
</div>
</div>

<div class="row">
<div class="col-md-4 text-left">
<div class="form-group">
<label for="effortOptimistic"
       data-doc-tooltip="Melhor cenário possível: quando tudo flui sem bloqueios."
       data-doc-anchor="distribuicao-pert-beta">
    Esforço Otimista (a)
<a class="doc-hint-icon" href="https://flow-forecaster.fly.dev/documentacao#distribuicao-pert-beta" target="_blank" rel="noopener noreferrer" aria-label="Abrir documentação relacionada em nova aba" data-toggle="tooltip" data-placement="top" data-toggle="tooltip" data-placement="top" title="Melhor cenário possível: quando tudo flui sem bloqueios."><i class="fas fa-circle-question" aria-hidden="true"></i></a></label>
<div class="input-group">
<input class="form-control" id="effortOptimistic" min="0" step="0.1" type="number" placeholder="Ex: 30.0"/>
<div class="input-group-append">
<span class="input-group-text">pessoa-semanas</span>
</div>
</div>
<small class="form-text text-muted">Melhor cenário possível</small>
</div>
</div>

<div class="col-md-4 text-left">
<div class="form-group">
<label for="effortMostLikely"
       data-doc-tooltip="Estimativa mais realista baseada no histórico recente."
       data-doc-anchor="distribuicao-pert-beta">
    Esforço Mais Provável (m)
<a class="doc-hint-icon" href="https://flow-forecaster.fly.dev/documentacao#distribuicao-pert-beta" target="_blank" rel="noopener noreferrer" aria-label="Abrir documentação relacionada em nova aba" data-toggle="tooltip" data-placement="top" data-toggle="tooltip" data-placement="top" title="Estimativa mais realista baseada no histórico recente."><i class="fas fa-circle-question" aria-hidden="true"></i></a></label>
<div class="input-group">
<input class="form-control" id="effortMostLikely" min="0" step="0.1" type="number" placeholder="Ex: 50.0"/>
<div class="input-group-append">
<span class="input-group-text">pessoa-semanas</span>
</div>
</div>
<small class="form-text text-muted">Cenário mais realista</small>
</div>
</div>

<div class="col-md-4 text-left">
<div class="form-group">
<label for="effortPessimistic"
       data-doc-tooltip="Cenário pessimista considerando bloqueios ou baixa disponibilidade."
       data-doc-anchor="distribuicao-pert-beta">
    Esforço Pessimista (b)
<a class="doc-hint-icon" href="https://flow-forecaster.fly.dev/documentacao#distribuicao-pert-beta" target="_blank" rel="noopener noreferrer" aria-label="Abrir documentação relacionada em nova aba" data-toggle="tooltip" data-placement="top" data-toggle="tooltip" data-placement="top" title="Cenário pessimista considerando bloqueios ou baixa disponibilidade."><i class="fas fa-circle-question" aria-hidden="true"></i></a></label>
<div class="input-group">
<input class="form-control" id="effortPessimistic" min="0" step="0.1" type="number" placeholder="Ex: 80.0"/>
<div class="input-group-append">
<span class="input-group-text">pessoa-semanas</span>
</div>
</div>
<small class="form-text text-muted">Pior cenário possível</small>
</div>
</div>
</div>

<div class="row">
<div class="col-md-6 text-left">
<div class="form-group">
<label for="effortSimulations">Número de Simulações PERT</label>
<input class="form-control" id="effortSimulations" max="100000" min="10000" type="number" value="10000" placeholder="10000"/>
<small class="form-text text-muted">Mínimo: 10.000 simulações</small>
</div>
</div>
<div class="col-md-6 text-left">
<div class="alert alert-info mb-0">
<strong>Fórmula PERT</strong>: Esforço Esperado = (a + 4m + b) / 6
</div>
</div>
</div>

<div class="row mt-3">
<div class="col-12 text-center">
<button class="btn btn-success btn-lg" id="runEffortCostAnalysis" type="button">
<i class="fas fa-calculator"></i> Calcular Custos por Esforço
</button>
</div>
</div>

<!-- Effort Cost Results -->
<div class="mt-4" id="effort-cost-results" style="display:none">
<h3 class="text-center mb-4">Resultados - Custos por Pessoa-Semana</h3>
<div class="row">
<div class="col-md-4">
<div class="card">
<div class="card-header bg-info text-white">
<h5 class="mb-0">P50 (Mediana)</h5>
</div>
<div class="card-body text-center">
<h4 id="effort-cost-p50" class="text-primary">—</h4>
<small id="effort-weeks-p50" class="text-muted">—</small>
</div>
</div>
</div>
<div class="col-md-4">
<div class="card border-success">
<div class="card-header bg-success text-white">
<h5 class="mb-0">P85 (Recomendado)</h5>
</div>
<div class="card-body text-center">
<h4 id="effort-cost-p85" class="text-success">—</h4>
<small id="effort-weeks-p85" class="text-muted">—</small>
</div>
</div>
</div>
<div class="col-md-4">
<div class="card">
<div class="card-header bg-warning">
<h5 class="mb-0">P95 (Conservador)</h5>
</div>
<div class="card-body text-center">
<h4 id="effort-cost-p95" class="text-warning">—</h4>
<small id="effort-weeks-p95" class="text-muted">—</small>
</div>
</div>
</div>
</div>

<div class="row mt-3">
<div class="col-12">
<div class="card">
<div class="card-header bg-secondary text-white">
<h5 class="mb-0">Taxas de Referência</h5>
</div>
<div class="card-body">
<table class="table table-sm mb-0">
<tbody id="effort-cost-rates-table">
</tbody>
</table>
</div>
</div>
</div>
</div>

<!-- PERT-Beta Effort Histogram -->
<div class="row mt-4" id="effort-histogram-container" style="display:none">
<div class="col-12">
<div class="card">
<div class="card-header bg-primary text-white">
<h5 class="mb-0"><i class="fas fa-chart-bar"></i> Distribuição do Esforço (PERT-Beta)</h5>
</div>
<div class="card-body">
<div class="chart-container" style="position: relative; height: 400px;">
<canvas id="effort-histogram-chart"></canvas>
</div>
<small class="text-muted mt-2 d-block">
Histograma mostrando a distribuição de probabilidade do esforço estimado usando simulação Monte Carlo com distribuição PERT-Beta
</small>
</div>
</div>
</div>
</div>
</div>
</div>

<hr class="my-5">

<!-- AVERAGE DEMAND COST SECTION -->
<div class="container-fluid bg-6 text-center">
<h2 class="mb-3"
    data-doc-tooltip="Calcule custos baseados no backlog multiplicando o custo por item e projetando com distribuição PERT-Beta."
    data-doc-anchor="custo-medio-da-demanda">
    📊 Custo Médio da Demanda
<a class="doc-hint-icon" href="https://flow-forecaster.fly.dev/documentacao#custo-medio-da-demanda" target="_blank" rel="noopener noreferrer" aria-label="Abrir documentação relacionada em nova aba" data-toggle="tooltip" data-placement="top" data-toggle="tooltip" data-placement="top" title="Calcule custos baseados no backlog multiplicando o custo por item e projetando com distribuição PERT-Beta."><i class="fas fa-circle-question" aria-hidden="true"></i></a></h2>
<p class="text-muted mb-4">
    Simulação Monte Carlo com 10.000+ iterações usando distribuição PERT-Beta para estimar custos baseados no backlog.
    <a href="https://flow-forecaster.fly.dev/documentacao#custo-medio-da-demanda" target="_blank" rel="noopener noreferrer">Detalhes na documentação</a>.
</p>

<div class="row">
<div class="col-md-6 text-left">
<h3 data-i18n="cost_per_item"
    data-doc-tooltip="Informe a média histórica gasta para concluir um item de trabalho."
    data-doc-anchor="custo-medio-da-demanda">
    Custo por Item
<a class="doc-hint-icon" href="https://flow-forecaster.fly.dev/documentacao#custo-medio-da-demanda" target="_blank" rel="noopener noreferrer" aria-label="Abrir documentação relacionada em nova aba" data-toggle="tooltip" data-placement="top" data-toggle="tooltip" data-placement="top" title="Informe a média histórica gasta para concluir um item de trabalho."><i class="fas fa-circle-question" aria-hidden="true"></i></a></h3>
<div class="form-group">
<label for="avgCostPerItem"
       data-i18n="avg_cost_per_item"
       data-doc-tooltip="Use um valor médio por item considerando salários, infraestrutura e demais custos."
       data-doc-anchor="custo-medio-da-demanda">
    Custo Médio por Item
<a class="doc-hint-icon" href="https://flow-forecaster.fly.dev/documentacao#custo-medio-da-demanda" target="_blank" rel="noopener noreferrer" aria-label="Abrir documentação relacionada em nova aba" data-toggle="tooltip" data-placement="top" data-toggle="tooltip" data-placement="top" title="Use um valor médio por item considerando salários, infraestrutura e demais custos."><i class="fas fa-circle-question" aria-hidden="true"></i></a></label>
<div class="input-group">
<div class="input-group-prepend">
<span class="input-group-text">R$</span>
</div>
<input class="form-control" id="avgCostPerItem" min="0" step="0.01" type="number" placeholder="Ex: 5000.00"/>
</div>
<small class="form-text text-muted" data-i18n="avg_cost_help">
    Custo médio histórico por item de trabalho.
    <a href="https://flow-forecaster.fly.dev/documentacao#custo-medio-da-demanda" target="_blank" rel="noopener noreferrer">Ver exemplo</a>
</small>
</div>
</div>
<div class="col-md-6 text-left">
<h3 data-i18n="pert_estimates"
    data-doc-tooltip="Forneça a tripla PERT para estimar a distribuição de custo por item."
    data-doc-anchor="distribuicao-pert-beta">
    Estimativas PERT
<a class="doc-hint-icon" href="https://flow-forecaster.fly.dev/documentacao#distribuicao-pert-beta" target="_blank" rel="noopener noreferrer" aria-label="Abrir documentação relacionada em nova aba" data-toggle="tooltip" data-placement="top" data-toggle="tooltip" data-placement="top" title="Forneça a tripla PERT para estimar a distribuição de custo por item."><i class="fas fa-circle-question" aria-hidden="true"></i></a></h3>
<div class="form-group">
<label for="optimisticCost"
       data-i18n="optimistic_cost"
       data-doc-tooltip="Menor valor possível por item considerando alta eficiência."
       data-doc-anchor="distribuicao-pert-beta">
    Custo Otimista (a)
<a class="doc-hint-icon" href="https://flow-forecaster.fly.dev/documentacao#distribuicao-pert-beta" target="_blank" rel="noopener noreferrer" aria-label="Abrir documentação relacionada em nova aba" data-toggle="tooltip" data-placement="top" data-toggle="tooltip" data-placement="top" title="Menor valor possível por item considerando alta eficiência."><i class="fas fa-circle-question" aria-hidden="true"></i></a></label>
<div class="input-group">
<div class="input-group-prepend">
<span class="input-group-text">R$</span>
</div>
<input class="form-control" id="optimisticCost" min="0" step="0.01" type="number" data-i18n-placeholder="best_scenario"/>
</div>
</div>
<div class="form-group">
<label for="mostLikelyCost"
       data-i18n="most_likely_cost"
       data-doc-tooltip="Melhor estimativa baseada no histórico recente."
       data-doc-anchor="distribuicao-pert-beta">
    Custo Mais Provável (m)
<a class="doc-hint-icon" href="https://flow-forecaster.fly.dev/documentacao#distribuicao-pert-beta" target="_blank" rel="noopener noreferrer" aria-label="Abrir documentação relacionada em nova aba" data-toggle="tooltip" data-placement="top" data-toggle="tooltip" data-placement="top" title="Melhor estimativa baseada no histórico recente."><i class="fas fa-circle-question" aria-hidden="true"></i></a></label>
<div class="input-group">
<div class="input-group-prepend">
<span class="input-group-text">R$</span>
</div>
<input class="form-control" id="mostLikelyCost" min="0" step="0.01" type="number" data-i18n-placeholder="realistic_scenario"/>
</div>
</div>
<div class="form-group">
<label for="pessimisticCost"
       data-i18n="pessimistic_cost"
       data-doc-tooltip="Inclui cenários de sobrecusto, retrabalho ou contratação emergencial."
       data-doc-anchor="distribuicao-pert-beta">
    Custo Pessimista (b)
<a class="doc-hint-icon" href="https://flow-forecaster.fly.dev/documentacao#distribuicao-pert-beta" target="_blank" rel="noopener noreferrer" aria-label="Abrir documentação relacionada em nova aba" data-toggle="tooltip" data-placement="top" data-toggle="tooltip" data-placement="top" title="Inclui cenários de sobrecusto, retrabalho ou contratação emergencial."><i class="fas fa-circle-question" aria-hidden="true"></i></a></label>
<div class="input-group">
<div class="input-group-prepend">
<span class="input-group-text">R$</span>
</div>
<input class="form-control" id="pessimisticCost" min="0" step="0.01" type="number" data-i18n-placeholder="worst_scenario"/>
</div>
</div>
</div>
</div>
<div class="row mt-3">
<div class="col-md-6 text-left">
<div class="form-group">
<label for="costSimulations"
       data-i18n="num_sims"
       data-doc-tooltip="Quantidade de execuções do modelo de custo. Recomendamos 10.000 ou mais."
       data-doc-anchor="analise-de-custos">
    Número de Simulações
<a class="doc-hint-icon" href="https://flow-forecaster.fly.dev/documentacao#analise-de-custos" target="_blank" rel="noopener noreferrer" aria-label="Abrir documentação relacionada em nova aba" data-toggle="tooltip" data-placement="top" data-toggle="tooltip" data-placement="top" title="Quantidade de execuções do modelo de custo. Recomendamos 10.000 ou mais."><i class="fas fa-circle-question" aria-hidden="true"></i></a></label>
<input class="form-control" id="costSimulations" max="100000" min="10000" type="number" value="10000"/>
<small class="form-text text-muted" data-i18n="min_simulations">Mínimo: 10.000 simulações</small>
</div>
</div>
<div class="col-md-6 text-left">
<div class="form-group">
<label data-i18n="backlog"
       data-doc-tooltip="Usa automaticamente o backlog da seção Monte Carlo para calcular custo total."
       data-doc-anchor="backlog">
    Backlog
<a class="doc-hint-icon" href="https://flow-forecaster.fly.dev/documentacao#backlog" target="_blank" rel="noopener noreferrer" aria-label="Abrir documentação relacionada em nova aba" data-toggle="tooltip" data-placement="top" data-toggle="tooltip" data-placement="top" title="Usa automaticamente o backlog da seção Monte Carlo para calcular custo total."><i class="fas fa-circle-question" aria-hidden="true"></i></a></label>
<div class="alert alert-secondary mb-0" role="alert" data-i18n="uses_backlog">
                                        Usa o backlog definido na aba Monte Carlo
                                    </div>
</div>
</div>
</div>
</div>
<div class="container-fluid bg-12 text-center mt-4">
<button class="btn btn-primary btn-lg" id="runCostAnalysis" type="button" data-i18n="run_cost_analysis">
                                Executar Análise de Custos
                            </button>
</div>
<div class="mt-4" id="cost-analysis-loading" style="display:none">
<div class="spinner-border text-primary" role="status">
<span class="sr-only" data-i18n="loading">Carregando...</span>
</div>
<p class="mt-2" data-i18n="running_cost_sims">Executando simulações de custo...</p>
</div>
<div class="mt-4" id="cost-analysis-results" style="display:none">
<div class="container-fluid">
<h3 data-i18n="cost_results_title">Resultados da Simulação</h3>
<div class="row">
<div class="col-lg-6">
<div class="card mb-3">
<div class="card-header bg-primary text-white">
<h5 class="mb-0" data-i18n="cost_statistics">Estatísticas de Custo</h5>
</div>
<div class="card-body">
<table class="table table-sm table-borderless mb-0">
<tbody id="cost-stats-table">
</tbody>
</table>
</div>
</div>
</div>
<div class="col-lg-6">
<div class="card mb-3">
<div class="card-header bg-success text-white">
<h5 class="mb-0" data-i18n="scenarios">Cenários</h5>
</div>
<div class="card-body">
<table class="table table-sm table-borderless mb-0">
<tbody id="cost-scenarios-table">
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="row mt-4">
<div class="col-12">
<div class="card">
<div class="card-header bg-info text-white">
<h5 class="mb-0" data-i18n="cost_distribution">Distribuição de Custos</h5>
</div>
<div class="card-body">
<div class="chart-container">
<canvas id="cost-histogram-chart"></canvas>
</div>
</div>
</div>
</div>
</div>
<div class="row mt-4">
<div class="col-md-6">
<div class="card">
<div class="card-header bg-warning">
<h5 class="mb-0" data-i18n="cost_percentiles">Percentis de Custo</h5>
</div>
<div class="card-body">
<table class="table table-sm table-bordered">
<thead>
<tr>
<th data-i18n="percentile">Percentil</th>
<th data-i18n="cost_currency">Custo (R$)</th>
<th data-i18n="probability">Probabilidade</th>
</tr>
</thead>
<tbody id="cost-percentiles-table">
</tbody>
</table>
</div>
</div>
</div>
<div class="col-md-6">
<div class="card">
<div class="card-header bg-secondary text-white">
<h5 class="mb-0" data-i18n="pert_beta_params">Parâmetros PERT-Beta</h5>
</div>
<div class="card-body">
<table class="table table-sm table-borderless">
<tbody id="pert-params-table">
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<!-- ============================================ -->
<!-- Cost of Delay Tab -->
<!-- ============================================ -->
<div aria-labelledby="tab-cod-link" class="tab-pane fade" id="cost-of-delay" role="tabpanel">
<div class="pt-4 pb-5">
<div class="container">
<h2 class="text-center mb-4">Cost of Delay Analysis</h2>
<p class="text-center text-muted">Predict weekly delay cost using Machine Learning</p>

<!-- Model Info Alert -->
<div class="alert alert-info" role="alert">
<h5 class="alert-heading"><i class="fas fa-info-circle"></i> About the CoD Model</h5>
<p class="mb-0">
The Cost of Delay (CoD) model uses Machine Learning to predict the weekly cost of delaying a project.
The model is trained on historical project data and considers multiple factors.
</p>
<button id="showModelInfo" class="btn btn-sm btn-outline-info mt-2">Show Model Details</button>
</div>

<!-- Model Info Panel (initially hidden) -->
<div id="model-info-panel" class="card mt-3" style="display:none">
<div class="card-header bg-info text-white">
<h5 class="mb-0">Model Information</h5>
</div>
<div class="card-body">
<div id="model-info-content">
<div class="text-center">
<div class="spinner-border text-primary" role="status">
<span class="sr-only">Loading...</span>
</div>
</div>
</div>
</div>
</div>

<!-- Dataset Upload & Training -->
<div class="card mt-4">
<div class="card-header bg-secondary text-white">
<h5 class="mb-0"><i class="fas fa-database"></i> 0️⃣ Train the Model with Your Data</h5>
</div>
<div class="card-body">
<form id="codDatasetForm" enctype="multipart/form-data">
<div class="form-row align-items-end">
<div class="form-group col-md-4">
<label>Dataset name</label>
<input type="text" class="form-control" id="codDatasetName" placeholder="e.g., Projects 2024" />
</div>
<div class="form-group col-md-5">
<label>CSV file<span style="color:red">*</span></label>
<input type="file" class="form-control-file" id="codDatasetFile" accept=".csv" required />
<small class="form-text text-muted">
Include the columns: budget_millions, duration_weeks, team_size, num_stakeholders, business_value, complexity and cod_weekly (optionally project_type, risk_level).
</small>
</div>
<div class="form-group col-md-3 text-md-right">
<button type="submit" class="btn btn-primary btn-block" id="uploadCodDataset">
<i class="fas fa-upload"></i> Import CSV
</button>
</div>
</div>
</form>
<div id="codDatasetStatus" class="alert alert-light border mt-3" role="alert">
No dataset uploaded yet.
</div>
<div class="d-flex flex-column flex-md-row align-items-start align-items-md-center">
<button class="btn btn-success mr-md-3 mb-2 mb-md-0" id="trainCodModel" disabled>
<i class="fas fa-robot"></i> Train model with my data
</button>
<a href="{{ url_for('download_cod_sample') }}" class="btn btn-outline-secondary" target="_blank" rel="noopener">
<i class="fas fa-download"></i> Download sample CSV
</a>
</div>
<div id="codTrainingMessage" class="mt-3"></div>
</div>
</div>

<!-- Project Input Form -->
<div class="card mt-4">
<div class="card-header bg-primary text-white">
<h5 class="mb-0"><i class="fas fa-project-diagram"></i> 1️⃣ Project Characteristics</h5>
</div>
<div class="card-body">
<div class="row">
<div class="col-md-6">
<div class="form-group">
<label>Budget (R$ millions)<span style="color:red">*</span></label>
<input type="number" step="0.1" min="0.1" id="codBudget" class="form-control" placeholder="e.g., 2.5" required />
<small class="form-text text-muted">Project budget in millions of reais</small>
</div>
<div class="form-group">
<label>Duration (weeks)<span style="color:red">*</span></label>
<input type="number" min="1" id="codDuration" class="form-control" placeholder="e.g., 20" required />
<small class="form-text text-muted">Expected project duration</small>
</div>
<div class="form-group">
<label>Team Size<span style="color:red">*</span></label>
<input type="number" min="1" id="codTeamSize" class="form-control" placeholder="e.g., 5" required />
<small class="form-text text-muted">Number of team members</small>
</div>
</div>
<div class="col-md-6">
<div class="form-group">
<label>Number of Stakeholders<span style="color:red">*</span></label>
<input type="number" min="1" id="codStakeholders" class="form-control" placeholder="e.g., 8" required />
<small class="form-text text-muted">Total stakeholders involved</small>
</div>
<div class="form-group">
<label>Business Value (0-100)<span style="color:red">*</span></label>
<input type="number" min="0" max="100" id="codBusinessValue" class="form-control" placeholder="e.g., 75" required />
<small class="form-text text-muted">Business value score</small>
</div>
<div class="form-group">
<label>Complexity (1-5)<span style="color:red">*</span></label>
<select id="codComplexity" class="form-control" required>
<option value="">Select...</option>
<option value="1">1 - Very Low</option>
<option value="2">2 - Low</option>
<option value="3">3 - Medium</option>
<option value="4">4 - High</option>
<option value="5">5 - Very High</option>
</select>
<small class="form-text text-muted">Project complexity level</small>
</div>
</div>
</div>
<div class="row">
<div class="col-md-6">
<div class="form-group">
<label>Project Type</label>
<select id="codProjectType" class="form-control">
<option value="ERP">ERP</option>
<option value="CRM">CRM</option>
<option value="Analytics">Analytics</option>
<option value="Mobile">Mobile</option>
<option value="Web">Web</option>
</select>
<small class="form-text text-muted">Type of project</small>
</div>
</div>
<div class="col-md-6">
<div class="form-group">
<label>Risk Level (1-5)</label>
<select id="codRiskLevel" class="form-control">
<option value="1">1 - Very Low</option>
<option value="2">2 - Low</option>
<option value="3" selected>3 - Medium</option>
<option value="4">4 - High</option>
<option value="5">5 - Very High</option>
</select>
<small class="form-text text-muted">Overall risk level</small>
</div>
</div>
</div>
<div class="text-center mt-3">
<button id="predictCoD" type="button" class="btn btn-success btn-lg">
<i class="fas fa-magic"></i> Predict Cost of Delay
</button>
</div>
</div>
</div>

<!-- CoD Prediction Results -->
<div id="cod-prediction-results" class="mt-4" style="display:none">
<div class="card">
<div class="card-header bg-success text-white">
<h5 class="mb-0"><i class="fas fa-chart-bar"></i> Cost of Delay Prediction</h5>
</div>
<div class="card-body">
<div class="row">
<div class="col-md-4">
<div class="card bg-light">
<div class="card-body text-center">
<h6 class="text-primary">Weekly CoD</h6>
<h2 id="cod-weekly-value" class="text-success mb-0">-</h2>
<p class="text-muted mb-0"><small>Cost per week of delay</small></p>
</div>
</div>
</div>
<div class="col-md-4">
<div class="card bg-light">
<div class="card-body text-center">
<h6 class="text-primary">Daily CoD</h6>
<h3 id="cod-daily-value" class="text-info mb-0">-</h3>
<p class="text-muted mb-0"><small>Cost per day of delay</small></p>
</div>
</div>
</div>
<div class="col-md-4">
<div class="card bg-light">
<div class="card-body text-center">
<h6 class="text-primary">Monthly CoD</h6>
<h3 id="cod-monthly-value" class="text-warning mb-0">-</h3>
<p class="text-muted mb-0"><small>Cost per month (4.33 weeks)</small></p>
</div>
</div>
</div>
</div>
<div class="row mt-3">
<div class="col-md-12">
<div class="card bg-light">
<div class="card-body">
<h6 class="text-primary">Confidence Interval (95%)</h6>
<p id="cod-confidence-interval" class="mb-0">-</p>
<small class="text-muted">Range of predicted values</small>
</div>
</div>
</div>
</div>
</div>
</div>
</div>

<!-- Total CoD Calculator -->
<div class="card mt-4">
<div class="card-header bg-warning text-dark">
<h5 class="mb-0"><i class="fas fa-calculator"></i> 2️⃣ Total Cost of Delay Calculator</h5>
</div>
<div class="card-body">
<p class="text-muted">Calculate the total cost based on delay duration</p>
<div class="row">
<div class="col-md-6">
<div class="form-group">
<label>Weekly CoD (R$)<span style="color:red">*</span></label>
<input type="number" step="0.01" min="0" id="codWeeklyInput" class="form-control" placeholder="Will be filled from prediction" />
<small class="form-text text-muted">Will auto-fill after prediction</small>
</div>
</div>
<div class="col-md-6">
<div class="form-group">
<label>Delay Duration (weeks)<span style="color:red">*</span></label>
<input type="number" step="0.1" min="0" id="delayWeeks" class="form-control" placeholder="e.g., 4" />
<small class="form-text text-muted">How many weeks of delay</small>
</div>
</div>
</div>
<div class="text-center">
<button id="calculateTotalCoD" type="button" class="btn btn-warning">
<i class="fas fa-coins"></i> Calculate Total Cost
</button>
</div>
</div>
</div>

<!-- Total CoD Results -->
<div id="total-cod-results" class="mt-4" style="display:none">
<div class="card border-danger">
<div class="card-header bg-danger text-white">
<h5 class="mb-0"><i class="fas fa-exclamation-triangle"></i> Total Cost of Delay</h5>
</div>
<div class="card-body">
<div class="row align-items-center">
<div class="col-md-8">
<h5>Total Cost</h5>
<h1 id="total-cod-value" class="text-danger mb-0">-</h1>
</div>
<div class="col-md-4 text-right">
<p class="mb-1"><strong>Weekly CoD:</strong> <span id="total-cod-weekly">-</span></p>
<p class="mb-0"><strong>Delay:</strong> <span id="total-cod-weeks">-</span> weeks</p>
</div>
</div>
<div class="alert alert-danger mt-3 mb-0" role="alert">
<strong><i class="fas fa-exclamation-circle"></i> Impact Assessment:</strong> This represents the potential financial loss due to project delay.
Consider this when making prioritization decisions.
</div>
</div>
</div>
</div>

<!-- Feature Importance -->
<div class="card mt-4">
<div class="card-header bg-info text-white">
<h5 class="mb-0"><i class="fas fa-chart-pie"></i> 3️⃣ Feature Importance Analysis</h5>
</div>
<div class="card-body">
<p class="text-muted">See which factors most influence the CoD prediction</p>
<div class="text-center">
<button id="showFeatureImportance" type="button" class="btn btn-info">
<i class="fas fa-chart-bar"></i> Show Feature Importance
</button>
</div>
<div id="feature-importance-results" class="mt-4" style="display:none">
<div style="height: 400px;">
<canvas id="feature-importance-chart"></canvas>
</div>
<div class="table-responsive mt-3">
<table class="table table-striped">
<thead>
<tr>
<th>Feature</th>
<th>Importance</th>
<th>Impact</th>
</tr>
</thead>
<tbody id="feature-importance-table">
</tbody>
</table>
</div>
</div>
</div>
</div>

</div>
</div>
</div>
<!-- ============================================ -->
<!-- End Cost of Delay Tab -->
<!-- ============================================ -->
<div aria-labelledby="tab-trend-link" class="tab-pane fade" id="trend-analysis" role="tabpanel">
<div class="pt-4 pb-5">
<div class="container text-center">
<h2 class="mb-3"><i class="fas fa-chart-line"></i> Análise Automática de Tendências</h2>
<p class="text-muted">Com base nos dados de throughput informados, detectamos direção, sazonalidade, anomalias e projetamos ganhos potenciais.</p>
</div>
<div class="container">
<div class="alert alert-danger d-none" id="trend-analysis-error" role="alert"></div>
<div class="card mb-4">
<div class="card-body">
<div class="d-flex flex-column flex-md-row align-items-md-center justify-content-between">
<div class="mb-3 mb-md-0">
<h4 class="mb-2"><i class="fas fa-bolt text-warning"></i> Executar análise com seus dados atuais</h4>
<p class="mb-0 text-muted">Usamos os valores cadastrados no campo <strong>Throughput</strong> na aba principal para extrair tendências.</p>
</div>
<div class="text-md-right">
<button class="btn btn-primary btn-lg" id="runTrendAnalysisBtn" type="button">
<i class="fas fa-play-circle"></i> Analisar Tendências
</button>
<div class="mt-2">
<a class="small text-muted scroll-to-throughput" href="#tpSamples">
<i class="fas fa-edit"></i> Editar dados de throughput
</a>
</div>
</div>
</div>
</div>
</div>
<div class="text-center py-5 d-none" id="trend-analysis-loading">
<div class="spinner-border text-primary" role="status">
<span class="sr-only">Carregando...</span>
</div>
<p class="mt-3 text-muted mb-0">Calculando tendências, sazonalidade e alertas...</p>
</div>
<div class="d-none" id="trend-analysis-results">
    <div id="throughput-metric-section">
        <div class="mb-4">
            <h4 class="mb-1"><i class="fas fa-layer-group text-primary"></i> Resumo - Throughput</h4>
            <small class="text-muted d-block">Valores mais altos indicam melhoria</small>
        </div>
        <div class="row">
            <div class="col-lg-3 col-md-6 mb-3">
                <div class="card h-100">
                    <div class="card-body">
                        <h6 class="text-uppercase text-muted font-weight-bold">Status Geral</h6>
                        <p class="h4 mb-1" id="trend-status-value">—</p>
                        <small class="text-muted" id="trend-status-detail">—</small>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-3">
                <div class="card h-100">
                    <div class="card-body">
                        <h6 class="text-uppercase text-muted font-weight-bold">Variação Recente vs. Histórico</h6>
                        <p class="h4 mb-1" id="trend-change-value">—</p>
                        <small class="text-muted" id="trend-change-detail">—</small>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-3">
                <div class="card h-100">
                    <div class="card-body">
                        <h6 class="text-uppercase text-muted font-weight-bold">Nível de Confiança</h6>
                        <p class="h4 mb-1" id="trend-confidence-value">—</p>
                        <small class="text-muted" id="trend-confidence-detail">—</small>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-3">
                <div class="card h-100">
                    <div class="card-body">
                        <h6 class="text-uppercase text-muted font-weight-bold">Volatilidade Recente</h6>
                        <p class="h4 mb-1" id="trend-volatility-value">—</p>
                        <small class="text-muted" id="trend-volatility-detail">—</small>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-6 mb-3">
                <div class="card h-100">
                    <div class="card-header bg-light">
                        <h5 class="mb-0"><i class="fas fa-wave-square text-primary"></i> Sazonalidade</h5>
                    </div>
                    <div class="card-body" id="trend-seasonality-content">
                        <p class="text-muted mb-0">Execute a análise para detectar padrões sazonais.</p>
                    </div>
                </div>
            </div>
            <div class="col-lg-6 mb-3">
                <div class="card h-100">
                    <div class="card-header bg-light">
                        <h5 class="mb-0"><i class="fas fa-exclamation-triangle text-danger"></i> Anomalias e Volatilidade</h5>
                    </div>
                    <div class="card-body" id="trend-anomalies-content">
                        <p class="text-muted mb-0">Nenhum cálculo disponível até executar a análise.</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="card mb-4" id="tp-pbc-card">
            <div class="card-header bg-light d-flex flex-wrap justify-content-between align-items-center">
                <div>
                    <h5 class="mb-1" data-i18n="pbc_throughput_title">Process Behavior Chart · Throughput</h5>
                    <small class="text-muted" data-i18n="pbc_generic_description">
                        Calculamos média e limites de controle (UCL/LCL) com o método Moving Range (MR) para monitorar a estabilidade.
                    </small>
                </div>
                <span class="badge badge-pill badge-info" data-toggle="tooltip" data-placement="top" data-i18n="pbc_mr_badge" data-i18n-title="pbc_mr_hint" title="Aplicamos o método Moving Range (MR) para estimar a variabilidade natural.">
                    Método MR
                </span>
            </div>
            <div class="card-body">
                <div class="alert alert-light border d-none" id="tp-pbc-empty" role="alert" data-i18n="pbc_empty_message">
                    Forneça pelo menos 4 amostras para gerar o Process Behavior Chart.
                </div>
                <div class="d-none" id="tp-pbc-content">
                    <div class="row align-items-center">
                        <div class="col-lg-3 mb-3 mb-lg-0">
                            <div class="pbc-stat border rounded mb-3 p-3" data-toggle="tooltip" data-placement="top" data-i18n-title="pbc_stat_mean_hint" title="Centro esperado se o processo permanecer sob controle estatístico.">
                                <div class="text-muted text-uppercase small" data-i18n="pbc_stat_mean_label">Média do processo</div>
                                <p class="h4 mb-0" id="tp-pbc-mean">—</p>
                            </div>
                            <div class="pbc-stat border rounded mb-3 p-3" data-toggle="tooltip" data-placement="top" data-i18n-title="pbc_stat_limit_hint" title="Limites de controle = média ± 2,66 × MR (≈3 sigma).">
                                <div class="text-muted text-uppercase small" data-i18n="pbc_stat_ucl_label">Limite superior (UCL)</div>
                                <p class="h5 mb-0" id="tp-pbc-ucl">—</p>
                            </div>
                            <div class="pbc-stat border rounded p-3" data-toggle="tooltip" data-placement="top" data-i18n-title="pbc_stat_limit_hint" title="Limites de controle = média ± 2,66 × MR (≈3 sigma).">
                                <div class="text-muted text-uppercase small" data-i18n="pbc_stat_lcl_label">Limite inferior (LCL)</div>
                                <p class="h5 mb-0" id="tp-pbc-lcl">—</p>
                            </div>
                            <div class="pbc-stat border rounded p-3" data-toggle="tooltip" data-placement="top" data-i18n-title="pbc_stat_mr_hint" title="Média do Moving Range entre observações consecutivas, usada como proxy de ruído.">
                                <div class="text-muted text-uppercase small" data-i18n="pbc_stat_mr_label">MR médio</div>
                                <p class="h5 mb-0" id="tp-pbc-mr">—</p>
                            </div>
                        </div>
                        <div class="col-lg-9">
                            <div class="position-relative pbc-chart-wrapper">
                                <canvas id="tp-process-behavior-chart" height="260" aria-label="Process Behavior Chart - Throughput"></canvas>
                            </div>
                            <div class="pbc-legend d-flex flex-wrap align-items-center mt-3 small">
                                <div class="pbc-legend-item">
                                    <span class="pbc-legend-swatch bg-gradient"></span>
                                    <span data-i18n="pbc_legend_baseline">Linha média e limites UCL/LCL</span>
                                </div>
                                <div class="pbc-legend-item">
                                    <span class="pbc-legend-swatch bg-primary"></span>
                                    <span data-i18n="pbc_legend_point">Pontos dentro do controle</span>
                                </div>
                                <div class="pbc-legend-item">
                                    <span class="pbc-legend-swatch bg-danger"></span>
                                    <span data-i18n="pbc_legend_special">Pontos fora de controle</span>
                                </div>
                                <div class="pbc-legend-item">
                                    <span class="pbc-legend-swatch bg-warning"></span>
                                    <span data-i18n="pbc_legend_run">Sequência longa</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mt-3" id="tp-pbc-special-causes">
                        <h6 class="text-uppercase text-muted mb-1" data-i18n="pbc_special_causes_label">Sinais especiais</h6>
                        <p class="mb-1 small" id="tp-special-cause-summary" data-i18n="pbc_special_causes_none">Nenhum sinal especial detectado. Processo está sob controle estatístico.</p>
                        <div class="small text-muted" id="tp-special-cause-detail"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="card mb-3">
            <div class="card-header bg-light d-flex align-items-center justify-content-between">
                <h5 class="mb-0"><i class="fas fa-rocket text-success"></i> Projeções de Melhoria</h5>
                <small class="text-muted" id="trend-projection-horizon">—</small>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-sm table-striped mb-0" id="trend-projections-table">
                        <thead>
                            <tr>
                                <th>Cenário</th>
                                <th>Taxa de Melhoria</th>
                                <th>Valor em 4 períodos</th>
                                <th>Observações</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="card">
            <div class="card-header bg-light">
                <h5 class="mb-0"><i class="fas fa-bell text-danger"></i> Alertas &amp; Recomendações</h5>
            </div>
            <div class="card-body">
                <div class="list-group" id="trend-alerts-list">
                    <div class="list-group-item text-muted">Nenhum alerta gerado. Execute a análise para obter recomendações.</div>
                </div>
            </div>
        </div>
    </div>

    <div class="mt-5 d-none" id="lead-time-metric-section">
        <div class="mb-4">
            <h4 class="mb-1"><i class="fas fa-stopwatch text-info"></i> Resumo - Lead Time</h4>
            <small class="text-muted d-block">Valores menores indicam melhoria</small>
        </div>
        <div class="row">
            <div class="col-lg-3 col-md-6 mb-3">
                <div class="card h-100">
                    <div class="card-body">
                        <h6 class="text-uppercase text-muted font-weight-bold">Status Geral</h6>
                        <p class="h4 mb-1" id="lt-trend-status-value">—</p>
                        <small class="text-muted" id="lt-trend-status-detail">—</small>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-3">
                <div class="card h-100">
                    <div class="card-body">
                        <h6 class="text-uppercase text-muted font-weight-bold">Variação Recente vs. Histórico</h6>
                        <p class="h4 mb-1" id="lt-trend-change-value">—</p>
                        <small class="text-muted" id="lt-trend-change-detail">—</small>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-3">
                <div class="card h-100">
                    <div class="card-body">
                        <h6 class="text-uppercase text-muted font-weight-bold">Nível de Confiança</h6>
                        <p class="h4 mb-1" id="lt-trend-confidence-value">—</p>
                        <small class="text-muted" id="lt-trend-confidence-detail">—</small>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-3">
                <div class="card h-100">
                    <div class="card-body">
                        <h6 class="text-uppercase text-muted font-weight-bold">Volatilidade Recente</h6>
                        <p class="h4 mb-1" id="lt-trend-volatility-value">—</p>
                        <small class="text-muted" id="lt-trend-volatility-detail">—</small>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-6 mb-3">
                <div class="card h-100">
                    <div class="card-header bg-light">
                        <h5 class="mb-0"><i class="fas fa-wave-square text-primary"></i> Sazonalidade</h5>
                    </div>
                    <div class="card-body" id="lt-trend-seasonality-content">
                        <p class="text-muted mb-0">Informe tempos de lead para identificar padrões sazonais.</p>
                    </div>
                </div>
            </div>
            <div class="col-lg-6 mb-3">
                <div class="card h-100">
                    <div class="card-header bg-light">
                        <h5 class="mb-0"><i class="fas fa-exclamation-triangle text-danger"></i> Anomalias e Volatilidade</h5>
                    </div>
                    <div class="card-body" id="lt-trend-anomalies-content">
                        <p class="text-muted mb-0">Nenhum cálculo disponível até executar a análise.</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="card mb-4" id="lt-pbc-card">
            <div class="card-header bg-light d-flex flex-wrap justify-content-between align-items-center">
                <div>
                    <h5 class="mb-1" data-i18n="pbc_lead_time_title">Process Behavior Chart · Lead Time</h5>
                    <small class="text-muted" data-i18n="pbc_generic_description">
                        Calculamos média e limites de controle (UCL/LCL) com o método Moving Range (MR) para monitorar a estabilidade.
                    </small>
                </div>
                <span class="badge badge-pill badge-info" data-toggle="tooltip" data-placement="top" data-i18n="pbc_mr_badge" data-i18n-title="pbc_mr_hint" title="Aplicamos o método Moving Range (MR) para estimar a variabilidade natural.">
                    Método MR
                </span>
            </div>
            <div class="card-body">
                <div class="alert alert-light border d-none" id="lt-pbc-empty" role="alert" data-i18n="pbc_empty_message">
                    Forneça pelo menos 4 amostras para gerar o Process Behavior Chart.
                </div>
                <div class="d-none" id="lt-pbc-content">
                    <div class="row align-items-center">
                        <div class="col-lg-3 mb-3 mb-lg-0">
                            <div class="pbc-stat border rounded mb-3 p-3" data-toggle="tooltip" data-placement="top" data-i18n-title="pbc_stat_mean_hint" title="Centro esperado se o processo permanecer sob controle estatístico.">
                                <div class="text-muted text-uppercase small" data-i18n="pbc_stat_mean_label">Média do processo</div>
                                <p class="h4 mb-0" id="lt-pbc-mean">—</p>
                            </div>
                            <div class="pbc-stat border rounded mb-3 p-3" data-toggle="tooltip" data-placement="top" data-i18n-title="pbc_stat_limit_hint" title="Limites de controle = média ± 2,66 × MR (≈3 sigma).">
                                <div class="text-muted text-uppercase small" data-i18n="pbc_stat_ucl_label">Limite superior (UCL)</div>
                                <p class="h5 mb-0" id="lt-pbc-ucl">—</p>
                            </div>
                            <div class="pbc-stat border rounded p-3" data-toggle="tooltip" data-placement="top" data-i18n-title="pbc_stat_limit_hint" title="Limites de controle = média ± 2,66 × MR (≈3 sigma).">
                                <div class="text-muted text-uppercase small" data-i18n="pbc_stat_lcl_label">Limite inferior (LCL)</div>
                                <p class="h5 mb-0" id="lt-pbc-lcl">—</p>
                            </div>
                            <div class="pbc-stat border rounded p-3" data-toggle="tooltip" data-placement="top" data-i18n-title="pbc_stat_mr_hint" title="Média do Moving Range entre observações consecutivas, usada como proxy de ruído.">
                                <div class="text-muted text-uppercase small" data-i18n="pbc_stat_mr_label">MR médio</div>
                                <p class="h5 mb-0" id="lt-pbc-mr">—</p>
                            </div>
                        </div>
                        <div class="col-lg-9">
                            <div class="position-relative pbc-chart-wrapper">
                                <canvas id="lt-process-behavior-chart" height="260" aria-label="Process Behavior Chart - Lead Time"></canvas>
                            </div>
                            <div class="pbc-legend d-flex flex-wrap align-items-center mt-3 small">
                                <div class="pbc-legend-item">
                                    <span class="pbc-legend-swatch bg-gradient"></span>
                                    <span data-i18n="pbc_legend_baseline">Linha média e limites UCL/LCL</span>
                                </div>
                                <div class="pbc-legend-item">
                                    <span class="pbc-legend-swatch bg-primary"></span>
                                    <span data-i18n="pbc_legend_point">Pontos dentro do controle</span>
                                </div>
                                <div class="pbc-legend-item">
                                    <span class="pbc-legend-swatch bg-danger"></span>
                                    <span data-i18n="pbc_legend_special">Pontos fora de controle</span>
                                </div>
                                <div class="pbc-legend-item">
                                    <span class="pbc-legend-swatch bg-warning"></span>
                                    <span data-i18n="pbc_legend_run">Sequência longa</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="mt-3" id="lt-pbc-special-causes">
                        <h6 class="text-uppercase text-muted mb-1" data-i18n="pbc_special_causes_label">Sinais especiais</h6>
                        <p class="mb-1 small" id="lt-special-cause-summary" data-i18n="pbc_special_causes_none">Nenhum sinal especial detectado. Processo está sob controle estatístico.</p>
                        <div class="small text-muted" id="lt-special-cause-detail"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="card mb-3">
            <div class="card-header bg-light d-flex align-items-center justify-content-between">
                <h5 class="mb-0"><i class="fas fa-rocket text-success"></i> Projeções de Melhoria</h5>
                <small class="text-muted" id="lt-trend-projection-horizon">—</small>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-sm table-striped mb-0" id="lt-trend-projections-table">
                        <thead>
                            <tr>
                                <th>Cenário</th>
                                <th>Taxa de Melhoria</th>
                                <th>Valor em 4 períodos</th>
                                <th>Observações</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="card">
            <div class="card-header bg-light">
                <h5 class="mb-0"><i class="fas fa-bell text-danger"></i> Alertas &amp; Recomendações</h5>
            </div>
            <div class="card-body">
                <div class="list-group" id="lt-trend-alerts-list">
                    <div class="list-group-item text-muted">Nenhum alerta gerado. Execute a análise para obter recomendações.</div>
                </div>
            </div>
        </div>
    </div>
    <div class="card shadow-sm mt-4" id="pbc-education-card">
        <div class="card-header bg-dark text-white">
            <h5 class="mb-0" data-i18n="pbc_education_title">Como interpretar Process Behavior Charts</h5>
        </div>
        <div class="card-body">
            <p class="mb-3" data-i18n="pbc_education_intro">
                Use estes gráficos para separar variação comum (ruído) de causas especiais que exigem ação.
            </p>
            <ul class="mb-0 pl-3">
                <li data-i18n="pbc_education_item_limits">Pontos além dos limites quase sempre indicam causa especial — investigue imediatamente.</li>
                <li data-i18n="pbc_education_item_runs">Oito ou mais pontos do mesmo lado da média indicam mudança sustentada no processo.</li>
                <li data-i18n="pbc_education_item_react">Reaja apenas aos sinais especiais; intervir no ruído comum aumenta a variabilidade.</li>
            </ul>
        </div>
    </div>
</div>
</div>
</div>
</div>
<div aria-labelledby="tab-forecast-vs-actual" class="tab-pane fade" id="forecast-vs-actual-tab" role="tabpanel">
    <div class="pt-4 pb-5">
        <!-- Header -->
        <div class="container-fluid">
            <div class="row mb-4">
                <div class="col-12">
                    <div class="d-flex justify-content-between align-items-center flex-wrap">
                        <div class="mb-3 mb-md-0">
                            <h2 class="mb-2">
                                <i class="fas fa-balance-scale text-primary"></i>
                                Forecast vs Actual
                            </h2>
                            <p class="text-muted">
                                Compare suas previsões com os resultados reais e avalie a acurácia do modelo
                            </p>
                        </div>
                        <div>
                            <button class="btn btn-primary" data-toggle="modal" data-target="#registerActualModal">
                                <i class="fas fa-plus"></i> Registrar Resultado Real
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Loading State -->
            <div id="fva-loading-state" class="text-center" style="display: none;">
                <div class="spinner-border text-primary" role="status">
                    <span class="sr-only">Carregando...</span>
                </div>
                <p class="mt-2 text-muted">Carregando dados...</p>
            </div>

            <!-- Empty State -->
            <div id="fva-empty-state" class="card" style="display: none;">
                <div class="card-body text-center py-5">
                    <i class="fas fa-chart-bar fa-4x text-muted mb-3"></i>
                    <h3>Nenhum dado disponível</h3>
                    <p class="text-muted mb-4">
                        Comece registrando resultados reais das suas previsões para visualizar métricas de acurácia.
                    </p>
                    <button class="btn btn-primary" data-toggle="modal" data-target="#registerActualModal">
                        <i class="fas fa-plus"></i> Registrar Primeiro Resultado
                    </button>
                </div>
            </div>

            <!-- Dashboard Content -->
            <div id="fva-dashboard-content" style="display: none;">
                <!-- Summary Metrics -->
                <div class="row mb-4">
                    <div class="col-md-3 mb-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <h6 class="text-muted text-uppercase mb-2">MAPE</h6>
                                <h2 class="text-primary mb-2" id="fva-metric-mape">-</h2>
                                <span class="badge" id="fva-badge-mape">-</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <h6 class="text-muted text-uppercase mb-2">Taxa de Acurácia</h6>
                                <h2 class="text-success mb-2" id="fva-metric-accuracy">-</h2>
                                <span class="badge" id="fva-badge-accuracy">-</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <h6 class="text-muted text-uppercase mb-2">R² (Correlação)</h6>
                                <h2 class="text-info mb-2" id="fva-metric-r-squared">-</h2>
                                <span class="badge" id="fva-badge-r-squared">-</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 mb-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <h6 class="text-muted text-uppercase mb-2">Qualidade Geral</h6>
                                <h2 class="mb-2" id="fva-metric-overall">-</h2>
                                <span class="badge" id="fva-badge-overall">-</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Additional Stats -->
                <div class="row mb-4">
                    <div class="col-md-4 mb-3">
                        <div class="card">
                            <div class="card-body">
                                <h6 class="card-subtitle mb-2 text-muted">Total de Comparações</h6>
                                <h3 id="fva-total-comparisons">-</h3>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="card">
                            <div class="card-body">
                                <h6 class="card-subtitle mb-2 text-muted">Viés de Previsão</h6>
                                <h3 id="fva-bias-direction">-</h3>
                                <small class="text-muted" id="fva-bias-count">-</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="card">
                            <div class="card-body">
                                <h6 class="card-subtitle mb-2 text-muted">Erro Médio</h6>
                                <h3 id="fva-mean-error">-</h3>
                                <small class="text-muted">MAE (semanas)</small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Issues and Recommendations -->
                <div class="row mb-4">
                    <div class="col-md-6 mb-3">
                        <div class="card">
                            <div class="card-header bg-warning">
                                <h5 class="mb-0">
                                    <i class="fas fa-exclamation-triangle"></i>
                                    Alertas de Qualidade
                                </h5>
                            </div>
                            <div class="card-body" id="fva-issues-container">
                                <p class="text-muted">Nenhum alerta detectado.</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="card">
                            <div class="card-header bg-info text-white">
                                <h5 class="mb-0">
                                    <i class="fas fa-lightbulb"></i>
                                    Recomendações
                                </h5>
                            </div>
                            <div class="card-body" id="fva-recommendations-container">
                                <p class="text-muted">Nenhuma recomendação disponível.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Comparison Chart -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">
                                    <i class="fas fa-chart-line"></i>
                                    Forecast vs Actual - Últimas Comparações
                                </h5>
                            </div>
                            <div class="card-body">
                                <canvas id="fva-comparisonChart" style="max-height: 400px;"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Comparisons Table -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="mb-0">
                                    <i class="fas fa-list"></i>
                                    Comparações Recentes
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>Previsão</th>
                                                <th>Projeto</th>
                                                <th>Data</th>
                                                <th>Previsto (sem)</th>
                                                <th>Real (sem)</th>
                                                <th>Erro</th>
                                                <th>Ações</th>
                                            </tr>
                                        </thead>
                                        <tbody id="fva-comparisons-table-body">
                                            <!-- Populated by JavaScript -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Register Actual Modal -->
        <div class="modal fade" id="registerActualModal" tabindex="-1" role="dialog">
            <div class="modal-dialog modal-lg" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">
                            <i class="fas fa-plus-circle"></i>
                            Registrar Resultado Real
                        </h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form id="fva-registerActualForm">
                            <div class="form-group">
                                <label for="fva-select-forecast">Selecione a Previsão</label>
                                <select class="form-control" id="fva-select-forecast" required>
                                    <option value="">Carregando previsões...</option>
                                </select>
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="fva-actual-completion-date">Data de Conclusão Real</label>
                                        <input type="text" class="form-control" id="fva-actual-completion-date"
                                               placeholder="DD/MM/YYYY" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="fva-actual-weeks-taken">
                                            Semanas Reais <small class="text-muted">(opcional)</small>
                                        </label>
                                        <input type="number" step="0.1" class="form-control" id="fva-actual-weeks-taken">
                                        <small class="form-text text-muted">Será calculado automaticamente se vazio</small>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="fva-actual-items-completed">
                                            Itens Completados <small class="text-muted">(opcional)</small>
                                        </label>
                                        <input type="number" class="form-control" id="fva-actual-items-completed">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="fva-actual-scope-pct">
                                            % de Escopo Entregue <small class="text-muted">(opcional)</small>
                                        </label>
                                        <input type="number" step="0.1" class="form-control" id="fva-actual-scope-pct">
                                    </div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="fva-actual-notes">Observações <small class="text-muted">(opcional)</small></label>
                                <textarea class="form-control" id="fva-actual-notes" rows="3"
                                          placeholder="Notas sobre este resultado..."></textarea>
                            </div>

                            <div class="form-group">
                                <label for="fva-recorded-by">Registrado por <small class="text-muted">(opcional)</small></label>
                                <input type="text" class="form-control" id="fva-recorded-by" placeholder="Seu nome">
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                        <button type="button" class="btn btn-primary" id="fva-btn-save-actual">
                            <span id="fva-save-spinner" class="spinner-border spinner-border-sm mr-2" style="display:none;"></span>
                            Salvar
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
                <div aria-labelledby="dependency-tab-link" class="tab-pane fade" id="dependency-analysis-tab" role="tabpanel">
<div class="pt-4 pb-5">
<div class="container text-center">
<h2>📊 Análise de Impacto de Dependências</h2>
<p class="mb-4 text-muted">
Visualização completa do impacto de dependências no projeto.
Adicione dependências no formulário principal e execute a simulação para ver os resultados aqui.
</p>
</div>

<!-- Key Insight -->
<div class="container-fluid bg-6 text-center mb-4">
<div class="alert alert-info">
<h4><i class="fas fa-lightbulb"></i> Insight Chave: O Problema 2^n</h4>
<p class="mb-2">
Para cada dependência, existe uma chance de atraso. Com <strong>n dependências</strong>,
a probabilidade de todas serem entregues no prazo é de <strong>1 em 2^n</strong>.
</p>
<p class="mb-3">
<strong><i class="fas fa-exclamation-triangle"></i> Cada dependência removida DOBRA suas chances de sucesso!</strong>
</p>
<div class="row text-center">
<div class="col-md-4">
<strong>1 dependência</strong><br>50% chance (1/2)
</div>
<div class="col-md-4">
<strong>3 dependências</strong><br>12.5% chance (1/8)
</div>
<div class="col-md-4">
<strong>7 dependências</strong><br>0.78% chance (1/128)
</div>
</div>
</div>
</div>

<!-- Results Section -->
<div id="dependencyTabResults" style="display: none;">
<!-- Key Metrics -->
<div class="container-fluid bg-6 text-center mb-4">
<h3 class="mb-4"><i class="fas fa-chart-line"></i> Métricas Principais</h3>
<div class="row">
<div class="col-md-3">
<div class="card text-center mb-3 border-danger">
<div class="card-body">
<h6 class="card-subtitle mb-2 text-muted"><i class="fas fa-clock"></i> Prob. On-Time</h6>
<h3 class="card-title" id="dep-tab-on-time-prob" style="color: #dc3545;">-</h3>
<p class="small text-muted" id="dep-tab-odds-ratio">-</p>
</div>
</div>
</div>
<div class="col-md-3">
<div class="card text-center mb-3 border-warning">
<div class="card-body">
<h6 class="card-subtitle mb-2 text-muted"><i class="fas fa-hourglass-half"></i> Atraso Esperado</h6>
<h3 class="card-title" id="dep-tab-expected-delay" style="color: #ffc107;">-</h3>
<p class="small text-muted">Média dos cenários</p>
</div>
</div>
</div>
<div class="col-md-3">
<div class="card text-center mb-3 border-secondary">
<div class="card-body">
<h6 class="card-subtitle mb-2 text-muted"><i class="fas fa-shield-alt"></i> Nível de Risco</h6>
<h3 class="card-title" id="dep-tab-risk-level" style="color: #6c757d;">-</h3>
<p class="small text-muted" id="dep-tab-risk-score">-</p>
</div>
</div>
</div>
<div class="col-md-3">
<div class="card text-center mb-3 border-info">
<div class="card-body">
<h6 class="card-subtitle mb-2 text-muted"><i class="fas fa-link"></i> Total Dependências</h6>
<h3 class="card-title" id="dep-tab-total" style="color: #17a2b8;">-</h3>
<p class="small text-muted"><i class="fas fa-info-circle"></i> Removendo 1 dobra a chance!</p>
</div>
</div>
</div>
</div>
</div>

<!-- Delay Distribution -->
<div class="container-fluid bg-6 text-center mb-4">
<h3 class="mb-3"><i class="fas fa-stopwatch"></i> Distribuição de Atrasos</h3>
<div class="table-responsive">
<table class="table table-sm table-striped table-hover mb-0" id="dep-tab-delay-table">
<thead class="thead-light">
<tr>
<th scope="col" class="text-uppercase">Percentil</th>
<th scope="col">Atraso (dias)</th>
</tr>
</thead>
<tbody id="dep-tab-delay-body">
<tr>
<td colspan="2" class="text-muted">Sem dados de atraso disponíveis</td>
</tr>
</tbody>
</table>
</div>
</div>

<!-- Visualization -->
<div class="container-fluid bg-6 text-center mb-4">
<h3 class="mb-4">Visualização Completa</h3>
<div id="dep-tab-visualization-container" class="bg-white p-4 rounded">
<img id="dep-tab-visualization-image" src="" alt="Análise de Dependências" class="img-fluid rounded" style="max-width: 100%; height: auto;">
</div>
</div>

<!-- Critical Path and Recommendations -->
<div class="container-fluid bg-6 text-center mb-4">
<div class="row">
<div class="col-md-6">
<h4><i class="fas fa-exclamation-triangle"></i> Caminho Crítico</h4>
<ul id="dep-tab-critical-path" class="list-group text-left">
</ul>
</div>
<div class="col-md-6">
<h4><i class="fas fa-lightbulb"></i> Recomendações</h4>
<ul id="dep-tab-recommendations" class="list-group text-left">
</ul>
</div>
</div>
</div>
</div>

<!-- Empty State -->
<div id="dependencyTabEmpty" class="container-fluid bg-6 text-center">
<div class="alert alert-warning">
<h4><i class="fas fa-info-circle"></i> Nenhuma dependência configurada</h4>
<p>Adicione dependências no formulário principal (aba Monte Carlo) e execute a simulação para ver os resultados aqui.</p>
</div>
</div>
</div>
</div>

<!-- Dashboard & Portfolio Tab -->
<div aria-labelledby="tab-dashboard-link" class="tab-pane fade" id="executive-dashboard" role="tabpanel">
    <div class="pt-4 pb-5">
        <div class="container text-center mb-4">
            <h2><i class="fas fa-chart-pie"></i> Portfolio</h2>
            <p class="text-muted mb-0">Siga o fluxo completo: cadastre o portfólio, rode simulações, otimize e acompanhe indicadores executivos sem sair do Flow Forecaster.</p>
        </div>

        <div class="portfolio-journey">
            <section class="portfolio-step" id="portfolio-step-config">
                <div class="step-header">
                    <span class="step-badge">1</span>
                    <div>
                        <h4>Cadastro e Configuração</h4>
                        <p>Monte o portfólio de projetos, defina prioridades, cadastre riscos e mantenha o baseline organizado antes de simular.</p>
                        <p class="small text-muted mb-0">Inclui cadastro de portfólios, projetos, squads e matriz de riscos.</p>
                    </div>
                </div>
                <div class="step-actions">
                    <button class="btn btn-primary" data-frame-target="portfolio-config-frame" data-frame-url="/portfolio">
                        <i class="fas fa-eye mr-1"></i> Visualizar cadastro
                    </button>
                    <a class="btn btn-link text-primary" href="/portfolio">
                        Abrir em tela cheia
                    </a>
                </div>
                <div class="portfolio-frame-wrapper d-none" id="portfolio-config-frame-wrapper">
                    <div class="portfolio-frame-loading">
                        <div class="spinner-border text-primary" role="status"></div>
                        <span>Carregando tela de cadastro do portfólio...</span>
                    </div>
                    <div class="alert alert-danger portfolio-frame-error mt-3"></div>
                    <iframe id="portfolio-config-frame" title="Cadastro do Portfólio"></iframe>
                </div>
                <div class="mt-4">
                    <div class="d-flex flex-wrap justify-content-between align-items-center mb-3">
                        <div>
                            <h5 class="mb-1"><i class="fas fa-shield-alt text-primary mr-2"></i>Resumo de Riscos Atual</h5>
                            <p class="mb-0 text-muted small">Escolha um portfólio para visualizar o mapa de riscos, alertas e recomendações.</p>
                        </div>
                        <div class="d-flex flex-wrap align-items-center" style="gap: 0.5rem;">
                            <label class="mb-0 mr-2 text-muted small" for="risk-portfolio-select">Portfólio</label>
                            <select class="form-control form-control-sm" id="risk-portfolio-select" style="min-width: 220px;">
                                <option value="">Selecione...</option>
                            </select>
                        </div>
                    </div>
                    <div class="portfolio-risk-summary" id="portfolio-risk-content">
                        <div class="text-muted py-4 text-center">
                            <i class="fas fa-info-circle mr-2"></i>Selecione um portfólio para carregar o resumo de riscos.
                        </div>
                    </div>
                    <div class="step-actions mt-3">
                        <button class="btn btn-outline-primary" data-frame-target="portfolio-risks-frame" data-frame-url="/portfolio/risks">
                            <i class="fas fa-layer-group mr-1"></i> Abrir tela detalhada de riscos
                        </button>
                        <a class="btn btn-link text-primary" href="/portfolio/risks">
                            Abrir em tela cheia
                        </a>
                    </div>
                    <div class="portfolio-frame-wrapper d-none" id="portfolio-risks-frame-wrapper">
                        <div class="portfolio-frame-loading">
                            <div class="spinner-border text-primary" role="status"></div>
                            <span>Carregando gestão de riscos...</span>
                        </div>
                        <div class="alert alert-danger portfolio-frame-error mt-3"></div>
                        <iframe id="portfolio-risks-frame" title="Gestão de Riscos"></iframe>
                    </div>
                </div>
            </section>

            <section class="portfolio-step" id="portfolio-step-simulation">
                <div class="step-header">
                    <span class="step-badge">2</span>
                    <div>
                        <h4>Simulação e Cost of Delay</h4>
                        <p>Execute simulações Monte Carlo, compare cenários e calcule Cost of Delay com priorização WSJF.</p>
                        <p class="small text-muted mb-0">Use os botões Simular e CoD Analysis para ver resultados atualizados.</p>
                    </div>
                </div>
                <div class="step-actions">
                    <button class="btn btn-primary" data-frame-target="portfolio-simulation-frame" data-frame-url="/portfolio" data-frame-scroll="#simulationResults">
                        <i class="fas fa-play mr-1"></i> Rodar simulações aqui
                    </button>
                    <a class="btn btn-link text-primary" href="/portfolio#simulationResults">
                        Abrir em tela cheia
                    </a>
                </div>
                <div class="portfolio-frame-wrapper d-none" id="portfolio-simulation-frame-wrapper">
                    <div class="portfolio-frame-loading">
                        <div class="spinner-border text-primary" role="status"></div>
                        <span>Preparando ambiente de simulação...</span>
                    </div>
                    <div class="alert alert-danger portfolio-frame-error mt-3"></div>
                    <iframe id="portfolio-simulation-frame" title="Simulação do Portfólio e Cost of Delay"></iframe>
                </div>
            </section>

            <section class="portfolio-step" id="portfolio-step-optimize">
                <div class="step-header">
                    <span class="step-badge">3</span>
                    <div>
                        <h4>Otimização do Portfólio</h4>
                        <p>Explore WSJF, fronteira eficiente e recomendações de sequência para maximizar valor entregue.</p>
                        <p class="small text-muted mb-0">Ajuste parâmetros e exporte relatórios sob demanda.</p>
                    </div>
                </div>
                <div class="step-actions">
                    <button class="btn btn-primary" data-frame-target="portfolio-optimize-frame" data-frame-url="/portfolio/optimize">
                        <i class="fas fa-magic mr-1"></i> Visualizar otimização
                    </button>
                    <a class="btn btn-link text-primary" href="/portfolio/optimize">
                        Abrir em tela cheia
                    </a>
                </div>
                <div class="portfolio-frame-wrapper d-none" id="portfolio-optimize-frame-wrapper">
                    <div class="portfolio-frame-loading">
                        <div class="spinner-border text-primary" role="status"></div>
                        <span>Carregando ambiente de otimização...</span>
                    </div>
                    <div class="alert alert-danger portfolio-frame-error mt-3"></div>
                    <iframe id="portfolio-optimize-frame" title="Otimização de Portfólio"></iframe>
                </div>
            </section>

            <section class="portfolio-step" id="portfolio-step-dashboard">
                <div class="step-header">
                    <span class="step-badge">4</span>
                    <div>
                        <h4>Dashboard Executivo</h4>
                        <p>Acompanhe indicadores de throughput, riscos, saúde do portfólio e narrativas executivas em tempo real.</p>
                        <p class="small text-muted mb-0">Ideal para reuniões com diretoria e steering committees.</p>
                    </div>
                </div>
                <div class="step-actions">
                    <button class="btn btn-primary" data-frame-target="portfolio-dashboard-frame" data-frame-url="/portfolio/executive">
                        <i class="fas fa-chart-line mr-1"></i> Ver dashboard aqui
                    </button>
                    <a class="btn btn-link text-primary" href="/portfolio/executive">
                        Abrir em tela cheia
                    </a>
                </div>
                <div class="portfolio-frame-wrapper d-none" id="portfolio-dashboard-frame-wrapper">
                    <div class="portfolio-frame-loading">
                        <div class="spinner-border text-primary" role="status"></div>
                        <span>Carregando painel executivo...</span>
                    </div>
                    <div class="alert alert-danger portfolio-frame-error mt-3"></div>
                    <iframe id="portfolio-dashboard-frame" title="Dashboard Executivo"></iframe>
                </div>
            </section>
        </div>
    </div>
</div>

<!-- Backtesting Tab -->
<div aria-labelledby="tab-backtesting-link" class="tab-pane fade" id="backtesting-tab" role="tabpanel">
    <div class="container-fluid pt-4">
        <div class="row">
            <div class="col-12">
                <h2 class="text-center mb-4">
                    <i class="fas fa-history"></i> Backtesting
                </h2>
                <div class="alert alert-info">
                    <h5 class="alert-heading"><i class="fas fa-info-circle"></i> Sobre o Backtesting</h5>
                    <p>
                        O backtesting valida a acurácia do modelo comparando as previsões com os resultados reais.
                        Essa funcionalidade permite avaliar a qualidade das estimativas ao longo do tempo.
                    </p>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0"><i class="fas fa-chart-bar"></i> Análise de Backtesting</h5>
                    </div>
                    <div class="card-body">
                        <form id="backtestingForm">
                            <div class="form-row">
                                <div class="form-group col-md-6">
                                    <label for="backtest-project">Projeto</label>
                                    <select class="form-control" id="backtest-project" required>
                                        <option value="">Selecione um projeto...</option>
                                    </select>
                                </div>
                                <div class="form-group col-md-6">
                                    <label for="backtest-min-samples">Mínimo de Amostras</label>
                                    <input type="number" class="form-control" id="backtest-min-samples" value="5" min="3" max="50">
                                    <small class="form-text text-muted">Número mínimo de dados históricos para treinar</small>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary btn-block">
                                <i class="fas fa-play"></i> Executar Backtesting
                            </button>
                        </form>

                        <div id="backtesting-loading" class="text-center mt-4" style="display:none;">
                            <div class="spinner-border text-primary" role="status">
                                <span class="sr-only">Carregando...</span>
                            </div>
                            <p class="mt-2">Executando análise de backtesting...</p>
                        </div>

                        <div id="backtesting-results" class="mt-4" style="display:none;">
                            <h5 class="mb-3">Resultados</h5>
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="card bg-light">
                                        <div class="card-body text-center">
                                            <h6 class="text-muted">Acurácia Média</h6>
                                            <h3 class="mb-0" id="backtest-accuracy">-</h3>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="card bg-light">
                                        <div class="card-body text-center">
                                            <h6 class="text-muted">Erro Médio (%)</h6>
                                            <h3 class="mb-0" id="backtest-error">-</h3>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="card bg-light">
                                        <div class="card-body text-center">
                                            <h6 class="text-muted">Testes Realizados</h6>
                                            <h3 class="mb-0" id="backtest-count">-</h3>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-4">
                                <canvas id="backtesting-chart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<br/><br/>
</main>

<!-- Save Forecast Modal -->
<div class="modal fade" id="saveForecastModal" tabindex="-1" role="dialog" aria-labelledby="saveForecastModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="saveForecastModalLabel"><i class="fas fa-save"></i> Salvar Análise</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="saveForecastForm">
                    <div class="form-group">
                        <label for="forecastName">Nome da Análise *</label>
                        <input type="text" class="form-control" id="forecastName" required placeholder="Ex: Sprint 1 - Análise de Prazo">
                    </div>
                    <div class="form-group">
                        <label for="forecastProjectSelect">Projeto existente</label>
                        <select class="form-control" id="forecastProjectSelect">
                            <option value="">Selecione um projeto existente...</option>
                        </select>
                        <small class="form-text text-muted">
                            Use um projeto existente do portfólio ou deixe em branco para criar um novo abaixo.
                        </small>
                    </div>
                    <div class="form-group">
                        <label for="forecastDescription">Descrição</label>
                        <textarea class="form-control" id="forecastDescription" rows="3" placeholder="Informações adicionais sobre esta análise..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="projectName">Novo projeto (opcional)</label>
                        <input type="text" class="form-control" id="projectName" placeholder="Informe para criar um novo projeto">
                        <small class="form-text text-muted">
                            Este campo é usado somente se nenhum projeto existente for selecionado acima.
                        </small>
                    </div>
                    <div class="form-group">
                        <label for="forecastPortfolioSelect">Associar ao portfólio</label>
                        <select class="form-control" id="forecastPortfolioSelect">
                            <option value="">Não associar agora</option>
                        </select>
                        <small class="form-text text-muted">
                            Ao salvar, o projeto será automaticamente vinculado a este portfólio (se ainda não estiver).
                        </small>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-success" onclick="saveForecast()"><i class="fas fa-save"></i> Salvar</button>
            </div>
        </div>
    </div>
</div>

<!-- Load Forecast Modal -->
<div class="modal fade" id="loadForecastModal" tabindex="-1" role="dialog" aria-labelledby="loadForecastModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="loadForecastModalLabel"><i class="fas fa-folder-open"></i> Carregar Análise</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="card mb-3">
                    <div class="card-body">
                        <h6 class="card-title"><i class="fas fa-upload"></i> Importar de Arquivo JSON</h6>
                        <div class="input-group">
                            <div class="custom-file">
                                <input type="file" class="custom-file-input" id="importFileInput" accept=".json">
                                <label class="custom-file-label" for="importFileInput">Escolher arquivo...</label>
                            </div>
                            <div class="input-group-append">
                                <button class="btn btn-primary" type="button" onclick="importForecastFromFile()">
                                    <i class="fas fa-file-import"></i> Importar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <hr>
                <h6><i class="fas fa-database"></i> Análises Salvas</h6>
                <div id="loadingForecasts" class="text-center" style="display:none;">
                    <div class="spinner-border text-primary" role="status">
                        <span class="sr-only">Carregando...</span>
                    </div>
                </div>
                <div id="forecastsList"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
            </div>
        </div>
    </div>
</div>

<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.bundle.min.js"></script>
<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.bundle.min.js"></script>
<script>
        (function secureChartRegistration() {
            function registerCharts() {
                try {
                    if (!window.Chart || typeof window.Chart.register !== 'function' || !window.Chart.registerables) {
                        return;
                    }
                    window.Chart.register(...window.Chart.registerables);
                } catch (error) {
                    console.warn('Chart.js registration skipped:', error);
                }
            }

            if (window.Chart) {
                registerCharts();
            } else {
                document.addEventListener('chartjs:loaded', registerCharts, { once: true });
            }
        })();
    </script>
<!-- Chart.js Annotation Plugin -->
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@0.5.7/chartjs-plugin-annotation.min.js"></script>
<!-- Moment.js -->
<script src="https://cdn.jsdelivr.net/npm/moment@2.27.0/moment.min.js"></script>
<!-- Internationalization -->
<script src="{{ url_for('static', filename='js/i18n.js') }}"></script>
<!-- Custom JS -->
<script src="{{ url_for('static', filename='js/ui.js') }}?v=1761530200"></script>
<script src="{{ url_for('static', filename='js/advanced_forecast.js') }}"></script>
<script src="{{ url_for('static', filename='js/demand_forecast.js') }}"></script>
<script src="{{ url_for('static', filename='js/charts.js') }}"></script>
<script src="{{ url_for('static', filename='js/cost_analysis.js') }}"></script>
<script src="{{ url_for('static', filename='js/cost_of_delay.js') }}"></script>
<script src="{{ url_for('static', filename='js/forecast-persistence.js') }}"></script>
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
<script src="{{ url_for('static', filename='js/trend_insights.js') }}"></script>
<script>
    (function() {
        const frameCache = new Map();

        function adjustFrameHeight(frame) {
            try {
                const doc = frame.contentDocument || frame.contentWindow.document;
                if (!doc || !doc.body) return;
                const height = Math.max(doc.body.scrollHeight, 900);
                frame.style.height = height + 'px';
            } catch (error) {
                console.warn('[Portfolio Frames] Unable to adjust frame height:', error);
            }
        }

        function showError(wrapper, message) {
            const errorBox = wrapper.querySelector('.portfolio-frame-error');
            if (errorBox) {
                errorBox.style.display = 'block';
                errorBox.textContent = message;
            }
        }

        function hideError(wrapper) {
            const errorBox = wrapper.querySelector('.portfolio-frame-error');
            if (errorBox) {
                errorBox.style.display = 'none';
                errorBox.textContent = '';
            }
        }

        function toggleLoader(wrapper, isVisible) {
            const loader = wrapper.querySelector('.portfolio-frame-loading');
            if (loader) {
                loader.style.display = isVisible ? 'flex' : 'none';
            }
        }

        function loadEmbeddedFrame(frameId, url, options = {}) {
            const frame = document.getElementById(frameId);
            const wrapper = document.getElementById(`${frameId}-wrapper`);
            if (!frame || !wrapper) {
                console.warn('[Portfolio Frames] Wrapper or frame not found for', frameId);
                return;
            }

            wrapper.classList.remove('d-none');
            hideError(wrapper);

            if (frame.dataset.loaded === 'true') {
                adjustFrameHeight(frame);
                if (options.scrollSelector) {
                    try {
                        const anchor = frame.contentDocument?.querySelector(options.scrollSelector);
                        if (anchor) {
                            anchor.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        }
                    } catch (error) {
                        console.warn('[Portfolio Frames] Unable to scroll inside frame:', error);
                    }
                }
                return;
            }

            toggleLoader(wrapper, true);

            const fetchHtml = frameCache.has(url)
                ? Promise.resolve(frameCache.get(url))
                : fetch(url, { credentials: 'same-origin' })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`Falha ao carregar ${url} (HTTP ${response.status})`);
                        }
                        return response.text();
                    })
                    .then(html => {
                        frameCache.set(url, html);
                        return html;
                    });

            fetchHtml
                .then(html => {
                    frame.onload = () => {
                        frame.dataset.loaded = 'true';
                        adjustFrameHeight(frame);
                        if (options.scrollSelector) {
                            try {
                                const anchor = frame.contentDocument?.querySelector(options.scrollSelector);
                                if (anchor) {
                                    anchor.scrollIntoView({ behavior: 'smooth', block: 'start' });
                                }
                            } catch (error) {
                                console.warn('[Portfolio Frames] Unable to scroll inside frame:', error);
                            }
                        }
                        toggleLoader(wrapper, false);
                    };
                    frame.srcdoc = html;
                })
                .catch(error => {
                    console.error('[Portfolio Frames] Error loading inline view:', error);
                    toggleLoader(wrapper, false);
                    showError(wrapper, 'Erro ao carregar: ' + error.message);
                });
        }

        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('[data-frame-target]').forEach(button => {
                button.addEventListener('click', () => {
                    const frameId = button.getAttribute('data-frame-target');
                    const url = button.getAttribute('data-frame-url');
                    const scrollSelector = button.getAttribute('data-frame-scroll');
                    if (!frameId || !url) return;
                    loadEmbeddedFrame(frameId, url, { scrollSelector });
                });
            });
        });
    })();
</script>
<script>
    (function() {
        const select = document.getElementById('risk-portfolio-select');
        const summaryContainer = document.getElementById('portfolio-risk-content');
        if (!select || !summaryContainer) return;

        function setSummary(html) {
            summaryContainer.innerHTML = html;
        }

        function showLoading(message = 'Carregando análise de riscos...') {
            setSummary(`
                <div class="text-center py-4 text-muted">
                    <div class="spinner-border text-primary mb-3" role="status"></div>
                    <p class="mb-0">${message}</p>
                </div>
            `);
        }

        function showError(message) {
            setSummary(`
                <div class="alert alert-danger mb-0">
                    <i class="fas fa-exclamation-triangle mr-2"></i>${message}
                </div>
            `);
        }

        function formatCurrency(value) {
            if (!Number.isFinite(value)) return '—';
            return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL', maximumFractionDigits: 0 }).format(value);
        }

        function renderAlerts(alerts) {
            if (!Array.isArray(alerts) || !alerts.length) {
                return '<p class="text-success mb-0"><i class="fas fa-check-circle mr-1"></i>Nenhum alerta crítico registrado.</p>';
            }
            return alerts.map(alert => {
                const severity = alert.severity || 'info';
                const badgeClass = severity === 'critical' ? 'danger' : severity === 'high' ? 'warning' : severity === 'medium' ? 'info' : 'secondary';
                return `
                    <div class="alert alert-${badgeClass} mb-2">
                        <strong>${(alert.title || alert.type || 'Alerta').toUpperCase()}</strong> — ${alert.message || ''}
                        ${alert.recommendation ? `<br><small>${alert.recommendation}</small>` : ''}
                    </div>
                `;
            }).join('');
        }

        function renderRiskSummary(data) {
            if (!data || !data.metrics) {
                setSummary('<div class="text-muted">Sem dados suficientes para esta seleção.</div>');
                return;
            }

            const metrics = data.metrics;
            const levels = metrics.by_level || {};
            const costs = metrics.costs || {};
            const alerts = data.alerts || [];
            const hotspots = metrics.high_risk_categories || [];

            setSummary(`
                <div class="row">
                    <div class="col-lg-3 col-md-6">
                        <div class="risk-metric">
                            <h6>Total de riscos</h6>
                            <strong>${metrics.total_risks || 0}</strong>
                            <p class="text-muted small mb-0">Críticos: ${levels.critical || 0} • Altos: ${levels.high || 0}</p>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6">
                        <div class="risk-metric">
                            <h6>Risco médio</h6>
                            <strong>${(metrics.scores && Number.isFinite(metrics.scores.average)) ? metrics.scores.average.toFixed(1) : '—'}</strong>
                            <p class="text-muted small mb-0">Score ponderado: ${(metrics.scores && Number.isFinite(metrics.scores.weighted)) ? metrics.scores.weighted.toFixed(1) : '—'}</p>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6">
                        <div class="risk-metric">
                            <h6>Custos potenciais</h6>
                            <strong>${formatCurrency(costs.total_potential)}</strong>
                            <p class="text-muted small mb-0">EMV: ${formatCurrency(costs.expected_monetary_value)}</p>
                        </div>
                    </div>
                    <div class="col-lg-3 col-md-6">
                        <div class="risk-metric">
                            <h6>Mitigações</h6>
                            <strong>${formatCurrency(costs.total_mitigation)}</strong>
                            <p class="text-muted small mb-0">Ativos: ${metrics.by_status ? metrics.by_status.active : 0}</p>
                        </div>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-md-6">
                        <h6 class="text-uppercase text-muted small">Alertas recentes</h6>
                        ${renderAlerts(alerts)}
                    </div>
                    <div class="col-md-6">
                        <h6 class="text-uppercase text-muted small">Hotspots</h6>
                        ${hotspots.length ? `
                            <ul class="mb-0">
                                ${hotspots.map(item => `<li>${item.category}: <strong>${item.total_risks}</strong> riscos</li>`).join('')}
                            </ul>
                        ` : '<p class="text-muted">Nenhum hotspot identificado.</p>'}
                    </div>
                </div>
            `);
        }

        function loadRiskSummary(portfolioId) {
            if (!portfolioId) {
                setSummary('<div class="text-muted">Selecione um portfólio para carregar o resumo.</div>');
                return;
            }
            showLoading();
            fetch(`/api/portfolios/${portfolioId}/risks/analysis`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Falha ao carregar análise de riscos');
                    }
                    return response.json();
                })
                .then(renderRiskSummary)
                .catch(error => {
                    console.error('[Portfolio Risks] Error:', error);
                    showError(error.message || 'Erro ao carregar análise de riscos');
                });
        }

        function populateRiskPortfolios() {
            fetch('/api/portfolios')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Falha ao carregar portfólios');
                    }
                    return response.json();
                })
                .then(portfolios => {
                    select.innerHTML = '<option value="">Selecione...</option>';
                    portfolios.forEach(p => {
                        const option = document.createElement('option');
                        option.value = p.id;
                        option.textContent = `${p.name} (${p.projects_count} projetos)`;
                        select.appendChild(option);
                    });
                    if (portfolios.length) {
                        select.value = portfolios[0].id;
                        loadRiskSummary(portfolios[0].id);
                    }
                })
                .catch(error => {
                    console.error('[Portfolio Risks] Error loading portfolios:', error);
                    showError('Não foi possível carregar a lista de portfólios.');
                });
        }

        select.addEventListener('change', () => {
            const id = select.value;
            if (!id) {
                setSummary('<div class="text-muted">Selecione um portfólio para carregar o resumo.</div>');
                return;
            }
            loadRiskSummary(id);
        });

        populateRiskPortfolios();
    })();
</script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip();

            const TAB_MAP = {
                '#mc-forecast': '#tab-mc-link',
                '#advanced-forecast': '#tab-advanced-link',
                '#demand-forecast': '#tab-demand-link',
                '#deadline-analysis': '#tab-deadline-link',
                '#historical-charts': '#tab-historical-link',
                '#cost-analysis': '#tab-cost-link',
                '#cost-of-delay': '#tab-cod-link',
                '#trend-analysis': '#tab-trend-link',
                '#forecast-vs-actual': '#tab-forecast-vs-actual',
                '#forecast-vs-actual-tab': '#tab-forecast-vs-actual',
                '#dependency-analysis': '#dependency-tab-link',
                '#dependency-analysis-tab': '#dependency-tab-link',
                '#executive-dashboard': '#tab-dashboard-link',
                '#dashboard': '#tab-dashboard-link',
                '#portfolio-dashboard': '#tab-portfolio-link',
                '#portfolio': '#tab-portfolio-link',
                '#backtesting-tab': '#tab-backtesting-link',
                '#backtesting': '#tab-backtesting-link'
            };

            const DEFAULT_TAB = '#mc-forecast';

            function normalizeHash(hash) {
                if (!hash) {
                    return '';
                }
                let value = hash.trim();
                if (!value) {
                    return '';
                }
                if (!value.startsWith('#')) {
                    value = `#${value}`;
                }
                return value.toLowerCase();
            }

            function showTab(hash, options = {}) {
                const normalized = normalizeHash(hash) || normalizeHash(DEFAULT_TAB);
                const selector = TAB_MAP[normalized];

                if (!selector) {
                    console.warn('[showTab] No selector found for hash:', normalized);
                    return false;
                }

                const $tabLink = $(selector);

                if (!$tabLink.length) {
                    console.warn('[showTab] Tab link not found:', selector);
                    return false;
                }

                $tabLink.tab('show');

                if (!options.suppressHash && normalized !== normalizeHash(window.location.hash)) {
                    history.replaceState(null, '', normalized);
                }

                return true;
            }

            function handleHashChange() {
                const currentHash = normalizeHash(window.location.hash);

                if (!currentHash) {
                    showTab(DEFAULT_TAB, { suppressHash: true });
                    return;
                }

                if (!Object.prototype.hasOwnProperty.call(TAB_MAP, currentHash)) {
                    return;
                }

                if (!showTab(currentHash, { suppressHash: true })) {
                    showTab(DEFAULT_TAB, { suppressHash: true });
                }
            }

            $('#navbarsExampleDefault').on('click', 'a.nav-link[data-target]', function (event) {
                const target = $(this).data('target');
                if (typeof target === 'string' && target.startsWith('#')) {
                    event.preventDefault();
                    showTab(target);
                    $('html, body').animate({ scrollTop: $('#forecastTabs').offset().top - 70 }, 300);
                }
            });

            $('#forecastTabs').on('click', 'a.nav-link[data-toggle="tab"]', function (event) {
                const href = $(this).attr('href');
                if (typeof href === 'string' && href.startsWith('#')) {
                    event.preventDefault();
                    showTab(href);
                }
            });

            $('#forecastTabs').on('shown.bs.tab', 'a[data-toggle="tab"]', function (event) {
                const target = $(event.target).attr('href');
                if (typeof target === 'string' && target.startsWith('#')) {
                    history.replaceState(null, '', normalizeHash(target));
                }
            });

            window.addEventListener('hashchange', handleHashChange);
            $(window).on('load', handleHashChange);
            handleHashChange();
        });
    </script>
    <script src="{{ url_for('static', filename='js/forecast-vs-actual.js') }}"></script>

    <!-- Backtesting JavaScript -->
    <script>
        $(document).ready(function() {
            // Load projects on tab show
            $('#tab-backtesting-link').on('shown.bs.tab', function() {
                loadBacktestProjects();
            });

            function loadBacktestProjects() {
                $.get('/api/projects', function(data) {
                    const select = $('#backtest-project');
                    select.empty().append('<option value="">Selecione um projeto...</option>');

                    // API retorna array diretamente, não objeto com propriedade projects
                    if (Array.isArray(data) && data.length > 0) {
                        data.forEach(project => {
                            select.append(`<option value="${project.id}">${project.name}</option>`);
                        });
                    }
                }).fail(function(xhr) {
                    console.error('Erro ao carregar projetos:', xhr);
                    alert('Erro ao carregar lista de projetos: ' + (xhr.responseJSON?.error || 'Erro desconhecido'));
                });
            }

            // Handle form submission
            $('#backtestingForm').on('submit', function(e) {
                e.preventDefault();

                const projectId = $('#backtest-project').val();
                const minSamples = parseInt($('#backtest-min-samples').val());

                if (!projectId) {
                    alert('Por favor, selecione um projeto');
                    return;
                }

                // Show loading
                $('#backtesting-loading').show();
                $('#backtesting-results').hide();

                // Make API call
                $.ajax({
                    url: '/api/backtest-project',
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        project_id: parseInt(projectId),
                        min_train_size: minSamples
                    }),
                    success: function(response) {
                        displayBacktestResults(response);
                    },
                    error: function(xhr) {
                        console.error('Backtesting error:', xhr);
                        const errorMsg = xhr.responseJSON?.error || xhr.responseText || 'Erro desconhecido';
                        alert('Erro ao executar backtesting: ' + errorMsg);
                    },
                    complete: function() {
                        $('#backtesting-loading').hide();
                    }
                });
            });

            function displayBacktestResults(data) {
                // Display metrics
                const accuracy = (data.metrics?.avg_accuracy * 100 || 0).toFixed(1);
                const error = (data.metrics?.avg_error_pct || 0).toFixed(1);
                const count = data.results?.length || 0;

                $('#backtest-accuracy').text(accuracy + '%');
                $('#backtest-error').text(error + '%');
                $('#backtest-count').text(count);

                // Create chart if we have results
                if (data.results && data.results.length > 0) {
                    createBacktestChart(data.results);
                }

                $('#backtesting-results').show();
            }

            function createBacktestChart(results) {
                const ctx = document.getElementById('backtesting-chart').getContext('2d');

                // Destroy existing chart if any
                if (window.backtestChart) {
                    window.backtestChart.destroy();
                }

                const labels = results.map((_, idx) => `Test ${idx + 1}`);
                const predicted = results.map(r => r.predicted_p85);
                const actual = results.map(r => r.actual_duration);

                window.backtestChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Previsão (P85)',
                            data: predicted,
                            borderColor: 'rgb(54, 162, 235)',
                            backgroundColor: 'rgba(54, 162, 235, 0.1)',
                            tension: 0.1
                        }, {
                            label: 'Real',
                            data: actual,
                            borderColor: 'rgb(255, 99, 132)',
                            backgroundColor: 'rgba(255, 99, 132, 0.1)',
                            tension: 0.1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'Duração (semanas)'
                                }
                            },
                            x: {
                                title: {
                                    display: true,
                                    text: 'Testes de Backtesting'
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top'
                            },
                            title: {
                                display: true,
                                text: 'Previsão vs Real - Backtesting'
                            }
                        }
                    }
                });
            }
        });
    </script>
</body>
</html>

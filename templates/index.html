<!DOCTYPE html>

<html lang="pt">
<head>
<title>Flow Forecasting</title>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<!-- Google Fonts - Inter -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
<!-- Chart.js CSS -->
<link href="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.css" rel="stylesheet"/>
<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"/>
<!-- Custom CSS -->
<link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet"/>
<style>
        .navbar {
            margin-bottom: 0;
            border-radius: 0;
        }

        footer {
            background-color: #f2f2f2;
            padding: 25px;
        }

        @media (max-width: 992px) {
            .probabilities-header {
                font-size: 12px;
            }
        }

        @media (max-width: 720px) {
            .probabilities-header {
                font-size: 10px;
            }
        }

        .almost-certain {
            background-color: rgba(75, 192, 192, 0.2);
        }

        .somewhat-certain {
            background-color: rgba(255, 206, 86, 0.2);
        }

        .not-certain {
            background-color: rgba(255, 99, 132, 0.2);
        }

        .chart-container {
            margin: 30px 0;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .chart-container img {
            width: 100%;
            height: auto;
            border-radius: 4px;
        }

        .results-panel {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .metric-card {
            background: white;
            padding: 15px;
            border-radius: 6px;
            margin: 10px 0;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .risk-high {
            color: #dc3545;
            font-weight: bold;
        }

        .risk-medium {
            color: #ffc107;
            font-weight: bold;
        }

        .risk-low {
            color: #28a745;
            font-weight: bold;
        }

        /* Fix for input-group wrapping - only for results summary */
        #results-main .input-group {
            flex-wrap: nowrap !important;
        }

        #results-main .input-group .form-control {
            min-width: 60px;
            max-width: 120px;
            text-align: center;
            font-weight: bold;
        }

        #results-main .input-group-prepend .input-group-text,
        #results-main .input-group-append .input-group-text {
            white-space: nowrap;
        }
    </style>
</head>
<body>
<nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top">
<a class="navbar-brand" href="#" data-i18n="site_name">Flow Forecasting</a>
<button aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-target="#navbarsExampleDefault" data-toggle="collapse" type="button">
<span class="navbar-toggler-icon"></span>
</button>
<div class="collapse navbar-collapse" id="navbarsExampleDefault">
<ul class="navbar-nav mr-auto">
<li class="nav-item">
<a class="nav-link" data-target="#advanced-forecast" href="#advanced-forecast" data-i18n="menu_advanced">Previsão Avançada</a>
</li>
<li class="nav-item">
<a class="nav-link" data-target="#deadline-analysis" href="#deadline-analysis" data-i18n="menu_deadline">Análise de Prazo</a>
</li>
</ul>
<div class="language-selector">
<button class="language-btn" data-lang="pt" onclick="changeLanguage('pt')">PT</button>
<button class="language-btn" data-lang="en" onclick="changeLanguage('en')">EN</button>
<button class="language-btn" data-lang="es" onclick="changeLanguage('es')">ES</button>
</div>
</div>
</nav>
<main class="container" role="main">
<br/><br/><br/>
<div class="container text-center">
<h1 data-i18n="site_name">Flow Forecasting</h1>
<p>
                <span data-i18n="site_tagline">Previsão de esforço e duração de projetos usando simulações Monte Carlo e aprendizado de máquina.</span>
                <br/>
                <span data-i18n="site_description">Seus dados permanecem locais no seu navegador/servidor.</span>
            </p>
</div>
<section class="mt-4">
<div class="container-fluid bg-12 text-center">
<h2 data-i18n="shared_throughput_title">Dados de Throughput Compartilhados</h2>
<div class="row justify-content-center">
<div class="col-lg-8">
<textarea class="form-control text-monospace" id="tpSamples" data-i18n-placeholder="throughput_placeholder" placeholder="Exemplo: 5, 6, 7, 4, 8, 6, 5, 7, 6, 8" rows="4" title="Historical weekly throughput used by all simulations"></textarea>
<small class="form-text text-muted" data-i18n="throughput_help">
                            Forneça amostras de throughput semanais uma vez e reutilize-as em simulações Monte Carlo e Aprendizado de Máquina.
                        </small>
</div>
</div>
</div>
</section>
<ul class="nav nav-tabs nav-fill mt-4" id="forecastTabs" role="tablist">
<li class="nav-item">
<a aria-controls="mc-forecast" aria-selected="true" class="nav-link active" data-toggle="tab" href="#mc-forecast" id="tab-mc-link" role="tab" data-i18n="tab_monte_carlo">Monte Carlo</a>
</li>
<li class="nav-item">
<a aria-controls="advanced-forecast" aria-selected="false" class="nav-link" data-toggle="tab" href="#advanced-forecast" id="tab-advanced-link" role="tab" data-i18n="tab_advanced">Avançado (ML + MC)</a>
</li>
<li class="nav-item">
<a aria-controls="deadline-analysis" aria-selected="false" class="nav-link" data-toggle="tab" href="#deadline-analysis" id="tab-deadline-link" role="tab" data-i18n="tab_deadline">Análise de Prazo</a>
</li>
<li class="nav-item">
<a aria-controls="historical-charts" aria-selected="false" class="nav-link" data-toggle="tab" href="#historical-charts" id="tab-historical-link" role="tab" data-i18n="tab_historical">Gráficos Históricos</a>
</li>
<li class="nav-item">
<a aria-controls="cost-analysis" aria-selected="false" class="nav-link" data-toggle="tab" href="#cost-analysis" id="tab-cost-link" role="tab" data-i18n="tab_cost">Análise de Custos</a>
</li>
</ul>
<div class="tab-content" id="forecastTabsContent">
<div aria-labelledby="tab-mc-link" class="tab-pane fade show active" id="mc-forecast" role="tabpanel">
<div class="pt-4">
<div class="container-fluid bg-6 text-center">
<div class="row">
<div class="col-sm-6 text-left">
<h3 data-i18n="project_props">Propriedades do Projeto</h3>
<div class="input-group mb-3">
<div class="input-group-prepend">
<span class="input-group-text" data-i18n="project_name">Nome do projeto</span>
</div>
<input class="form-control" id="projectName" type="text"/>
</div>
<div class="input-group mb-3">
<div class="input-group-prepend">
<span class="input-group-text"><span data-i18n="team_size">Tamanho da equipe</span><span style="color:red">*</span></span>
</div>
<input class="form-control" id="totalContributors" max="9999" min="1" required="required" title="Total number of individual contributors on this team" type="number" value="1"/>
<div class="input-group-append">
<span class="input-group-text" data-i18n="contributors">contribuidores</span>
</div>
</div>
<div class="input-group mb-3">
<div class="input-group-prepend">
<span class="input-group-text" data-i18n="min_contributors">Contribuidores mínimos</span>
</div>
<input class="form-control" id="minContributors" max="9999" min="1" title="Minimum number of contributors who will start working in the project" type="number"/>
</div>
<div class="input-group mb-3">
<div class="input-group-prepend">
<span class="input-group-text" data-i18n="max_contributors">Contribuidores máximos</span>
</div>
<input class="form-control" id="maxContributors" max="9999" min="1" title="Maximum number of contributors who can work in the project" type="number"/>
</div>
<div class="input-group mb-3">
<div class="input-group-prepend">
<span class="input-group-text"><span data-i18n="num_tasks">Número de tarefas</span><span style="color:red">*</span></span>
</div>
<input class="form-control" id="numberOfTasks" max="9999" min="0" required="required" title="Number of tasks planned for this project" type="number" value="1"/>
</div>
<div class="input-group mb-3">
<div class="input-group-prepend">
<span class="input-group-text" data-i18n="historical_team_size_label" data-i18n-title="historical_team_size_tooltip">Tamanho histórico da equipe</span>
</div>
<input class="form-control" id="historicalTeamSize" max="9999" min="1" title="Number of contributors when historical throughput data was collected (default: 1)" type="number" value="1" placeholder="1"/>
<div class="input-group-append">
<span class="input-group-text" data-i18n="contributors">contribuidores</span>
</div>
</div>
</div>
<div class="col-sm-6 text-left">
<h3 data-i18n="simulation_props">Propriedades da Simulação</h3>
<div class="input-group mb-3">
<div class="input-group-prepend">
<span class="input-group-text"><span data-i18n="num_simulations">Número de simulações</span><span style="color:red">*</span></span>
</div>
<input class="form-control" id="numberOfSimulations" max="10000000" min="10000" required="required" title="Number of simulations to execute (Default: 100K)" type="number" value="100000"/>
</div>
<div class="input-group mb-3">
<div class="input-group-prepend">
<span class="input-group-text" data-i18n="scurve_size">Tamanho da Curva-S</span>
</div>
<input class="form-control" id="sCurveSize" max="50" min="0" title="Size of the S-Curve at the beginning and end of the project (Default: 20%)" type="number" value="20"/>
<div class="input-group-append">
<span class="input-group-text">%</span>
</div>
</div>
<div class="input-group mb-3">
<div class="input-group-prepend">
<span class="input-group-text" data-i18n="confidence_level">Nível de confiança</span>
</div>
<input class="form-control" id="confidenceLevel" max="99" min="1" title="Level of confidence to report in the results (Default: 85%)" type="number" value="85"/>
<div class="input-group-append">
<span class="input-group-text">%</span>
</div>
</div>
<div class="input-group mb-3">
<div class="input-group-prepend">
<span class="input-group-text" data-i18n="start_date">Data de início</span>
</div>
<input class="form-control" id="startDate" title="Planned start date for this project" type="date"/>
</div>
<div class="input-group mb-3">
<div class="input-group-prepend">
<span class="input-group-text" data-i18n="deadline">Prazo</span>
</div>
<input class="form-control" id="deadlineDate" title="Target deadline date for deadline analysis" type="date"/>
</div>
</div>
</div>
<p class="mb-0"><i>(<span data-i18n="fields_mandatory">Campos marcados com um</span> <span style="color:red">*</span> <span data-i18n="are_mandatory">vermelho são obrigatórios</span>)</i></p>
</div>
<div class="container-fluid bg-12 text-center">
<h2 data-i18n="historical_data">Dados históricos</h2>
<p class="text-muted mb-4" data-i18n="weekly_throughput_note">As amostras de throughput semanais são definidas na seção compartilhada acima.</p>
<div class="row">
<div class="col-sm-6">
<h4 data-i18n="task_lead_times">Tempos de lead de tarefas</h4>
<textarea class="form-control text-monospace" id="ltSamples" rows="4" title="Optionally paste your historical data of tasks lead-time"></textarea>
</div>
<div class="col-sm-6">
<h4 data-i18n="projects_split_rates">Taxas de divisão de projetos</h4>
<textarea class="form-control text-monospace" id="splitRateSamples" rows="4" title="Optionally paste your historical data of project's split rates"></textarea>
</div>
</div>
</div>
<div class="container-fluid bg-12 text-center">
<h2 data-i18n="risks_optional">Riscos (opcional)</h2>
<p class="text-muted" data-i18n="risks_description">Modele riscos discretos para adicionar buffer probabilístico à sua previsão.</p>
<div class="row">
<table class="table table-sm" id="risks">
<thead>
<tr class="d-flex">
<th class="col-2" scope="col" data-i18n="likelihood">Probabilidade</th>
<th class="col-2" scope="col" data-i18n="low_impact">Impacto baixo</th>
<th class="col-2" scope="col" data-i18n="high_impact">Impacto alto</th>
<th class="col-6" scope="col" data-i18n="description">Descrição</th>
</tr>
</thead>
<tbody>
<tr class="d-flex risk-row" id="risk-row-template">
<td class="col-2">
<div class="input-group mb-3">
<input class="form-control" max="100" min="1" name="likelihood" type="number"/>
<div class="input-group-append d-none d-md-block">
<span class="input-group-text">%</span>
</div>
</div>
</td>
<td class="col-2">
<div class="input-group mb-3">
<input class="form-control" max="100" min="0" name="lowImpact" type="number"/>
<div class="input-group-append d-none d-lg-block">
<span class="input-group-text" data-i18n="tasks">tarefas</span>
</div>
</div>
</td>
<td class="col-2">
<div class="input-group mb-3">
<input class="form-control" max="100" min="1" name="highImpact" type="number"/>
<div class="input-group-append d-none d-lg-block">
<span class="input-group-text" data-i18n="tasks">tarefas</span>
</div>
</div>
</td>
<td class="col-6"><input class="form-control" name="description" type="text"/></td>
</tr>
<tr class="d-flex" id="add-risk-row">
<td class="col-2"></td>
<td class="col-2"></td>
<td class="col-2"></td>
<td class="col-6">
<button class="btn btn-secondary btn-sm" id="addRisk" type="button" data-i18n="add_row">Adicionar linha</button>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="container-fluid bg-12 text-center">
<button class="btn btn-primary" id="run" type="button" data-i18n="run_simulation">Executar a simulação!</button>
<button class="btn btn-secondary" id="share" title="Share simulation" type="button" data-i18n="share">Compartilhar</button>
</div>
<div class="container-fluid bg-12 text-center" id="results-main" style="display:none">
<h2 data-i18n="results_title">Resultados da Simulação</h2>
<div class="col-sm-4 text-left">
<h4 id="res-summary-header" data-i18n="forecast_summary">Resumo da previsão do projeto:</h4>
<div class="input-group mb-1">
<div class="input-group-prepend">
<span class="input-group-text font-weight-bold" data-i18n="effort">Esforço:</span>
</div>
<input class="form-control" id="res-effort" readonly="" type="text"/>
<div class="input-group-append">
<span class="input-group-text" data-i18n="person_weeks">pessoa-semanas</span>
</div>
</div>
<div class="input-group mb-1">
<div class="input-group-prepend">
<span class="input-group-text font-weight-bold" data-i18n="duration">Duração:</span>
</div>
<input class="form-control" id="res-duration" readonly="" type="text"/>
<div class="input-group-append">
<span class="input-group-text" data-i18n="calendar_weeks">semanas corridas</span>
</div>
</div>
<div class="input-group mb-1">
<div class="input-group-prepend">
<span class="input-group-text font-weight-bold" data-i18n="delivery_date">Data de entrega:</span>
</div>
<input class="form-control" id="res-endDate" readonly="" type="text"/>
</div>
</div>
<h3 data-i18n="all_probabilities">Todas as probabilidades</h3>
<div class="row">
<table class="table table-sm" id="probabilities">
<thead>
<tr class="d-flex probabilities-header">
<th class="col-2" scope="col" data-i18n="likelihood">Probabilidade</th>
<th class="col-1" scope="col" data-i18n="effort">Esforço</th>
<th class="col-1" scope="col" data-i18n="duration">Duração</th>
<th class="col-2" scope="col" data-i18n="num_tasks">Número de tarefas</th>
<th class="col-3" scope="col" data-i18n="date">Data</th>
<th class="col-3" scope="col" data-i18n="comment">Comentário</th>
</tr>
</thead>
<tbody>
<tr class="d-flex probabilities-row">
<td class="col-2"></td>
<td class="col-1"></td>
<td class="col-1"></td>
<td class="col-2"></td>
<td class="col-3"></td>
<td class="col-3"></td>
</tr>
<tr class="d-flex" id="show-more-row">
<td class="col-2"></td>
<td class="col-1"></td>
<td class="col-1"></td>
<td class="col-2"></td>
<td class="col-3"></td>
<td class="col-3">
<button class="btn btn-secondary btn-sm" id="show-more" type="button" data-i18n="show_more">Mostrar mais...</button>
</td>
</tr>
</tbody>
</table>
</div>
<h3 data-i18n="charts">Gráficos</h3>
<canvas id="res-duration-histogram"></canvas>
<canvas id="res-burn-downs"></canvas>
<canvas id="res-effort-scatter-plot"></canvas>
<h3 data-i18n="simulation_report">Relatório da simulação</h3>
<textarea class="col-sm-12 text-monospace" id="results" readonly="" rows="23"></textarea>
</div>
<div class="container-fluid bg-12 text-left mt-4" id="input-stats" style="display:none">
<h3 class="input-stats-title" data-i18n="input_stats">Estatísticas de entrada</h3>
<div class="input-stats-content"></div>
</div>
</div>
</div>
<div aria-labelledby="tab-advanced-link" class="tab-pane fade" id="advanced-forecast" role="tabpanel">
<div class="pt-4 pb-5">
<div class="container text-center">
<h2 data-i18n="advanced_forecasting">Previsão Avançada</h2>
<p class="mb-4" data-i18n="advanced_description">
                            Combine previsões de aprendizado de máquina com simulações de throughput Monte Carlo para perspectivas mais ricas.
                            Forneça pelo menos oito amostras de throughput para desbloquear projeções baseadas em ML.
                        </p>
</div>
<div class="container-fluid bg-6 text-center">
<div class="row">
<div class="col-sm-6 text-left">
<h3 data-i18n="historical_data_title">Dados Históricos</h3>
<div class="form-group">
<label><span data-i18n="weekly_throughput_label">Throughput Semanal</span><span style="color:red">*</span></label>
<div class="alert alert-secondary mb-3" role="alert">
                                        <span data-i18n="uses_shared_samples">Usa as amostras de throughput compartilhadas definidas acima.</span>
                                        <a class="alert-link scroll-to-throughput" href="#tpSamples" data-i18n="edit_data_link">Editar dados</a>
</div>
<small class="form-text text-muted" data-i18n="min_8_ml">Mínimo de 8 valores necessários para previsão ML.</small>
</div>
<div class="form-group">
<label for="startDateAdv" data-i18n="start_date_label">Data de Início</label>
<input class="form-control" id="startDateAdv" type="date"/>
</div>
</div>
<div class="col-sm-6 text-left">
<h3 data-i18n="forecast_params">Parâmetros de Previsão</h3>
<div class="form-group">
<label for="forecastSteps" data-i18n="forecast_steps_label">Passos de Previsão (semanas)</label>
<input class="form-control" id="forecastSteps" max="12" min="1" type="number" value="4"/>
</div>
<div class="form-group">
<label for="backlog" data-i18n="backlog_tasks_label">Backlog (tarefas)</label>
<input class="form-control" id="backlog" max="10000" min="1" type="number" value="50"/>
</div>
<div class="form-group">
<label for="nSimulations" data-i18n="mc_simulations_label">Simulações Monte Carlo</label>
<input class="form-control" id="nSimulations" max="100000" min="1000" type="number" value="10000"/>
</div>
</div>
</div>
</div>
<div class="container-fluid bg-12 text-center">
<button class="btn btn-primary btn-lg" id="runCombined" type="button" data-i18n="run_combined">Executar Previsão Combinada</button>
<button class="btn btn-success" id="runML" type="button" data-i18n="ml_only">Apenas Previsão ML</button>
</div>
<div class="container-fluid text-center" id="loading" style="display:none">
<div class="spinner-border text-primary" role="status">
<span class="sr-only" data-i18n="loading">Carregando...</span>
</div>
<p data-i18n="running_forecast">Executando previsão... Isso pode levar alguns segundos.</p>
</div>
<div id="results-container" style="display:none">
<div class="container-fluid" id="ml-results" style="display:none">
<h3 data-i18n="ml_forecast_title">Previsão de Aprendizado de Máquina</h3>
<div class="results-panel">
<h4 data-i18n="risk_assessment_title">Avaliação de Risco</h4>
<div id="risk-assessment"></div>
</div>
<div class="results-panel">
<h4 data-i18n="model_performance_title">Desempenho do Modelo</h4>
<div id="model-performance"></div>
</div>
<div class="chart-container">
<h4 data-i18n="ml_ensemble_forecast">Previsão de Ensemble ML</h4>
<img alt="ML Forecast Chart" id="ml-chart" src=""/>
</div>
<div class="chart-container">
<h4 data-i18n="historical_data_analysis">Análise de Dados Históricos</h4>
<img alt="Historical Analysis" id="history-chart" src=""/>
</div>
</div>
<div class="container-fluid" id="mc-results" style="display:none">
<h3 data-i18n="monte_carlo_simulation">Simulação Monte Carlo</h3>
<div class="results-panel">
<h4 data-i18n="completion_time_stats">Estatísticas de Tempo de Conclusão</h4>
<div id="mc-stats"></div>
</div>
<div class="chart-container">
<h4 data-i18n="monte_carlo_simulations">Simulações Monte Carlo</h4>
<img alt="Monte Carlo Chart" id="mc-chart" src=""/>
</div>
</div>
<div class="container-fluid" id="comparison-results" style="display:none">
<h3 data-i18n="forecast_comparison">Comparação de Previsão</h3>
<div class="chart-container">
<h4 data-i18n="ml_vs_mc">ML vs Monte Carlo Comparação</h4>
<img alt="Comparison Chart" id="comparison-chart" src=""/>
</div>
<div class="results-panel">
<div class="row">
<div class="col-md-6">
<h5 data-i18n="ml_forecast_summary">Resumo de Previsão ML</h5>
<div id="ml-summary"></div>
</div>
<div class="col-md-6">
<h5 data-i18n="mc_summary">Resumo Monte Carlo</h5>
<div id="mc-summary"></div>
</div>
</div>
</div>
</div>
<div class="mt-4" id="advanced-input-stats" style="display:none">
<h4 class="input-stats-title" data-i18n="input_stats">Estatísticas de entrada</h4>
<div class="input-stats-content"></div>
</div>
<div class="container-fluid mt-4" id="walk-forward-results" style="display:none">
<h3 data-i18n="walk_forward_validation">Validação Walk-forward</h3>
<div class="alert alert-info small">
                                Validação com janela deslizante utilizando os últimos 20% das amostras. Os erros são calculados a cada origem de previsão respeitando o parâmetro <strong>Forecast Steps</strong>.
                            </div>
<div class="table-responsive mb-3" id="walk-forward-metrics"></div>
<div class="row" id="walk-forward-charts"></div>
</div>
</div>
</div>
</div>
<div aria-labelledby="tab-deadline-link" class="tab-pane fade" id="deadline-analysis" role="tabpanel">
<div class="pt-4 pb-5">
<div class="container text-center">
<h2 data-i18n="deadline_analysis">Análise de Prazo</h2>
<p class="mb-4" data-i18n="deadline_reuse_desc">
                            Reutilize suas entradas de simulação e riscos existentes para avaliar se o prazo pode ser alcançado.
                            Certifique-se de que os campos Data de início e Prazo no formulário Monte Carlo estejam preenchidos.
                        </p>
</div>
<div class="container-fluid bg-12 text-center">
<div class="alert alert-info d-inline-block text-left" role="alert">
<strong data-i18n="how_it_works">Como funciona</strong>: <span data-i18n="how_works_desc">executamos a simulação Monte Carlo completa com seus riscos e configurações de equipe,
                            depois comparamos os percentis de conclusão projetados com o prazo selecionado. O previsor de Aprendizado de Máquina
                            também é executado quando pelo menos oito amostras de throughput estão disponíveis.</span>
                        </div>
<div class="mt-3">
<button class="btn btn-primary btn-lg" id="runDeadlineAnalysis" type="button" data-i18n="run_deadline_analysis">
                                Executar Análise de Prazo
                            </button>
</div>
</div>
<div class="mt-4" id="deadline-analysis-loading" style="display:none">
<div class="spinner-border text-primary" role="status">
<span class="sr-only" data-i18n="loading">Carregando...</span>
</div>
<p class="mt-2" data-i18n="running_simulations">Executando simulações de prazo...</p>
</div>
<div class="mt-4" id="deadline-analysis-panels" style="display:none">
<ul class="nav nav-tabs nav-fill mb-3" id="deadlineResultsTabs" role="tablist">
<li class="nav-item">
<a class="nav-link active" id="deadline-summary-tab" data-toggle="tab" href="#deadline-results-summary" role="tab">Resumo</a>
</li>
<li class="nav-item" id="deadline-start-tab-item" style="display:none">
<a class="nav-link" id="deadline-start-tab" data-toggle="tab" href="#deadline-start-window" role="tab">Quando começar?</a>
</li>
</ul>
<div class="tab-content">
<div class="tab-pane fade show active" id="deadline-results-summary" role="tabpanel"></div>
<div class="tab-pane fade" id="deadline-start-window" role="tabpanel">
<div class="mb-3">
<div class="alert alert-secondary d-inline-block">
<strong>Hoje:</strong> <span id="current-date-display" class="font-weight-bold"></span>
</div>
</div>
<div class="table-responsive">
<table class="table table-sm table-bordered">
<thead class="table-light">
<tr>
<th>Intervalo</th>
<th>Data de início</th>
<th>Até</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr class="table-warning">
<th scope="row">Muito cedo</th>
<td id="window-too-early"></td>
<td colspan="1"></td>
<td id="window-too-early-status"></td>
</tr>
<tr class="table-warning">
<th scope="row">Cedo</th>
<td id="window-early-start"></td>
<td id="window-early-end"></td>
<td id="window-early-status"></td>
</tr>
<tr class="table-success">
<th scope="row" data-i18n="just_in_time">Just in time</th>
<td id="window-just-start"></td>
<td id="window-just-end"></td>
<td id="window-just-status"></td>
</tr>
<tr class="table-warning">
<th scope="row">Tarde</th>
<td id="window-late-start"></td>
<td id="window-late-end"></td>
<td id="window-late-status"></td>
</tr>
<tr class="table-danger">
<th scope="row">Último momento responsável (UMR)</th>
<td id="window-umr"></td>
<td colspan="1"></td>
<td id="window-umr-status"></td>
</tr>
<tr class="table-danger">
<th scope="row">Irresponsavelmente atrasado</th>
<td colspan="2" id="window-too-late"></td>
<td id="window-too-late-status"></td>
</tr>
</tbody>
</table>
</div>
<small class="text-muted d-block text-left">DDE = Data Desejada de Entrega · UMR = Último Momento Responsável</small>
</div>
</div>
</div>
</div>
</div>
<div aria-labelledby="tab-historical-link" class="tab-pane fade" id="historical-charts" role="tabpanel">
<div class="pt-4 pb-5">
<div class="container text-center">
<h2 data-i18n="historical_throughput_lead">Gráficos Históricos de Throughput e Tempo de Lead</h2>
<p class="mb-4" data-i18n="visualize_distribution">Visualize a distribuição e estabilidade das amostras fornecidas. Atualize os campos acima para atualizar esses gráficos.</p>
</div>
<div class="container-fluid">
<div class="row">
<div class="col-lg-6 mb-4">
<div class="card h-100">
<div class="card-header bg-primary text-white">
<h5 class="mb-0" data-i18n="throughput_histogram_title">Histograma de Throughput</h5>
</div>
<div class="card-body">
<div class="alert alert-info" id="tp-histogram-empty" role="alert" style="display:none;" data-i18n="min_3_samples_histogram">
Forneça ao menos 3 amostras de throughput para gerar o histograma.
</div>
<div class="chart-container" id="tp-histogram-container">
<canvas id="tp-histogram-chart"></canvas>
</div>
</div>
</div>
</div>
<div class="col-lg-6 mb-4">
<div class="card h-100">
<div class="card-header bg-secondary text-white">
<h5 class="mb-0" data-i18n="throughput_control_title">Gráfico de Controle de Throughput</h5>
</div>
<div class="card-body">
<div class="alert alert-info" id="tp-control-empty" role="alert" style="display:none;" data-i18n="min_samples_control">
Forneça amostras de throughput para visualizar o gráfico de controle.
</div>
<div class="chart-container" id="tp-control-container">
<canvas id="tp-control-chart"></canvas>
</div>
</div>
</div>
</div>
</div>
<div class="row">
<div class="col-lg-6 mb-4">
<div class="card h-100">
<div class="card-header bg-success text-white">
<h5 class="mb-0" data-i18n="lead_time_histogram_title">Histograma de Tempo de Lead</h5>
</div>
<div class="card-body">
<div class="alert alert-info" id="lt-histogram-empty" role="alert" style="display:none;" data-i18n="min_3_samples_lt_histogram">
Forneça ao menos 3 amostras de tempo de lead para gerar o histograma.
</div>
<div class="chart-container" id="lt-histogram-container">
<canvas id="lt-histogram-chart"></canvas>
</div>
</div>
</div>
</div>
<div class="col-lg-6 mb-4">
<div class="card h-100">
<div class="card-header bg-dark text-white">
<h5 class="mb-0" data-i18n="lead_time_control_title">Gráfico de Controle de Tempo de Lead</h5>
</div>
<div class="card-body">
<div class="alert alert-info" id="lt-control-empty" role="alert" style="display:none;" data-i18n="min_samples_lt_control">
Forneça amostras de tempo de lead para visualizar o gráfico de controle.
</div>
<div class="chart-container" id="lt-control-container">
<canvas id="lt-control-chart"></canvas>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div aria-labelledby="tab-cost-link" class="tab-pane fade" id="cost-analysis" role="tabpanel">
<div class="pt-4 pb-5">
<div class="container text-center">
<h2 data-i18n="cost_analysis_title">Análise de Custos</h2>
<p class="mb-4" data-i18n="cost_analysis_desc">
                            Calcule custos do projeto baseados em esforço (pessoa-semanas) ou use distribuição PERT-Beta com estimativas otimista, mais provável e pessimista.
                        </p>
</div>

<!-- COST BY PERSON-WEEK SECTION -->
<div class="container-fluid bg-6 text-center mb-5">
<h2 class="mb-3">💰 Custo por Pessoa-Semana</h2>
<p class="text-muted mb-4">Calcule custos baseados no esforço projetado (pessoa-semanas) × custo semanal por pessoa</p>

<div class="row">
<div class="col-md-6 text-left">
<h3>Parâmetros de Custo</h3>
<div class="form-group">
<label for="costPerPersonWeek">Custo por Pessoa-Semana (R$)</label>
<div class="input-group">
<div class="input-group-prepend">
<span class="input-group-text">R$</span>
</div>
<input class="form-control" id="costPerPersonWeek" min="0" step="100" type="number" value="5000" placeholder="5000"/>
</div>
<small class="form-text text-muted">Custo semanal por pessoa (salário + encargos + overhead)</small>
</div>

<div class="form-group">
<label for="effortPersonWeeks">Esforço Estimado (pessoa-semanas)</label>
<div class="input-group">
<input class="form-control" id="effortPersonWeeks" min="0" step="0.1" type="number" placeholder="Ex: 54.0"/>
<div class="input-group-append">
<span class="input-group-text">pessoa-semanas</span>
</div>
</div>
<small class="form-text text-muted">Ou use as projeções da simulação Monte Carlo</small>
</div>
</div>

<div class="col-md-6 text-left">
<h3>Projeções Monte Carlo</h3>
<div class="alert alert-info">
<p class="mb-2"><strong>Para usar projeções Monte Carlo:</strong></p>
<ol class="mb-0 pl-3">
<li>Execute a simulação na aba <strong>Monte Carlo</strong></li>
<li>Os valores de esforço (P50, P85, P95) serão automaticamente usados</li>
<li>Os custos serão calculados para cada percentil</li>
</ol>
</div>

<div class="form-group">
<label>Tamanho da Equipe</label>
<div class="alert alert-secondary mb-0">
Usa o tamanho da equipe definido na aba Monte Carlo
</div>
</div>
</div>
</div>

<hr class="my-4">

<!-- PERT-Beta Effort Estimation -->
<div class="row">
<div class="col-12 text-left">
<h3><i class="fas fa-chart-line"></i> Estimativa PERT-Beta de Esforço (Opcional)</h3>
<p class="text-muted">Use estimativas otimista, mais provável e pessimista para simular o esforço do projeto com distribuição PERT-Beta</p>
</div>
</div>

<div class="row">
<div class="col-md-4 text-left">
<div class="form-group">
<label for="effortOptimistic">Esforço Otimista (a)</label>
<div class="input-group">
<input class="form-control" id="effortOptimistic" min="0" step="0.1" type="number" placeholder="Ex: 30.0"/>
<div class="input-group-append">
<span class="input-group-text">pessoa-semanas</span>
</div>
</div>
<small class="form-text text-muted">Melhor cenário possível</small>
</div>
</div>

<div class="col-md-4 text-left">
<div class="form-group">
<label for="effortMostLikely">Esforço Mais Provável (m)</label>
<div class="input-group">
<input class="form-control" id="effortMostLikely" min="0" step="0.1" type="number" placeholder="Ex: 50.0"/>
<div class="input-group-append">
<span class="input-group-text">pessoa-semanas</span>
</div>
</div>
<small class="form-text text-muted">Cenário mais realista</small>
</div>
</div>

<div class="col-md-4 text-left">
<div class="form-group">
<label for="effortPessimistic">Esforço Pessimista (b)</label>
<div class="input-group">
<input class="form-control" id="effortPessimistic" min="0" step="0.1" type="number" placeholder="Ex: 80.0"/>
<div class="input-group-append">
<span class="input-group-text">pessoa-semanas</span>
</div>
</div>
<small class="form-text text-muted">Pior cenário possível</small>
</div>
</div>
</div>

<div class="row">
<div class="col-md-6 text-left">
<div class="form-group">
<label for="effortSimulations">Número de Simulações PERT</label>
<input class="form-control" id="effortSimulations" max="100000" min="10000" type="number" value="10000" placeholder="10000"/>
<small class="form-text text-muted">Mínimo: 10.000 simulações</small>
</div>
</div>
<div class="col-md-6 text-left">
<div class="alert alert-info mb-0">
<strong>Fórmula PERT</strong>: Esforço Esperado = (a + 4m + b) / 6
</div>
</div>
</div>

<div class="row mt-3">
<div class="col-12 text-center">
<button class="btn btn-success btn-lg" id="runEffortCostAnalysis" type="button">
<i class="fas fa-calculator"></i> Calcular Custos por Esforço
</button>
</div>
</div>

<!-- Effort Cost Results -->
<div class="mt-4" id="effort-cost-results" style="display:none">
<h3 class="text-center mb-4">Resultados - Custos por Pessoa-Semana</h3>
<div class="row">
<div class="col-md-4">
<div class="card">
<div class="card-header bg-info text-white">
<h5 class="mb-0">P50 (Mediana)</h5>
</div>
<div class="card-body text-center">
<h4 id="effort-cost-p50" class="text-primary">—</h4>
<small id="effort-weeks-p50" class="text-muted">—</small>
</div>
</div>
</div>
<div class="col-md-4">
<div class="card border-success">
<div class="card-header bg-success text-white">
<h5 class="mb-0">P85 (Recomendado)</h5>
</div>
<div class="card-body text-center">
<h4 id="effort-cost-p85" class="text-success">—</h4>
<small id="effort-weeks-p85" class="text-muted">—</small>
</div>
</div>
</div>
<div class="col-md-4">
<div class="card">
<div class="card-header bg-warning">
<h5 class="mb-0">P95 (Conservador)</h5>
</div>
<div class="card-body text-center">
<h4 id="effort-cost-p95" class="text-warning">—</h4>
<small id="effort-weeks-p95" class="text-muted">—</small>
</div>
</div>
</div>
</div>

<div class="row mt-3">
<div class="col-12">
<div class="card">
<div class="card-header bg-secondary text-white">
<h5 class="mb-0">Taxas de Referência</h5>
</div>
<div class="card-body">
<table class="table table-sm mb-0">
<tbody id="effort-cost-rates-table">
</tbody>
</table>
</div>
</div>
</div>
</div>

<!-- PERT-Beta Effort Histogram -->
<div class="row mt-4" id="effort-histogram-container" style="display:none">
<div class="col-12">
<div class="card">
<div class="card-header bg-primary text-white">
<h5 class="mb-0"><i class="fas fa-chart-bar"></i> Distribuição do Esforço (PERT-Beta)</h5>
</div>
<div class="card-body">
<div class="chart-container" style="position: relative; height: 400px;">
<canvas id="effort-histogram-chart"></canvas>
</div>
<small class="text-muted mt-2 d-block">
Histograma mostrando a distribuição de probabilidade do esforço estimado usando simulação Monte Carlo com distribuição PERT-Beta
</small>
</div>
</div>
</div>
</div>
</div>
</div>

<hr class="my-5">

<!-- PERT-BETA SECTION -->
<div class="container-fluid bg-6 text-center">
<h2 class="mb-3">📊 Análise PERT-Beta (Avançado)</h2>
<p class="text-muted mb-4">Simulação Monte Carlo com 10.000+ iterações usando distribuição PERT-Beta</p>

<div class="row">
<div class="col-md-6 text-left">
<h3 data-i18n="cost_per_item">Custo por Item</h3>
<div class="form-group">
<label for="avgCostPerItem" data-i18n="avg_cost_per_item">Custo Médio por Item</label>
<div class="input-group">
<div class="input-group-prepend">
<span class="input-group-text">R$</span>
</div>
<input class="form-control" id="avgCostPerItem" min="0" step="0.01" type="number" placeholder="Ex: 5000.00"/>
</div>
<small class="form-text text-muted" data-i18n="avg_cost_help">Custo médio histórico por item de trabalho</small>
</div>
</div>
<div class="col-md-6 text-left">
<h3 data-i18n="pert_estimates">Estimativas PERT</h3>
<div class="form-group">
<label for="optimisticCost" data-i18n="optimistic_cost">Custo Otimista (a)</label>
<div class="input-group">
<div class="input-group-prepend">
<span class="input-group-text">R$</span>
</div>
<input class="form-control" id="optimisticCost" min="0" step="0.01" type="number" data-i18n-placeholder="best_scenario"/>
</div>
</div>
<div class="form-group">
<label for="mostLikelyCost" data-i18n="most_likely_cost">Custo Mais Provável (m)</label>
<div class="input-group">
<div class="input-group-prepend">
<span class="input-group-text">R$</span>
</div>
<input class="form-control" id="mostLikelyCost" min="0" step="0.01" type="number" data-i18n-placeholder="realistic_scenario"/>
</div>
</div>
<div class="form-group">
<label for="pessimisticCost" data-i18n="pessimistic_cost">Custo Pessimista (b)</label>
<div class="input-group">
<div class="input-group-prepend">
<span class="input-group-text">R$</span>
</div>
<input class="form-control" id="pessimisticCost" min="0" step="0.01" type="number" data-i18n-placeholder="worst_scenario"/>
</div>
</div>
</div>
</div>
<div class="row mt-3">
<div class="col-md-6 text-left">
<div class="form-group">
<label for="costSimulations" data-i18n="num_sims">Número de Simulações</label>
<input class="form-control" id="costSimulations" max="100000" min="10000" type="number" value="10000"/>
<small class="form-text text-muted" data-i18n="min_simulations">Mínimo: 10.000 simulações</small>
</div>
</div>
<div class="col-md-6 text-left">
<div class="form-group">
<label data-i18n="backlog">Backlog</label>
<div class="alert alert-secondary mb-0" role="alert" data-i18n="uses_backlog">
                                        Usa o backlog definido na aba Monte Carlo
                                    </div>
</div>
</div>
</div>
</div>
<div class="container-fluid bg-12 text-center mt-4">
<button class="btn btn-primary btn-lg" id="runCostAnalysis" type="button" data-i18n="run_cost_analysis">
                                Executar Análise de Custos
                            </button>
</div>
<div class="mt-4" id="cost-analysis-loading" style="display:none">
<div class="spinner-border text-primary" role="status">
<span class="sr-only" data-i18n="loading">Carregando...</span>
</div>
<p class="mt-2" data-i18n="running_cost_sims">Executando simulações de custo...</p>
</div>
<div class="mt-4" id="cost-analysis-results" style="display:none">
<div class="container-fluid">
<h3 data-i18n="cost_results_title">Resultados da Simulação</h3>
<div class="row">
<div class="col-lg-6">
<div class="card mb-3">
<div class="card-header bg-primary text-white">
<h5 class="mb-0" data-i18n="cost_statistics">Estatísticas de Custo</h5>
</div>
<div class="card-body">
<table class="table table-sm table-borderless mb-0">
<tbody id="cost-stats-table">
</tbody>
</table>
</div>
</div>
</div>
<div class="col-lg-6">
<div class="card mb-3">
<div class="card-header bg-success text-white">
<h5 class="mb-0" data-i18n="scenarios">Cenários</h5>
</div>
<div class="card-body">
<table class="table table-sm table-borderless mb-0">
<tbody id="cost-scenarios-table">
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="row mt-4">
<div class="col-12">
<div class="card">
<div class="card-header bg-info text-white">
<h5 class="mb-0" data-i18n="cost_distribution">Distribuição de Custos</h5>
</div>
<div class="card-body">
<div class="chart-container">
<canvas id="cost-histogram-chart"></canvas>
</div>
</div>
</div>
</div>
</div>
<div class="row mt-4">
<div class="col-md-6">
<div class="card">
<div class="card-header bg-warning">
<h5 class="mb-0" data-i18n="cost_percentiles">Percentis de Custo</h5>
</div>
<div class="card-body">
<table class="table table-sm table-bordered">
<thead>
<tr>
<th data-i18n="percentile">Percentil</th>
<th data-i18n="cost_currency">Custo (R$)</th>
<th data-i18n="probability">Probabilidade</th>
</tr>
</thead>
<tbody id="cost-percentiles-table">
</tbody>
</table>
</div>
</div>
</div>
<div class="col-md-6">
<div class="card">
<div class="card-header bg-secondary text-white">
<h5 class="mb-0" data-i18n="pert_beta_params">Parâmetros PERT-Beta</h5>
</div>
<div class="card-body">
<table class="table table-sm table-borderless">
<tbody id="pert-params-table">
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<br/><br/>
</main>
<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.bundle.min.js"></script>
<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.bundle.min.js"></script>
<script>
        (function secureChartRegistration() {
            function registerCharts() {
                try {
                    if (!window.Chart || typeof window.Chart.register !== 'function' || !window.Chart.registerables) {
                        return;
                    }
                    window.Chart.register(...window.Chart.registerables);
                } catch (error) {
                    console.warn('Chart.js registration skipped:', error);
                }
            }

            if (window.Chart) {
                registerCharts();
            } else {
                document.addEventListener('chartjs:loaded', registerCharts, { once: true });
            }
        })();
    </script>
<!-- Chart.js Annotation Plugin -->
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@0.5.7/chartjs-plugin-annotation.min.js"></script>
<!-- Moment.js -->
<script src="https://cdn.jsdelivr.net/npm/moment@2.27.0/moment.min.js"></script>
<!-- Internationalization -->
<script src="{{ url_for('static', filename='js/i18n.js') }}"></script>
<!-- Custom JS -->
<script src="{{ url_for('static', filename='js/ui.js') }}"></script>
<script src="{{ url_for('static', filename='js/advanced_forecast.js') }}"></script>
<script src="{{ url_for('static', filename='js/charts.js') }}"></script>
<script src="{{ url_for('static', filename='js/cost_analysis.js') }}"></script>
<script>
        $(function () {
            function activateTabFromHash() {
                const hash = window.location.hash;
                if (hash === '#advanced-forecast') {
                    $('#tab-advanced-link').tab('show');
                } else if (hash === '#deadline-analysis') {
                    $('#tab-deadline-link').tab('show');
                } else if (hash === '#historical-charts') {
                    $('#tab-historical-link').tab('show');
                } else if (hash === '#cost-analysis') {
                    $('#tab-cost-link').tab('show');
                } else if (hash === '#mc-forecast') {
                    $('#tab-mc-link').tab('show');
                }
            }

            activateTabFromHash();

            window.addEventListener('hashchange', activateTabFromHash);

            $('#navbarsExampleDefault a.nav-link[data-target]').on('click', function (e) {
                const target = $(this).data('target');
                if (target && target.startsWith('#')) {
                    e.preventDefault();
                    $(`#forecastTabs a[href="${target}"]`).tab('show');
                    $('html, body').animate({ scrollTop: $('#forecastTabs').offset().top - 70 }, 300);
                }
            });

            $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
                const target = $(e.target).attr('href');
                if (target === '#advanced-forecast' || target === '#mc-forecast' || target === '#deadline-analysis' || target === '#historical-charts') {
                    history.replaceState(null, null, target);
                }
            });
        });
    </script>
</body>
</html>
